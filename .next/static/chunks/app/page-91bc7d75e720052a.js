(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2531:(e,s,t)=>{Promise.resolve().then(t.bind(t,4496))},4496:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>eM});var r=t(5155),a=t(2115),l=t(5660),n=t(7554);let o="https://wvlbdsrczkwtknslahch.supabase.co",i="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind2bGJkc3Jjemt3dGtuc2xhaGNoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI1MDE0NzAsImV4cCI6MjA2ODA3NzQ3MH0.amP21wZpTkjnIPsEyue-RivFQHysN9ZP-ljF8tDihSY";console.log("Supabase Configuration:"),console.log("- URL:",o||"NOT SET"),console.log("- Key exists:",!!i),console.log("- Is configured:",!!(o&&i));let c=!!(o&&i&&o.includes(".supabase.co")),d=c?(0,n.UU)(o,i,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!1}}):null,m=()=>{let[e,s]=(0,a.useState)(null),[t,r]=(0,a.useState)(!0),[l,n]=(0,a.useState)(null),o=(0,a.useRef)(!1),i=(0,a.useRef)(null),m=(0,a.useRef)(!1),x=(0,a.useRef)(!1);(0,a.useEffect)(()=>{if(!c){n("Supabaseが設定されていません。右上の「Connect to Supabase」ボタンをクリックしてください。"),r(!1);return}if(!d){n("Supabaseの設定に問題があります。環境変数を確認してください。"),r(!1);return}o.current||(o.current=!0,(async()=>{try{console.log("Initializing auth...");let{data:{session:a},error:l}=await d.auth.getSession();if(l){var e,t;console.error("Session error:",l),(null==(e=l.message)?void 0:e.includes("Failed to fetch"))||(null==(t=l.message)?void 0:t.includes("fetch"))?n("Supabaseへの接続に失敗しました。環境変数の設定を確認してください。"):n("認証セッションの取得に失敗しました。"),r(!1);return}(null==a?void 0:a.user)?(console.log("Session found, loading user profile..."),await u(a.user.id)):(console.log("No session found"),r(!1));let{data:{subscription:o}}=d.auth.onAuthStateChange(async(e,t)=>{var a,l;console.log("Auth state changed:",e),console.log("Session user:",null==t||null==(a=t.user)?void 0:a.email),console.log("Session user ID:",null==t||null==(l=t.user)?void 0:l.id),console.log("Current user ID:",i.current),console.log("Is loading profile:",x.current),"SIGNED_OUT"===e?(console.log("User signed out, clearing state"),s(null),i.current=null,m.current=!1,x.current=!1,r(!1)):"SIGNED_IN"===e&&(null==t?void 0:t.user)?(console.log("User signed in:",t.user.email),console.log("User ID:",t.user.id),i.current===t.user.id||x.current?console.log("Skipping profile load - same user or already loading"):(console.log("Loading profile for new user"),await u(t.user.id))):"TOKEN_REFRESHED"===e&&(null==t?void 0:t.user)&&(console.log("Token refreshed for user:",t.user.email),i.current!==t.user.id&&(console.log("Loading profile after token refresh"),await u(t.user.id)))});return()=>{o.unsubscribe()}}catch(e){console.error("Auth initialization error:",e),e instanceof TypeError&&e.message.includes("Failed to fetch")?n("Supabaseへの接続に失敗しました。環境変数の設定を確認し、開発サーバーを再起動してください。"):n("認証システムの初期化に失敗しました。"),r(!1)}})())},[u]);let u=async t=>{if(i.current===t&&e&&!x.current){console.log("Profile already loaded for user:",t),r(!1);return}if(x.current&&i.current===t)return void console.log("Profile loading already in progress for user:",t);x.current=!0,i.current=t,r(!0),n(null);let a=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;try{var l,o,c,u;console.log("Loading user profile for: ".concat(e," (attempt ").concat(t+1,")"));let n=await d.auth.getUser();if((null==(l=n.data.user)?void 0:l.email)==="admin@example.com"){console.log("Admin user detected, creating admin profile...");let t=await h(e);if(t){console.log("Admin profile ensured, setting user state"),s(t),i.current=e,x.current=!1,r(!1);return}}else if((null==(o=n.data.user)?void 0:o.email)==="support@example.com"){console.log("Support user detected, creating support profile...");let t=await g(e);if(t){console.log("Support profile ensured, setting user state:",t),s(t),i.current=e,x.current=!1,r(!1);return}console.log("Failed to ensure support profile, user will be signed out"),await d.auth.signOut(),s(null),i.current=null,x.current=!1,r(!1);return}let{data:m,error:p}=await d.from("users").select("*").eq("id",e).maybeSingle();if(p){if((null==(c=p.message)?void 0:c.includes("Failed to fetch"))||(null==(u=p.message)?void 0:u.includes("fetch")))throw Error("Supabaseへの接続に失敗しました。環境変数の設定を確認してください。");if("PGRST116"===p.code&&t<2)return console.log("User not found, retrying in ".concat(500,"ms... (attempt ").concat(t+1,"/").concat(2,")")),await new Promise(e=>setTimeout(e,500)),a(e,t+1);console.error("User fetch error:",p),console.log("User not found, clearing auth state"),s(null),r(!1),i.current=null,x.current=!1;return}if(!m){if(t<2)return console.log("No user data found, retrying in ".concat(500,"ms... (attempt ").concat(t+1,"/").concat(2,")")),await new Promise(e=>setTimeout(e,500)),a(e,t+1);console.log("No user profile found for:",e),s(null),r(!1),i.current=null,x.current=!1;return}let b=null;if("monitor"===m.role){let{data:s,error:t}=await d.from("monitor_profiles").select("*").eq("user_id",e).maybeSingle();t?console.error("Monitor profile fetch error:",t):b=s}else if("client"===m.role){let{data:s,error:t}=await d.from("client_profiles").select("*").eq("user_id",e).maybeSingle();t?console.error("Client profile fetch error:",t):b=s}let f={...m,profile:b};console.log("User profile loaded successfully"),s(f),i.current=e,x.current=!1,r(!1)}catch(l){if(t<2)return console.log("Error loading profile, retrying in ".concat(500,"ms... (attempt ").concat(t+1,"/").concat(2,")")),await new Promise(e=>setTimeout(e,500)),a(e,t+1);if(console.error("Error loading user profile:",l),l instanceof Error&&l.message.includes("Supabaseへの接続に失敗")?n(l.message):console.log("Error loading profile, clearing auth state"),m.current){console.log("User profile not found during signup, waiting longer..."),await new Promise(e=>setTimeout(e,2e3));let{data:s,error:t}=await d.from("users").select("*").eq("id",e).maybeSingle();if(!t&&s)return console.log("User profile found on retry"),a(e,0)}s(null),r(!1),i.current=null,x.current=!1,x.current=!1}};try{await a(t)}catch(e){console.error("Error loading user profile:",e),e instanceof TypeError&&e.message.includes("Failed to fetch")?n("Supabaseへの接続に失敗しました。環境変数の設定を確認し、開発サーバーを再起動してください。"):console.log("Error in loadUserProfile, clearing auth state"),s(null),r(!1),i.current=null}},h=async e=>{try{console.log("Ensuring admin profile for user:",e);let{data:s,error:t}=await d.from("users").select("*").eq("email","admin@example.com").maybeSingle();if(t&&"PGRST116"!==t.code)return console.error("Error checking existing user by email:",t),null;if(s)return console.log("Admin user already exists with email admin@example.com"),{...s,profile:null};let{data:r,error:a}=await d.from("users").select("*").eq("id",e).maybeSingle();if(a&&"PGRST116"!==a.code)return console.error("Error checking existing user by ID:",a),null;if(s||r){console.log("Admin user profile already exists by ID");let e=r||s;if(e)return{...e,profile:null}}else{console.log("Creating admin user profile...");let{data:s,error:t}=await d.from("users").upsert([{id:e,email:"admin@example.com",role:"admin",name:"管理者"}],{onConflict:"email",ignoreDuplicates:!0}).select();if(t){console.error("Error creating admin user:",t);let{data:e}=await d.from("users").select("*").eq("email","admin@example.com").maybeSingle();if(e)return{...e,profile:null}}else{if(console.log("Admin user profile created successfully"),s&&s.length>0)return{...s[0],profile:null};{let{data:e}=await d.from("users").select("*").eq("email","admin@example.com").single();if(e)return{...e,profile:null}}}}}catch(e){console.error("Error in ensureAdminProfile:",e);try{let{data:e}=await d.from("users").select("*").eq("email","admin@example.com").maybeSingle();if(e)return{...e,profile:null}}catch(e){console.error("Error retrying to get existing admin user:",e)}}return null},g=async e=>{try{console.log("Ensuring support profile for user:",e),console.log("Checking for existing support user by email...");let{data:s,error:t}=await d.from("users").select("*").eq("email","support@example.com").maybeSingle();if(console.log("Email check result:",{existingUserByEmail:s,emailCheckError:t,hasData:!!s,errorCode:null==t?void 0:t.code,errorMessage:null==t?void 0:t.message}),t&&"PGRST116"!==t.code)return console.error("Error checking existing user by email:",t),null;if(s){console.log("Support user already exists with email support@example.com:",s);let e={...s,profile:null};return console.log("Returning user profile:",e),e}let{data:r,error:a}=await d.from("users").select("*").eq("id",e).maybeSingle();if(a&&"PGRST116"!==a.code)return console.error("Error checking existing user by ID:",a),null;if(s||r){console.log("Support user profile already exists by ID");let e=r||s;if(e)return{...e,profile:null}}else{console.log("Support user does not exist, attempting to create..."),console.log("Checking for existing support user again...");let{data:e,error:s}=await d.from("users").select("*").eq("email","support@example.com").maybeSingle();if(s&&"PGRST116"!==s.code)return console.error("Error retrying to get support user:",s),null;if(e)return console.log("Support user found on retry"),{...e,profile:null};console.log("Cannot create support user due to RLS policies. User must be created manually.")}}catch(e){console.error("Error in ensureSupportProfile:",e);try{let{data:e}=await d.from("users").select("*").eq("email","support@example.com").maybeSingle();if(e)return{...e,profile:null}}catch(e){console.error("Error retrying to get existing support user:",e)}}return null};return{user:e,loading:t,error:l,signIn:async(e,s)=>{try{if(!d)return n("Supabaseが正しく設定されていません。"),r(!1),{error:Error("Supabase not configured")};if(r(!0),n(null),console.log("=== SIGN IN ATTEMPT ==="),console.log("Email:",e),console.log("Password length:",s.length),"admin@example.com"===e){console.log("Admin login detected, attempting sign in...");let{data:t,error:a}=await d.auth.signInWithPassword({email:e,password:s});if(console.log("Admin auth result:",{data:!!t.user,error:a}),a)if(!a.message.includes("Invalid login credentials"))return console.error("Admin signin error:",a),n(a.message),r(!1),{error:a};else{console.log("Admin account not found, attempting to create...");let{error:t}=await d.auth.signUp({email:e,password:s,options:{data:{name:"管理者",role:"admin"}}});if(t)return console.error("Admin signup error:",t),n("管理者アカウントの作成に失敗しました。"),r(!1),{error:t};console.log("Admin account created, now signing in...");let{error:a}=await d.auth.signInWithPassword({email:e,password:s});if(a)return console.error("Admin retry signin error:",a),n("管理者ログインに失敗しました。"),r(!1),{error:a};return console.log("Admin signin successful after creation"),{error:null}}return console.log("Admin signin successful"),{error:null}}if("support@example.com"===e){console.log("Support login detected, attempting sign in...");let{data:t,error:a}=await d.auth.signInWithPassword({email:e,password:s});if(console.log("Support auth result:",{data:!!t.user,error:a}),a)if(!a.message.includes("Invalid login credentials"))return console.error("Support signin error:",a),n(a.message),r(!1),{error:a};else{console.log("Support account not found, attempting to create...");let{error:t}=await d.auth.signUp({email:e,password:s,options:{data:{name:"キャリアサポートスタッフ",role:"support"}}});if(t)return console.error("Support signup error:",t),n("サポートアカウントの作成に失敗しました。"),r(!1),{error:t};console.log("Support account created, now signing in...");let{error:a}=await d.auth.signInWithPassword({email:e,password:s});if(a)return console.error("Support retry signin error:",a),n("サポートログインに失敗しました。"),r(!1),{error:a};return console.log("Support signin successful after creation"),{error:null}}return console.log("Support signin successful"),{error:null}}let{error:t}=await d.auth.signInWithPassword({email:e,password:s});if(console.log("Auth sign in result:",{error:t}),t)return console.error("Sign in error:",t),n(t.message),r(!1),{error:t};return console.log("Sign in successful, waiting for auth state change..."),{error:t}}catch(e){return console.error("Sign in error:",e),n("ログインに失敗しました。"),r(!1),{error:e}}},signUp:async(e,s,t)=>{console.log("=== SIGNUP FUNCTION CALLED ==="),console.log("Email:",e),console.log("Password length:",s.length),console.log("UserData:",t);try{var a;if(!d)return n("Supabaseが正しく設定されていません。"),r(!1),{error:Error("Supabase not configured")};if(m.current=!0,r(!0),n(null),console.log("Starting signup process for:",e),console.log("User data:",t),console.log("User role:",t.role),"admin@example.com"===e){console.log("Admin signup detected");let{data:t,error:a}=await d.auth.signUp({email:e,password:s,options:{data:{name:"管理者",role:"admin"}}});if(a)return console.error("Admin auth signup error:",a),n(a.message),m.current=!1,r(!1),{error:a};return console.log("Admin auth signup successful"),m.current=!1,r(!1),{data:t,error:a}}console.log("About to call supabase.auth.signUp...");let{data:l,error:o}=await d.auth.signUp({email:e,password:s,options:{data:{name:t.name,role:t.role}}});if(console.log("supabase.auth.signUp completed"),console.log("Auth data:",l),console.log("Auth error:",o),o)return console.error("Auth signup error:",o),"User already registered"===o.message?n("このメールアドレスは既に登録されています。ログインしてください。"):n(o.message),m.current=!1,r(!1),{error:o};if(console.log("Auth signup successful, user ID:",null==(a=l.user)?void 0:a.id),l.user){console.log("Creating user profile in database...");let{error:a}=await d.from("users").insert([{id:l.user.id,email:l.user.email,role:t.role,name:t.name}]);if(a)return console.error("Profile creation error:",a),n("ユーザープロファイルの作成に失敗しました。"),m.current=!1,r(!1),{error:a};if(console.log("User profile created successfully"),"monitor"===t.role){console.log("Creating monitor profile...");let{error:e}=await d.from("monitor_profiles").insert([{user_id:l.user.id,age:t.age||null,gender:t.gender||null,occupation:t.occupation||null,location:t.location||null,faculty:t.faculty||null,department:t.department||null,hometown:t.hometown||null,points:0}]);if(e)return console.error("Monitor profile creation error:",e),console.error("Error details:",{message:e.message,details:e.details,hint:e.hint,code:e.code}),n("モニタープロフィールの作成に失敗しました。"),m.current=!1,r(!1),{error:e};console.log("Monitor profile created successfully")}else if("client"===t.role){if(console.log("Processing client registration..."),console.log("Client data check:",{registration_code:t.registration_code,company_name:t.company_name,industry:t.industry,hasRegistrationCode:!!t.registration_code,hasCompanyName:!!t.company_name,hasIndustry:!!t.industry}),!t.registration_code||!t.company_name||!t.industry)return console.error("Missing required client fields:",{registration_code:t.registration_code,company_name:t.company_name,industry:t.industry}),n("登録番号、会社名、業界は必須項目です。"),m.current=!1,r(!1),{error:Error("Missing required client fields")};console.log("Using registration code...");let{data:e,error:s}=await d.rpc("use_registration_code",{p_code:t.registration_code,p_user_id:l.user.id});if(s||!e.success)return console.error("Registration code error:",s||e.error),n("登録番号が無効または既に使用されています。"),m.current=!1,r(!1),{error:Error("Invalid registration code")};console.log("Creating client profile..."),console.log("Client profile data:",{user_id:l.user.id,company_name:t.company_name,industry:t.industry});try{let{error:e}=await d.from("client_profiles").insert([{user_id:l.user.id,company_name:t.company_name,industry:t.industry}]);if(e)return console.error("Client profile creation error:",e),console.error("Error details:",{message:e.message,details:e.details,hint:e.hint,code:e.code}),n("クライアントプロファイルの作成に失敗しました: ".concat(e.message)),m.current=!1,r(!1),{error:e};console.log("Client profile created successfully")}catch(e){return console.error("Unexpected error during client profile creation:",e),n("クライアントプロファイルの作成中に予期しないエラーが発生しました。"),m.current=!1,r(!1),{error:e}}}console.log("Waiting for database consistency..."),await new Promise(e=>setTimeout(e,200)),m.current=!1,console.log("Loading user profile after signup...");try{console.log("About to call loadUserProfile for user:",l.user.id),await u(l.user.id),console.log("Profile loaded successfully after signup"),r(!1)}catch(e){console.error("Error loading profile after signup:",e),console.log("Profile load failed, but user was created. Attempting retry..."),setTimeout(async()=>{try{await u(l.user.id),r(!1)}catch(e){console.error("Retry failed:",e),n("プロファイルの読み込みに失敗しました。しばらく待ってから再度お試しください。"),r(!1)}},1e3),r(!1)}console.log("Auto-login after successful signup...");try{let{error:t}=await d.auth.signInWithPassword({email:e,password:s});t?(console.error("Auto-login error:",t),n("アカウントは作成されましたが、自動ログインに失敗しました。手動でログインしてください。")):console.log("Auto-login successful")}catch(e){console.error("Auto-login exception:",e),n("アカウントは作成されましたが、自動ログインに失敗しました。手動でログインしてください。")}}return console.log("Signup process completed successfully"),{data:l,error:o}}catch(e){return console.error("Sign up error:",e),n("アカウント作成に失敗しました。"),m.current=!1,r(!1),{error:e}}},signOut:async()=>{try{if(r(!0),n(null),s(null),i.current=null,x.current=!1,m.current=!1,d){let{error:e}=await d.auth.signOut();e&&console.warn("Supabase signOut error (ignored):",e)}return r(!1),{error:null}}catch(e){return console.error("Sign out error:",e),s(null),i.current=null,x.current=!1,m.current=!1,r(!1),{error:e}}}}};var x=t(2544),u=t(6942),h=t(2377),g=t(5626),p=t(6583),b=t(9865),f=t(3664),j=t(9708),v=t(508),y=t(6485),w=t(9633),N=t(1873),_=t(1871),k=t(8415);let S=()=>(0,r.jsxs)("div",{className:"absolute inset-0 flex flex-col",children:[(0,r.jsx)("div",{className:"flex-1 flex overflow-hidden",children:(0,r.jsxs)(k.P.div,{className:"flex flex-shrink-0",animate:{x:["0%","-50%"]},transition:{duration:100,repeat:1/0,ease:"linear"},children:[(0,r.jsxs)("div",{className:"flex flex-shrink-0",children:[(0,r.jsx)("div",{className:"w-[50vw] h-full flex-shrink-0",children:(0,r.jsx)("img",{src:"/x1.png",alt:"Image 1",className:"w-full h-full object-cover opacity-20"})}),(0,r.jsx)("div",{className:"w-[50vw] h-full flex-shrink-0",children:(0,r.jsx)("img",{src:"/x2.png",alt:"Image 2",className:"w-full h-full object-cover opacity-20"})}),(0,r.jsx)("div",{className:"w-[50vw] h-full flex-shrink-0",children:(0,r.jsx)("img",{src:"/x3.png",alt:"Image 3",className:"w-full h-full object-cover opacity-20"})}),(0,r.jsx)("div",{className:"w-[50vw] h-full flex-shrink-0",children:(0,r.jsx)("img",{src:"/x4.png",alt:"Image 4",className:"w-full h-full object-cover opacity-20"})}),(0,r.jsx)("div",{className:"w-[50vw] h-full flex-shrink-0",children:(0,r.jsx)("img",{src:"/x5.png",alt:"Image 5",className:"w-full h-full object-cover opacity-20"})}),(0,r.jsx)("div",{className:"w-[50vw] h-full flex-shrink-0",children:(0,r.jsx)("img",{src:"/x6.png",alt:"Image 6",className:"w-full h-full object-cover opacity-20"})}),(0,r.jsx)("div",{className:"w-[50vw] h-full flex-shrink-0",children:(0,r.jsx)("img",{src:"/x7.png",alt:"Image 7",className:"w-full h-full object-cover opacity-20"})})]}),(0,r.jsxs)("div",{className:"flex flex-shrink-0",children:[(0,r.jsx)("div",{className:"w-[50vw] h-full flex-shrink-0",children:(0,r.jsx)("img",{src:"/x1.png",alt:"Image 1",className:"w-full h-full object-cover opacity-20"})}),(0,r.jsx)("div",{className:"w-[50vw] h-full flex-shrink-0",children:(0,r.jsx)("img",{src:"/x2.png",alt:"Image 2",className:"w-full h-full object-cover opacity-20"})}),(0,r.jsx)("div",{className:"w-[50vw] h-full flex-shrink-0",children:(0,r.jsx)("img",{src:"/x3.png",alt:"Image 3",className:"w-full h-full object-cover opacity-20"})}),(0,r.jsx)("div",{className:"w-[50vw] h-full flex-shrink-0",children:(0,r.jsx)("img",{src:"/x4.png",alt:"Image 4",className:"w-full h-full object-cover opacity-20"})}),(0,r.jsx)("div",{className:"w-[50vw] h-full flex-shrink-0",children:(0,r.jsx)("img",{src:"/x5.png",alt:"Image 5",className:"w-full h-full object-cover opacity-20"})}),(0,r.jsx)("div",{className:"w-[50vw] h-full flex-shrink-0",children:(0,r.jsx)("img",{src:"/x6.png",alt:"Image 6",className:"w-full h-full object-cover opacity-20"})}),(0,r.jsx)("div",{className:"w-[50vw] h-full flex-shrink-0",children:(0,r.jsx)("img",{src:"/x7.png",alt:"Image 7",className:"w-full h-full object-cover opacity-20"})})]})]})}),(0,r.jsx)("div",{className:"flex-1 flex overflow-hidden",children:(0,r.jsxs)(k.P.div,{className:"flex flex-shrink-0",animate:{x:["0%","-50%"]},transition:{duration:100,repeat:1/0,ease:"linear"},children:[(0,r.jsxs)("div",{className:"flex flex-shrink-0",children:[(0,r.jsx)("div",{className:"w-[50vw] h-full flex-shrink-0",children:(0,r.jsx)("img",{src:"/x8.png",alt:"Image 8",className:"w-full h-full object-cover opacity-20"})}),(0,r.jsx)("div",{className:"w-[50vw] h-full flex-shrink-0",children:(0,r.jsx)("img",{src:"/x9.png",alt:"Image 9",className:"w-full h-full object-cover opacity-20"})}),(0,r.jsx)("div",{className:"w-[50vw] h-full flex-shrink-0",children:(0,r.jsx)("img",{src:"/x10.png",alt:"Image 10",className:"w-full h-full object-cover opacity-20"})}),(0,r.jsx)("div",{className:"w-[50vw] h-full flex-shrink-0",children:(0,r.jsx)("img",{src:"/x11.png",alt:"Image 11",className:"w-full h-full object-cover opacity-20"})}),(0,r.jsx)("div",{className:"w-[50vw] h-full flex-shrink-0",children:(0,r.jsx)("img",{src:"/x12.png",alt:"Image 12",className:"w-full h-full object-cover opacity-20"})}),(0,r.jsx)("div",{className:"w-[50vw] h-full flex-shrink-0",children:(0,r.jsx)("img",{src:"/x13.png",alt:"Image 13",className:"w-full h-full object-cover opacity-20"})}),(0,r.jsx)("div",{className:"w-[50vw] h-full flex-shrink-0",children:(0,r.jsx)("img",{src:"/x14.png",alt:"Image 14",className:"w-full h-full object-cover opacity-20"})})]}),(0,r.jsxs)("div",{className:"flex flex-shrink-0",children:[(0,r.jsx)("div",{className:"w-[50vw] h-full flex-shrink-0",children:(0,r.jsx)("img",{src:"/x8.png",alt:"Image 8",className:"w-full h-full object-cover opacity-20"})}),(0,r.jsx)("div",{className:"w-[50vw] h-full flex-shrink-0",children:(0,r.jsx)("img",{src:"/x9.png",alt:"Image 9",className:"w-full h-full object-cover opacity-20"})}),(0,r.jsx)("div",{className:"w-[50vw] h-full flex-shrink-0",children:(0,r.jsx)("img",{src:"/x10.png",alt:"Image 10",className:"w-full h-full object-cover opacity-20"})}),(0,r.jsx)("div",{className:"w-[50vw] h-full flex-shrink-0",children:(0,r.jsx)("img",{src:"/x11.png",alt:"Image 11",className:"w-full h-full object-cover opacity-20"})}),(0,r.jsx)("div",{className:"w-[50vw] h-full flex-shrink-0",children:(0,r.jsx)("img",{src:"/x12.png",alt:"Image 12",className:"w-full h-full object-cover opacity-20"})}),(0,r.jsx)("div",{className:"w-[50vw] h-full flex-shrink-0",children:(0,r.jsx)("img",{src:"/x13.png",alt:"Image 13",className:"w-full h-full object-cover opacity-20"})}),(0,r.jsx)("div",{className:"w-[50vw] h-full flex-shrink-0",children:(0,r.jsx)("img",{src:"/x14.png",alt:"Image 14",className:"w-full h-full object-cover opacity-20"})})]})]})})]}),q=["北海道","青森県","岩手県","宮城県","秋田県","山形県","福島県","茨城県","栃木県","群馬県","埼玉県","千葉県","東京都","神奈川県","新潟県","富山県","石川県","福井県","山梨県","長野県","岐阜県","静岡県","愛知県","三重県","滋賀県","京都府","大阪府","兵庫県","奈良県","和歌山県","鳥取県","島根県","岡山県","広島県","山口県","徳島県","香川県","愛媛県","高知県","福岡県","佐賀県","長崎県","熊本県","大分県","宮崎県","鹿児島県","沖縄県"],C=h.Ik({email:h.Yj().email("有効なメールアドレスを入力してください"),password:h.Yj().min(6,"パスワードは6文字以上で入力してください")}),A=h.Ik({email:h.Yj().email("有効なメールアドレスを入力してください"),password:h.Yj().min(6,"パスワードは6文字以上で入力してください"),name:h.Yj().min(1,"名前を入力してください"),role:h.k5(["monitor","client"])}),E=A.extend({age:h.ai().min(18).max(100).optional(),gender:h.k5(["male","female","other"]).optional(),occupation:h.Yj().optional(),location:h.Yj().optional(),faculty:h.Yj().optional(),department:h.Yj().optional()}),P=A.extend({registration_code:h.Yj().min(1,"登録番号を入力してください"),company_name:h.Yj().min(1,"会社名を入力してください"),industry:h.Yj().min(1,"業界を入力してください")}),I=e=>{let{onBack:s}=e,[t,l]=(0,a.useState)(!1),[n,o]=(0,a.useState)(!1),[i,h]=(0,a.useState)(null),[A,I]=(0,a.useState)("monitor"),[D,z]=(0,a.useState)(!1),[R,T]=(0,a.useState)(!1),[U,F]=(0,a.useState)(!1),[L,M]=(0,a.useState)(null),{signIn:Q,signUp:O}=m(),G=(0,x.mN)({resolver:(0,u.u)(C)}),J=(0,x.mN)({resolver:(0,u.u)(E),defaultValues:{role:"monitor",occupation:"学生"}}),W=(0,x.mN)({resolver:(0,u.u)(P),defaultValues:{role:"client"}}),B="monitor"===A?J:W,V=t?B:G,Y=async e=>{if(!c)return void h("Supabaseが設定されていません。右上の「Connect to Supabase」ボタンをクリックしてください。");o(!0),h(null),console.log("=== SIGN IN FORM SUBMIT ==="),console.log("Email:",e.email),console.log("Password length:",e.password.length);let{error:s}=await Q(e.email,e.password);console.log("Sign in result:",{error:s}),s?(console.error("Sign in error in form:",s),"Invalid login credentials"===s.message?h("メールアドレスまたはパスワードが正しくありません。"):h(s.message),o(!1)):console.log("Sign in successful in form")},$=async e=>{if(e.trim()){T(!0),h(null),console.log("=== 登録番号確認開始 ==="),console.log("入力された登録番号:",'"'.concat(e.trim(),'"'));try{if(!d){h("データベースに接続できません。"),F(!1),M(null);return}console.log("データベースから全ての登録番号を取得中...");let{data:s,error:t}=await d.from("client_registration_codes").select("*");if(t){console.error("データベースエラー:",t),h("データベースの読み込みに失敗しました。"),F(!1),M(null);return}if(console.log("取得した全登録番号:",(null==s?void 0:s.length)||0,"件"),s&&s.length>0&&(console.log("=== codeカラムの確認 ==="),s.forEach((e,s)=>{var t;console.log("登録番号 ".concat(s+1,":"),{id:e.id,code:e.code,codeType:typeof e.code,codeLength:null==(t=e.code)?void 0:t.length,company_name:e.company_name,is_used:e.is_used})})),!s||0===s.length){console.log("登録番号が1件も見つかりません"),h("登録番号データが存在しません。管理者にお問い合わせください。"),F(!1),M(null);return}let r=e.trim();console.log("検索対象:",'"'.concat(r,'"')),s.forEach((e,s)=>{console.log("登録番号 ".concat(s+1,': "').concat(e.code,'" (使用済み: ').concat(e.is_used,")"))});let a=s.find(e=>e.code&&e.code.trim()===r);if(!a){console.log("一致する登録番号が見つかりません"),console.log("入力値の詳細分析:"),console.log("- 長さ:",r.length),console.log("- 文字コード:",r.split("").map(e=>e.charCodeAt(0)));let e=s.map(e=>'"'.concat(e.code,'"')).join(", "),t='登録番号データが見つかりませんでした。\n・ユーザーが入力した値: "'.concat(r,'"\n・DBから取得したリスト: [').concat(e,"]\n管理者にお問い合わせください。");h(t),F(!1),M(null);return}console.log("一致する登録番号が見つかりました:",a),a.is_used?(console.log("登録番号は既に使用済みです"),h("この登録番号は既に使用されています。"),F(!1),M(null)):(console.log("登録番号は有効で未使用です"),F(!0),M({company_name:a.company_name,industry:a.industry}),W.setValue("company_name",a.company_name),W.setValue("industry",a.industry),console.log("登録番号確認成功"),h(null))}catch(e){console.error("登録番号確認エラー:",e),h("登録番号の確認中にエラーが発生しました。"),F(!1),M(null)}finally{T(!1)}}},H=async e=>{if(!c)return void h("Supabaseが設定されていません。右上の「Connect to Supabase」ボタンをクリックしてください。");if(!D)return void h("プライバシーポリシーに同意してください。");if("client"===A&&!U)return void h("登録番号を確認してください。");o(!0),h(null);try{let{error:s}=await O(e.email,e.password,e);s&&(h(s.message||"アカウント作成に失敗しました。"),o(!1))}catch(e){h("予期しないエラーが発生しました。"),o(!1)}};return(0,r.jsxs)("div",{className:"min-h-screen relative w-full bg-white flex items-center justify-center overflow-hidden",children:[(0,r.jsx)(S,{}),(0,r.jsxs)(k.P.button,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5},onClick:s,className:"absolute top-8 left-8 z-30 flex items-center space-x-2 text-gray-600 hover:text-orange-600 transition-colors group",children:[(0,r.jsx)(g.A,{className:"w-5 h-5 group-hover:-translate-x-1 transition-transform"}),(0,r.jsx)("span",{children:"戻る"})]}),(0,r.jsx)("div",{className:"relative z-20 w-full max-w-md mx-auto px-4",children:(0,r.jsxs)(k.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8},className:"bg-white/80 backdrop-blur-sm rounded-2xl border border-orange-100 p-8 shadow-xl",children:[(0,r.jsxs)("div",{className:"text-center mb-8",children:[(0,r.jsx)(k.P.div,{initial:{scale:0},animate:{scale:1},transition:{duration:.5,delay:.2},className:"bg-gradient-to-br from-orange-500 to-orange-600 rounded-full p-3 w-16 h-16 mx-auto mb-4 flex items-center justify-center shadow-lg",children:t?(0,r.jsx)(p.A,{className:"w-8 h-8 text-white"}):(0,r.jsx)(b.A,{className:"w-8 h-8 text-white"})}),(0,r.jsx)("h1",{className:"text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-orange-600 to-orange-500 mb-2",children:t?"アカウントを作成":"ログイン"}),(0,r.jsx)("p",{className:"text-gray-600",children:"アンケートツールへようこそ"})]}),i&&(0,r.jsx)(k.P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:(0,r.jsx)("p",{className:"text-red-600 text-sm",style:{whiteSpace:"pre-wrap"},children:i})}),(0,r.jsxs)("form",{onSubmit:V.handleSubmit(t?H:Y),className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"メールアドレス"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(f.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,r.jsx)("input",{type:"email",...V.register("email"),className:"w-full pl-10 pr-4 py-3 bg-white border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 placeholder-gray-400",placeholder:"your@email.com"})]}),V.formState.errors.email&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:V.formState.errors.email.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"パスワード"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(j.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,r.jsx)("input",{type:"password",...V.register("password"),className:"w-full pl-10 pr-4 py-3 bg-white border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 placeholder-gray-400",placeholder:"パスワードを入力"})]}),V.formState.errors.password&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:V.formState.errors.password.message})]}),t&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"お名前"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(v.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,r.jsx)("input",{type:"text",...B.register("name"),className:"w-full pl-10 pr-4 py-3 bg-white border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 placeholder-gray-400",placeholder:"お名前を入力"})]}),B.formState.errors.name&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:B.formState.errors.name.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"登録タイプ"}),(0,r.jsxs)("div",{className:"p-3 bg-orange-50 border border-orange-200 rounded-lg",children:[(0,r.jsx)("span",{className:"text-sm font-medium text-gray-800",children:"モニター"}),(0,r.jsx)("div",{className:"text-xs text-orange-600 font-medium mt-1",children:"\uD83C\uDF81 新規登録で100ポイント"})]})]}),"monitor"===A&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"年齢"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(y.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,r.jsx)("input",{type:"number",...J.register("age",{valueAsNumber:!0}),className:"w-full pl-10 pr-4 py-3 bg-white border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 placeholder-gray-400",placeholder:"年齢を入力"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"性別"}),(0,r.jsxs)("select",{...J.register("gender"),className:"w-full px-4 py-3 bg-white border border-gray-200 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-gray-900",children:[(0,r.jsx)("option",{value:"",children:"選択してください"}),(0,r.jsx)("option",{value:"male",children:"男性"}),(0,r.jsx)("option",{value:"female",children:"女性"}),(0,r.jsx)("option",{value:"other",children:"その他"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"職業"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(w.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,r.jsx)("div",{className:"w-full pl-10 pr-4 py-3 bg-gray-100 border border-gray-200 rounded-lg text-gray-700",children:"学生"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"居住地"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(N.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,r.jsxs)("select",{...J.register("location"),className:"w-full pl-10 pr-4 py-3 bg-white border border-gray-200 rounded-lg appearance-none focus:ring-2 focus:ring-orange-500 focus:border-transparent text-gray-900",children:[(0,r.jsx)("option",{value:"",children:"選択してください"}),q.map(e=>(0,r.jsx)("option",{value:e,children:e},e))]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"学部"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(_.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,r.jsx)("input",{type:"text",...J.register("faculty"),className:"w-full pl-10 pr-4 py-3 bg-white border border-gray-200 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-gray-900 placeholder-gray-400",placeholder:"学部を入力（例：工学部）"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"学科"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(w.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,r.jsx)("input",{type:"text",...J.register("department"),className:"w-full pl-10 pr-4 py-3 bg-white border border-gray-200 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-gray-900 placeholder-gray-400",placeholder:"学科を入力（例：情報工学科）"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"出身地"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(N.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,r.jsxs)("select",{...J.register("hometown"),className:"w-full pl-10 pr-4 py-3 bg-white border border-gray-200 rounded-lg appearance-none focus:ring-2 focus:ring-orange-500 focus:border-transparent text-gray-900",children:[(0,r.jsx)("option",{value:"",children:"選択してください"}),q.map(e=>(0,r.jsx)("option",{value:e,children:e},e))]})]})]})]}),"client"===A&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["登録番号 ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(_.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,r.jsx)("input",{type:"text",...W.register("registration_code"),className:"w-full pl-10 pr-20 py-3 bg-white border rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-gray-900 placeholder-gray-400 ".concat(U?"border-green-300 bg-green-50":"border-gray-200"),placeholder:"登録番号を入力",onChange:e=>{W.setValue("registration_code",e.target.value),U&&(F(!1),M(null))}}),(0,r.jsx)("button",{type:"button",onClick:()=>$(W.getValues("registration_code")),disabled:R||!W.getValues("registration_code"),className:"absolute right-2 top-1/2 transform -translate-y-1/2 bg-orange-600 hover:bg-orange-700 text-white px-3 py-1 rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:R?"確認中...":U?"確認済み":"確認"})]}),W.formState.errors.registration_code&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:W.formState.errors.registration_code.message}),U&&L&&(0,r.jsx)("div",{className:"mt-2 p-3 bg-green-50 border border-green-200 rounded-lg",children:(0,r.jsxs)("p",{className:"text-green-800 text-sm",children:["✓ 登録番号が確認されました: ",L.company_name]})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"会社名"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(_.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,r.jsx)("input",{type:"text",...W.register("company_name"),className:"w-full pl-10 pr-4 py-3 bg-white border border-gray-200 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-gray-900 placeholder-gray-400 ".concat(U?"bg-gray-100":""),placeholder:"会社名を入力",readOnly:U})]}),W.formState.errors.company_name&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:W.formState.errors.company_name.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"業界"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(w.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,r.jsx)("input",{type:"text",...W.register("industry"),className:"w-full pl-10 pr-4 py-3 bg-white border border-gray-200 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-gray-900 placeholder-gray-400 ".concat(U?"bg-gray-100":""),placeholder:"業界を入力",readOnly:U})]}),W.formState.errors.industry&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:W.formState.errors.industry.message})]})]}),(0,r.jsx)("div",{className:"space-y-3",children:(0,r.jsxs)("label",{className:"flex items-start p-4 bg-white/5 border border-white/10 rounded-lg cursor-pointer hover:bg-white/10 transition-colors",children:[(0,r.jsx)("input",{type:"checkbox",checked:D,onChange:e=>z(e.target.checked),className:"mr-3 mt-1 text-orange-500 flex-shrink-0",required:!0}),(0,r.jsxs)("span",{className:"text-sm text-gray-700 leading-relaxed",children:[(0,r.jsx)("a",{href:"/privacy-policy.html",target:"_blank",rel:"noopener noreferrer",className:"text-orange-600 hover:text-orange-700 underline font-medium",children:"プライバシーポリシー"}),"に同意します。個人情報の取り扱いについて確認し、同意の上でアカウントを作成してください。"]})]})})]}),(0,r.jsx)("button",{type:"submit",disabled:n||t&&!D,className:"w-full bg-gradient-to-r from-orange-600 to-orange-500 hover:from-orange-700 hover:to-orange-600 text-white py-3 px-4 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2 transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl",children:n?(0,r.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}):(0,r.jsxs)(r.Fragment,{children:[t?(0,r.jsx)(p.A,{className:"w-5 h-5"}):(0,r.jsx)(b.A,{className:"w-5 h-5"}),(0,r.jsx)("span",{children:t?"アカウント作成":"ログイン"})]})})]}),(0,r.jsx)("div",{className:"mt-6 text-center",children:(0,r.jsx)("button",{onClick:()=>l(!t),className:"text-orange-600 hover:text-orange-500 text-sm font-medium transition-colors",children:t?"すでにアカウントをお持ちの方はこちら":"新規アカウント作成"})})]})}),(0,r.jsx)("div",{className:"absolute bottom-0 w-full h-32 bg-gradient-to-t from-gray-50 to-transparent"})]})};var D=t(2987);let z=e=>{let{onGetStarted:s}=e;return(0,r.jsxs)("div",{className:"min-h-screen relative w-full flex flex-col items-center justify-center overflow-hidden bg-white",children:[(0,r.jsx)(S,{}),(0,r.jsxs)("div",{className:"relative z-20 text-center mb-8 bg-white/50 backdrop-blur-sm p-8 rounded-2xl shadow-xl",children:[(0,r.jsxs)(k.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,delay:.1},className:"mb-6",children:[(0,r.jsx)("h1",{className:"text-5xl md:text-7xl lg:text-8xl font-bold text-orange-500 mb-4",children:"声キャン！"}),(0,r.jsx)("div",{className:"w-32 h-1 bg-gradient-to-r from-orange-500 to-orange-400 mx-auto mb-6 rounded-full"})]}),(0,r.jsxs)(k.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,delay:.2},className:"space-y-2",children:[(0,r.jsx)("p",{className:"text-xl md:text-2xl text-gray-700 font-semibold",children:"ポイ活しながら、キャリア相談ができる！"}),(0,r.jsx)("p",{className:"text-lg md:text-xl text-orange-500 font-semibold",children:"あなたの声が未来を作る、新しいプラットフォーム"})]})]}),(0,r.jsx)(k.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,delay:.3},className:"relative z-20",children:(0,r.jsxs)("button",{onClick:s,className:"group relative bg-gradient-to-r from-orange-600 to-orange-500 hover:from-orange-700 hover:to-orange-600 text-white font-semibold py-4 px-10 rounded-full text-lg transition-all duration-300 transform hover:scale-105 shadow-xl hover:shadow-2xl flex items-center space-x-3",children:[(0,r.jsx)("span",{children:"今すぐ始める"}),(0,r.jsx)(D.A,{className:"w-5 h-5 group-hover:translate-x-1 transition-transform"}),(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-orange-400/20 to-orange-300/20 rounded-full blur-xl group-hover:blur-2xl transition-all duration-300"})]})})]})};var R=t(1169),T=t(7816),U=t(2472),F=t(5937),L=t(4926),M=t(9347),Q=t(709),O=t(9715),G=t(6983),J=t(1524),W=t(5229),B=t(8519),V=t(368),Y=t(318),$=t(6429),H=t(8504),K=t(2821),Z=t(5889);function X(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,Z.QP)((0,K.$)(s))}var ee=t(8344);let es=e=>{let{id:s,className:t,background:l,minSize:n,maxSize:o,speed:i,particleColor:c,particleDensity:d}=e,[m,x]=(0,a.useState)(!1),[u,h]=(0,a.useState)(!1);(0,a.useEffect)(()=>{(0,$.iC)(async e=>{await (0,H.m)(e)}).then(()=>{x(!0)})},[]);let g=(0,ee.s)();(0,a.useEffect)(()=>{u&&g.start({opacity:1,transition:{duration:1}})},[u,g]);let p=async e=>{e&&h(!0)},b=(0,a.useId)();return(0,r.jsx)(k.P.div,{animate:g,className:X("opacity-0",t),children:m&&(0,r.jsx)($.Ay,{id:s||b,className:X("h-full w-full"),particlesLoaded:p,options:{background:{color:{value:l||"#0d47a1"}},fullScreen:{enable:!1,zIndex:1},fpsLimit:120,interactivity:{events:{onClick:{enable:!0,mode:"push"},onHover:{enable:!1,mode:"repulse"},resize:!0},modes:{push:{quantity:4},repulse:{distance:200,duration:.4}}},particles:{bounce:{horizontal:{value:1},vertical:{value:1}},collisions:{absorb:{speed:2},bounce:{horizontal:{value:1},vertical:{value:1}},enable:!1,maxSpeed:50,mode:"bounce",overlap:{enable:!0,retries:0}},color:{value:c||"#ffffff",animation:{h:{count:0,enable:!1,speed:1,decay:0,delay:0,sync:!0,offset:0},s:{count:0,enable:!1,speed:1,decay:0,delay:0,sync:!0,offset:0},l:{count:0,enable:!1,speed:1,decay:0,delay:0,sync:!0,offset:0}}},effect:{close:!0,fill:!0,options:{},type:{}},groups:{},move:{angle:{offset:0,value:90},attract:{distance:200,enable:!1,rotate:{x:3e3,y:3e3}},center:{x:50,y:50,mode:"percent",radius:0},decay:0,distance:{},direction:"none",drift:0,enable:!0,gravity:{acceleration:9.81,enable:!1,inverse:!1,maxSpeed:50},path:{clamp:!0,delay:{value:0},enable:!1,options:{}},outModes:{default:"out"},random:!1,size:!1,speed:{min:.1,max:1},spin:{acceleration:0,enable:!1},straight:!1,trail:{enable:!1,length:10,fill:{}},vibrate:!1,warp:!1},number:{density:{enable:!0,width:400,height:400},limit:{mode:"delete",value:0},value:d||120},opacity:{value:{min:.1,max:1},animation:{count:0,enable:!0,speed:i||4,decay:0,delay:0,sync:!1,mode:"auto",startValue:"random",destroy:"none"}},reduceDuplicates:!1,shadow:{blur:0,color:{value:"#000"},enable:!1,offset:{x:0,y:0}},shape:{close:!0,fill:!0,options:{},type:"circle"},size:{value:{min:n||1,max:o||3},animation:{count:0,enable:!1,speed:5,decay:0,delay:0,sync:!1,mode:"auto",startValue:"random",destroy:"none"}},stroke:{width:0},zIndex:{value:0,opacityRate:1,sizeRate:1,velocityRate:1},destroy:{bounds:{},mode:"none",split:{count:1,factor:{value:3},rate:{value:{min:4,max:9}},sizeOffset:!0}},roll:{darken:{enable:!1,value:0},enable:!1,enlighten:{enable:!1,value:0},mode:"vertical",speed:25},tilt:{value:0,animation:{enable:!1,speed:0,decay:0,sync:!1},direction:"clockwise",enable:!1},twinkle:{lines:{enable:!1,frequency:.05,opacity:1},particles:{enable:!1,frequency:.05,opacity:1}},wobble:{distance:5,enable:!1,speed:{angle:50,move:10}},life:{count:0,delay:{value:0,sync:!1},duration:{value:0,sync:!1}},rotate:{value:0,animation:{enable:!1,speed:0,decay:0,sync:!1},direction:"clockwise",path:!1},orbit:{animation:{count:0,enable:!1,speed:1,decay:0,delay:0,sync:!1},enable:!1,opacity:1,rotation:{value:45},width:1},links:{blink:!1,color:{value:"#fff"},consent:!1,distance:100,enable:!1,frequency:1,opacity:1,shadow:{blur:5,color:{value:"#000"},enable:!1},triangles:{enable:!1,frequency:1},width:1,warp:!1},repulse:{value:0,enabled:!1,distance:1,duration:1,factor:1,speed:1}},detectRetina:!0}})})};var et=t(3457),er=t(6046);let ea=e=>{let{onClose:s,user:t,onProfileUpdate:l}=e,[n,o]=(0,a.useState)(!1),[i,c]=(0,a.useState)("basic"),[m,x]=(0,a.useState)({gender_detail:"",grade:"",hometown:"",school_name:"",faculty_department:"",interested_industries:[],interested_job_types:[],preferred_work_areas:[],company_selection_criteria_1:"",company_selection_criteria_2:"",company_selection_criteria_3:"",important_benefits_1:"",important_benefits_2:"",important_benefits_3:"",dealbreaker_points_1:"",dealbreaker_points_2:"",dealbreaker_points_3:"",fulfilling_work_state:"",job_hunting_start_time:"",desired_company_info:"",work_satisfaction_moments:"",info_sources:"",helpful_info_sources_1:"",helpful_info_sources_2:"",helpful_info_sources_3:"",sns_company_account_usage:"",memorable_sns_content:"",frequently_used_sns:[],company_research_focus:"",positive_selection_experience:"",selection_improvement_suggestions:"",memorable_recruitment_content:""});(0,a.useEffect)(()=>{if(null==t?void 0:t.profile){let e=t.profile;x({gender_detail:e.gender_detail||"",grade:e.grade||"",hometown:e.hometown||"",school_name:e.school_name||"",faculty_department:e.faculty_department||"",interested_industries:e.interested_industries||[],interested_job_types:e.interested_job_types||[],preferred_work_areas:e.preferred_work_areas||[],company_selection_criteria_1:e.company_selection_criteria_1||"",company_selection_criteria_2:e.company_selection_criteria_2||"",company_selection_criteria_3:e.company_selection_criteria_3||"",important_benefits_1:e.important_benefits_1||"",important_benefits_2:e.important_benefits_2||"",important_benefits_3:e.important_benefits_3||"",dealbreaker_points_1:e.dealbreaker_points_1||"",dealbreaker_points_2:e.dealbreaker_points_2||"",dealbreaker_points_3:e.dealbreaker_points_3||"",fulfilling_work_state:e.fulfilling_work_state||"",job_hunting_start_time:e.job_hunting_start_time||"",desired_company_info:e.desired_company_info||"",work_satisfaction_moments:e.work_satisfaction_moments||"",info_sources:e.info_sources||"",helpful_info_sources_1:e.helpful_info_sources_1||"",helpful_info_sources_2:e.helpful_info_sources_2||"",helpful_info_sources_3:e.helpful_info_sources_3||"",sns_company_account_usage:e.sns_company_account_usage||"",memorable_sns_content:e.memorable_sns_content||"",frequently_used_sns:e.frequently_used_sns||[],company_research_focus:e.company_research_focus||"",positive_selection_experience:e.positive_selection_experience||"",selection_improvement_suggestions:e.selection_improvement_suggestions||"",memorable_recruitment_content:e.memorable_recruitment_content||""})}},[t]);let u=(e,s)=>{let t=s.split(",").map(e=>e.trim()).filter(e=>e);x(s=>({...s,[e]:t}))},h=async e=>{e.preventDefault(),o(!0);try{let{error:e}=await d.from("monitor_profiles").update(m).eq("user_id",null==t?void 0:t.id);if(e)throw e;l(),s()}catch(e){console.error("Error updating profile:",e),alert("プロフィールの更新に失敗しました。")}finally{o(!1)}},g=["給与・待遇","仕事内容","企業の安定性","成長性","職場環境","福利厚生","勤務地","企業理念・価値観","社会貢献度","ワークライフバランス","研修制度","キャリアアップの機会","企業規模","業界の将来性"],p=["健康保険","厚生年金","有給休暇","育児休暇","介護休暇","住宅手当","交通費支給","退職金制度","社員食堂","フレックスタイム","リモートワーク","資格取得支援","社員旅行","慶弔見舞金","財形貯蓄","社内託児所"],b=["長時間労働","パワハラ・セクハラ","給与の低さ","昇進機会の少なさ","職場の人間関係","仕事内容のミスマッチ","企業の将来性への不安","福利厚生の不備","研修制度の不足","ワークライフバランスの悪さ","評価制度の不透明さ","転勤の多さ","残業代の未払い","職場環境の悪さ"],f=["企業ホームページ","就職情報サイト","合同説明会","個別説明会","OB・OG訪問","インターンシップ","SNS","口コミサイト","大学のキャリアセンター","友人・知人","新聞・雑誌","テレビ・ラジオ"];return(0,r.jsx)("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50",children:(0,r.jsxs)(k.P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-white/10 backdrop-blur-md rounded-2xl border border-white/20 p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto shadow-2xl",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-white",children:"プロフィール設定"}),(0,r.jsx)("p",{className:"text-sm text-neutral-300",children:"就職活動に関する詳細情報を入力してください"})]}),(0,r.jsx)("button",{onClick:s,className:"text-neutral-400 hover:text-white transition-colors",children:(0,r.jsx)(W.A,{className:"w-6 h-6"})})]}),(0,r.jsx)("div",{className:"border-b border-white/20 mb-6",children:(0,r.jsxs)("nav",{className:"flex space-x-8",children:[(0,r.jsxs)("button",{onClick:()=>c("basic"),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat("basic"===i?"border-blue-400 text-blue-400":"border-transparent text-neutral-400 hover:text-neutral-300"),children:[(0,r.jsx)(v.A,{className:"w-4 h-4 inline mr-2"}),"基本情報"]}),(0,r.jsxs)("button",{onClick:()=>c("career"),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat("career"===i?"border-blue-400 text-blue-400":"border-transparent text-neutral-400 hover:text-neutral-300"),children:[(0,r.jsx)(w.A,{className:"w-4 h-4 inline mr-2"}),"キャリア志向"]}),(0,r.jsxs)("button",{onClick:()=>c("preferences"),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat("preferences"===i?"border-blue-400 text-blue-400":"border-transparent text-neutral-400 hover:text-neutral-300"),children:[(0,r.jsx)(et.A,{className:"w-4 h-4 inline mr-2"}),"就活情報"]})]})}),(0,r.jsxs)("form",{onSubmit:h,className:"space-y-6",children:["basic"===i&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-white mb-4",children:"基本情報"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"Q1. 性別"}),(0,r.jsxs)("select",{value:m.gender_detail,onChange:e=>x(s=>({...s,gender_detail:e.target.value})),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-white",children:[(0,r.jsx)("option",{value:"",className:"bg-slate-800",children:"選択してください"}),(0,r.jsx)("option",{value:"男性",className:"bg-slate-800",children:"男性"}),(0,r.jsx)("option",{value:"女性",className:"bg-slate-800",children:"女性"}),(0,r.jsx)("option",{value:"その他",className:"bg-slate-800",children:"その他"}),(0,r.jsx)("option",{value:"回答しない",className:"bg-slate-800",children:"回答しない"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"Q2. 学年"}),(0,r.jsxs)("select",{value:m.grade,onChange:e=>x(s=>({...s,grade:e.target.value})),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-white",children:[(0,r.jsx)("option",{value:"",className:"bg-slate-800",children:"選択してください"}),(0,r.jsx)("option",{value:"大学1年生",className:"bg-slate-800",children:"大学1年生"}),(0,r.jsx)("option",{value:"大学2年生",className:"bg-slate-800",children:"大学2年生"}),(0,r.jsx)("option",{value:"大学3年生",className:"bg-slate-800",children:"大学3年生"}),(0,r.jsx)("option",{value:"大学4年生",className:"bg-slate-800",children:"大学4年生"}),(0,r.jsx)("option",{value:"修士1年生",className:"bg-slate-800",children:"修士1年生"}),(0,r.jsx)("option",{value:"修士2年生",className:"bg-slate-800",children:"修士2年生"}),(0,r.jsx)("option",{value:"博士課程",className:"bg-slate-800",children:"博士課程"}),(0,r.jsx)("option",{value:"その他",className:"bg-slate-800",children:"その他"})]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"Q3. 出身地"}),(0,r.jsxs)("select",{value:m.hometown,onChange:e=>x(s=>({...s,hometown:e.target.value})),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-white",children:[(0,r.jsx)("option",{value:"",className:"bg-slate-800",children:"選択してください"}),(0,r.jsx)("option",{value:"北海道",className:"bg-slate-800",children:"北海道"}),(0,r.jsx)("option",{value:"青森県",className:"bg-slate-800",children:"青森県"}),(0,r.jsx)("option",{value:"岩手県",className:"bg-slate-800",children:"岩手県"}),(0,r.jsx)("option",{value:"宮城県",className:"bg-slate-800",children:"宮城県"}),(0,r.jsx)("option",{value:"秋田県",className:"bg-slate-800",children:"秋田県"}),(0,r.jsx)("option",{value:"山形県",className:"bg-slate-800",children:"山形県"}),(0,r.jsx)("option",{value:"福島県",className:"bg-slate-800",children:"福島県"}),(0,r.jsx)("option",{value:"茨城県",className:"bg-slate-800",children:"茨城県"}),(0,r.jsx)("option",{value:"栃木県",className:"bg-slate-800",children:"栃木県"}),(0,r.jsx)("option",{value:"群馬県",className:"bg-slate-800",children:"群馬県"}),(0,r.jsx)("option",{value:"埼玉県",className:"bg-slate-800",children:"埼玉県"}),(0,r.jsx)("option",{value:"千葉県",className:"bg-slate-800",children:"千葉県"}),(0,r.jsx)("option",{value:"東京都",className:"bg-slate-800",children:"東京都"}),(0,r.jsx)("option",{value:"神奈川県",className:"bg-slate-800",children:"神奈川県"}),(0,r.jsx)("option",{value:"新潟県",className:"bg-slate-800",children:"新潟県"}),(0,r.jsx)("option",{value:"富山県",className:"bg-slate-800",children:"富山県"}),(0,r.jsx)("option",{value:"石川県",className:"bg-slate-800",children:"石川県"}),(0,r.jsx)("option",{value:"福井県",className:"bg-slate-800",children:"福井県"}),(0,r.jsx)("option",{value:"山梨県",className:"bg-slate-800",children:"山梨県"}),(0,r.jsx)("option",{value:"長野県",className:"bg-slate-800",children:"長野県"}),(0,r.jsx)("option",{value:"岐阜県",className:"bg-slate-800",children:"岐阜県"}),(0,r.jsx)("option",{value:"静岡県",className:"bg-slate-800",children:"静岡県"}),(0,r.jsx)("option",{value:"愛知県",className:"bg-slate-800",children:"愛知県"}),(0,r.jsx)("option",{value:"三重県",className:"bg-slate-800",children:"三重県"}),(0,r.jsx)("option",{value:"滋賀県",className:"bg-slate-800",children:"滋賀県"}),(0,r.jsx)("option",{value:"京都府",className:"bg-slate-800",children:"京都府"}),(0,r.jsx)("option",{value:"大阪府",className:"bg-slate-800",children:"大阪府"}),(0,r.jsx)("option",{value:"兵庫県",className:"bg-slate-800",children:"兵庫県"}),(0,r.jsx)("option",{value:"奈良県",className:"bg-slate-800",children:"奈良県"}),(0,r.jsx)("option",{value:"和歌山県",className:"bg-slate-800",children:"和歌山県"}),(0,r.jsx)("option",{value:"鳥取県",className:"bg-slate-800",children:"鳥取県"}),(0,r.jsx)("option",{value:"島根県",className:"bg-slate-800",children:"島根県"}),(0,r.jsx)("option",{value:"岡山県",className:"bg-slate-800",children:"岡山県"}),(0,r.jsx)("option",{value:"広島県",className:"bg-slate-800",children:"広島県"}),(0,r.jsx)("option",{value:"山口県",className:"bg-slate-800",children:"山口県"}),(0,r.jsx)("option",{value:"徳島県",className:"bg-slate-800",children:"徳島県"}),(0,r.jsx)("option",{value:"香川県",className:"bg-slate-800",children:"香川県"}),(0,r.jsx)("option",{value:"愛媛県",className:"bg-slate-800",children:"愛媛県"}),(0,r.jsx)("option",{value:"高知県",className:"bg-slate-800",children:"高知県"}),(0,r.jsx)("option",{value:"福岡県",className:"bg-slate-800",children:"福岡県"}),(0,r.jsx)("option",{value:"佐賀県",className:"bg-slate-800",children:"佐賀県"}),(0,r.jsx)("option",{value:"長崎県",className:"bg-slate-800",children:"長崎県"}),(0,r.jsx)("option",{value:"熊本県",className:"bg-slate-800",children:"熊本県"}),(0,r.jsx)("option",{value:"大分県",className:"bg-slate-800",children:"大分県"}),(0,r.jsx)("option",{value:"宮崎県",className:"bg-slate-800",children:"宮崎県"}),(0,r.jsx)("option",{value:"鹿児島県",className:"bg-slate-800",children:"鹿児島県"}),(0,r.jsx)("option",{value:"沖縄県",className:"bg-slate-800",children:"沖縄県"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"Q4. 所属学校"}),(0,r.jsx)("input",{type:"text",value:m.school_name,onChange:e=>x(s=>({...s,school_name:e.target.value})),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-white placeholder-neutral-400",placeholder:"例: ○○大学"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"Q5. 所属学部・学科"}),(0,r.jsx)("input",{type:"text",value:m.faculty_department,onChange:e=>x(s=>({...s,faculty_department:e.target.value})),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-white placeholder-neutral-400",placeholder:"例: 経済学部 経済学科"})]})]}),"career"===i&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-white mb-4",children:"キャリア志向"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"Q6. 興味のある業界（複数選択可、カンマ区切り）"}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:["メーカー（製造業）","小売・流通","サービス業","IT・インターネット","広告・マスコミ・出版","金融・保険","建設・不動産","医療・福祉","教育・公務","物流・運輸","商社","エネルギー・インフラ","ベンチャー／スタートアップ","特に決まっていない／わからない","その他"].map(e=>(0,r.jsxs)("label",{className:"flex items-center p-2 bg-white/5 border border-white/10 rounded-lg cursor-pointer hover:bg-white/10 transition-colors",children:[(0,r.jsx)("input",{type:"checkbox",checked:m.interested_industries.includes(e),onChange:s=>{let t,r=m.interested_industries;t=s.target.checked?[...r,e]:r.filter(s=>s!==e),x(e=>({...e,interested_industries:t}))},className:"mr-2 text-orange-500"}),(0,r.jsx)("span",{className:"text-sm text-neutral-300",children:e})]},e))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"Q7. 興味のある職種（複数選択可、カンマ区切り）"}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:["サービス・接客業","営業・販売職","事務・オフィスワーク","製造・技術職","IT・クリエイティブ職","教育・医療・福祉","物流・運輸業","公務員・安定志向の職業","特に決まっていない／わからない","その他"].map(e=>(0,r.jsxs)("label",{className:"flex items-center p-2 bg-white/5 border border-white/10 rounded-lg cursor-pointer hover:bg-white/10 transition-colors",children:[(0,r.jsx)("input",{type:"checkbox",checked:m.interested_job_types.includes(e),onChange:s=>{let t,r=m.interested_job_types;t=s.target.checked?[...r,e]:r.filter(s=>s!==e),x(e=>({...e,interested_job_types:t}))},className:"mr-2 text-blue-500"}),(0,r.jsx)("span",{className:"text-sm text-neutral-300",children:e})]},e))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"Q8. 就職希望エリア（複数選択可、カンマ区切り）"}),(0,r.jsx)("input",{type:"text",value:m.preferred_work_areas.join(", "),onChange:e=>u("preferred_work_areas",e.target.value),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-white placeholder-neutral-400",placeholder:"例: 東京都, 大阪府, 全国"})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300",children:"Q9. 企業を選ぶ際に重視するポイントは？（上位3つ）"}),(0,r.jsx)("div",{className:"grid grid-cols-1 gap-3",children:[1,2,3].map(e=>(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-xs text-neutral-400 mb-1",children:["[",e,"位]"]}),(0,r.jsxs)("select",{value:m["company_selection_criteria_".concat(e)],onChange:s=>x(t=>({...t,["company_selection_criteria_".concat(e)]:s.target.value})),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-white",children:[(0,r.jsx)("option",{value:"",className:"bg-slate-800",children:"選択してください"}),g.map(e=>(0,r.jsx)("option",{value:e,className:"bg-slate-800",children:e},e))]})]},e))})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300",children:"Q10. 特に重視する福利厚生は？（上位3つ）"}),(0,r.jsx)("div",{className:"grid grid-cols-1 gap-3",children:[1,2,3].map(e=>(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-xs text-neutral-400 mb-1",children:["[",e,"位]"]}),(0,r.jsxs)("select",{value:m["important_benefits_".concat(e)],onChange:s=>x(t=>({...t,["important_benefits_".concat(e)]:s.target.value})),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-white",children:[(0,r.jsx)("option",{value:"",className:"bg-slate-800",children:"選択してください"}),p.map(e=>(0,r.jsx)("option",{value:e,className:"bg-slate-800",children:e},e))]})]},e))})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300",children:"Q11. この項目が充実していないと嫌だなと感じるポイントは？（上位3つ）"}),(0,r.jsx)("div",{className:"grid grid-cols-1 gap-3",children:[1,2,3].map(e=>(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-xs text-neutral-400 mb-1",children:["[",e,"位]"]}),(0,r.jsxs)("select",{value:m["dealbreaker_points_".concat(e)],onChange:s=>x(t=>({...t,["dealbreaker_points_".concat(e)]:s.target.value})),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-white",children:[(0,r.jsx)("option",{value:"",className:"bg-slate-800",children:"選択してください"}),b.map(e=>(0,r.jsx)("option",{value:e,className:"bg-slate-800",children:e},e))]})]},e))})]})]}),"preferences"===i&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-white mb-4",children:"就活情報・SNS"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"Q12. 生き生き働いていると感じるのは、どのような状態だと思いますか？"}),(0,r.jsx)("textarea",{value:m.fulfilling_work_state,onChange:e=>x(s=>({...s,fulfilling_work_state:e.target.value})),rows:3,className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-white placeholder-neutral-400",placeholder:"自由にお答えください"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"Q13. 就活を始めた時期を教えてください"}),(0,r.jsxs)("select",{value:m.job_hunting_start_time,onChange:e=>x(s=>({...s,job_hunting_start_time:e.target.value})),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-white",children:[(0,r.jsx)("option",{value:"",className:"bg-slate-800",children:"選択してください"}),(0,r.jsx)("option",{value:"大学1年生",className:"bg-slate-800",children:"大学1年生"}),(0,r.jsx)("option",{value:"大学2年生",className:"bg-slate-800",children:"大学2年生"}),(0,r.jsx)("option",{value:"大学3年生の春",className:"bg-slate-800",children:"大学3年生の春"}),(0,r.jsx)("option",{value:"大学3年生の夏",className:"bg-slate-800",children:"大学3年生の夏"}),(0,r.jsx)("option",{value:"大学3年生の秋",className:"bg-slate-800",children:"大学3年生の秋"}),(0,r.jsx)("option",{value:"大学3年生の冬",className:"bg-slate-800",children:"大学3年生の冬"}),(0,r.jsx)("option",{value:"大学4年生",className:"bg-slate-800",children:"大学4年生"}),(0,r.jsx)("option",{value:"まだ始めていない",className:"bg-slate-800",children:"まだ始めていない"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"Q14. 会社のHPやSNSの採用アカウントで知りたい内容は？"}),(0,r.jsx)("textarea",{value:m.desired_company_info,onChange:e=>x(s=>({...s,desired_company_info:e.target.value})),rows:3,className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-white placeholder-neutral-400",placeholder:"知りたい情報を自由にお答えください"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"Q15. あなたが「働きがい」を感じるのはどんなときですか？"}),(0,r.jsx)("textarea",{value:m.work_satisfaction_moments,onChange:e=>x(s=>({...s,work_satisfaction_moments:e.target.value})),rows:3,className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-white placeholder-neutral-400",placeholder:"働きがいを感じる瞬間について教えてください"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"Q16. 企業情報はどこで入手しますか？"}),(0,r.jsx)("textarea",{value:m.info_sources,onChange:e=>x(s=>({...s,info_sources:e.target.value})),rows:2,className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-white placeholder-neutral-400",placeholder:"情報収集方法を教えてください"})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300",children:"Q17. 就職活動で特に参考になった情報源は？（上位3つ）"}),(0,r.jsx)("div",{className:"grid grid-cols-1 gap-3",children:[1,2,3].map(e=>(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-xs text-neutral-400 mb-1",children:["[",e,"位]"]}),(0,r.jsxs)("select",{value:m["helpful_info_sources_".concat(e)],onChange:s=>x(t=>({...t,["helpful_info_sources_".concat(e)]:s.target.value})),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-white",children:[(0,r.jsx)("option",{value:"",className:"bg-slate-800",children:"選択してください"}),f.map(e=>(0,r.jsx)("option",{value:e,className:"bg-slate-800",children:e},e))]})]},e))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"Q18. SNSで企業アカウントを見たことがありますか？"}),(0,r.jsxs)("select",{value:m.sns_company_account_usage,onChange:e=>x(s=>({...s,sns_company_account_usage:e.target.value})),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-white",children:[(0,r.jsx)("option",{value:"",className:"bg-slate-800",children:"選択してください"}),(0,r.jsx)("option",{value:"よく見る",className:"bg-slate-800",children:"よく見る"}),(0,r.jsx)("option",{value:"たまに見る",className:"bg-slate-800",children:"たまに見る"}),(0,r.jsx)("option",{value:"あまり見ない",className:"bg-slate-800",children:"あまり見ない"}),(0,r.jsx)("option",{value:"見たことがない",className:"bg-slate-800",children:"見たことがない"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"Q19. 印象に残っている企業のSNS投稿があれば、その内容を教えてください。"}),(0,r.jsx)("textarea",{value:m.memorable_sns_content,onChange:e=>x(s=>({...s,memorable_sns_content:e.target.value})),rows:3,className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-white placeholder-neutral-400",placeholder:"印象に残った投稿内容があれば教えてください"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"Q20. 週5日以上使用するSNSをすべて教えてください。（複数選択可、カンマ区切り）"}),(0,r.jsx)("input",{type:"text",value:m.frequently_used_sns.join(", "),onChange:e=>u("frequently_used_sns",e.target.value),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-white placeholder-neutral-400",placeholder:"例: Instagram, Twitter, LINE"}),(0,r.jsxs)("div",{className:"text-xs text-neutral-400 mt-1",children:["選択肢: ","Instagram, Twitter(X), Facebook, LinkedIn, TikTok, YouTube, LINE, Discord, Clubhouse, Pinterest, Snapchat"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"Q21. 就職を考えている企業の何を見ますか？"}),(0,r.jsx)("textarea",{value:m.company_research_focus,onChange:e=>x(s=>({...s,company_research_focus:e.target.value})),rows:3,className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-white placeholder-neutral-400",placeholder:"企業研究で重視する点を教えてください"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"Q22. 選考過程で「この企業は良い」と感じたポイントは何でしたか？"}),(0,r.jsx)("textarea",{value:m.positive_selection_experience,onChange:e=>x(s=>({...s,positive_selection_experience:e.target.value})),rows:3,className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-white placeholder-neutral-400",placeholder:"良いと感じた選考体験があれば教えてください"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"Q23. 説明会や選考過程で「もっとこうしてほしい」と感じる点はありますか？"}),(0,r.jsx)("textarea",{value:m.selection_improvement_suggestions,onChange:e=>x(s=>({...s,selection_improvement_suggestions:e.target.value})),rows:3,className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-white placeholder-neutral-400",placeholder:"改善してほしい点があれば教えてください"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"Q24. 企業の採用ホームページで印象に残っている内容があれば、業界とその内容を教えてください。"}),(0,r.jsx)("textarea",{value:m.memorable_recruitment_content,onChange:e=>x(s=>({...s,memorable_recruitment_content:e.target.value})),rows:3,className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-white placeholder-neutral-400",placeholder:"印象に残った採用コンテンツがあれば教えてください"})]})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-4 pt-6 border-t border-white/20",children:[(0,r.jsx)("button",{type:"button",onClick:s,className:"px-4 py-2 text-neutral-300 border border-white/20 rounded-lg hover:bg-white/10 transition-colors",children:"キャンセル"}),(0,r.jsx)("button",{type:"submit",disabled:n,className:"px-4 py-2 bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 transform hover:scale-105 flex items-center space-x-2",children:n?(0,r.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(er.A,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:"保存"})]})})]})]})]})})};var el=t(9141),en=t(890),eo=t(4747),ei=t(8085),ec=t(1408);let ed=e=>{let{onClose:s,user:t,initialRoomId:l}=e,[n,o]=(0,a.useState)([]),[i,c]=(0,a.useState)(""),[m,x]=(0,a.useState)(!0),[u,h]=(0,a.useState)(null),[g,p]=(0,a.useState)([]),b=(0,a.useRef)(null);(0,a.useEffect)(()=>{t&&(j(),y())},[t]),(0,a.useEffect)(()=>{f()},[n]);let f=()=>{var e;null==(e=b.current)||e.scrollIntoView({behavior:"smooth"})},j=async()=>{if(t)try{console.log("Fetching support chat room for user...");let{data:e,error:s}=await d.from("chat_rooms").select("*").eq("room_type","support").contains("participants",[t.id]).order("updated_at",{ascending:!1});if(s)throw s;if(console.log("Found existing support rooms:",e),e&&e.length>0){if(p(e),l){let s=e.find(e=>e.id===l);if(s){console.log("Setting initial room as active:",s),h(s),v(s.id);return}}console.log("Setting support room as active:",e[0]),h(e[0]),v(e[0].id)}else console.log("No existing support room found. User needs to apply for career consultation first."),p([]),h(null)}catch(e){console.error("Error fetching chat rooms:",e)}finally{x(!1)}},v=async e=>{try{let{data:s,error:t}=await d.from("chat_messages").select("\n          *,\n          sender:users!chat_messages_sender_id_fkey(*)\n        ").eq("room_id",e).order("created_at",{ascending:!0}).limit(50);if(t)throw t;if(o(s||[]),(null==s?void 0:s.some(e=>e.message&&e.message.includes("【キャリア相談申込】")))&&s&&s.length>0){let t=s.find(e=>e.message&&e.message.includes("【キャリア相談申込】"));if(t){let s=t.message.match(/お名前:\s*([^\n\r]+)/);s&&s[1]&&N(e,"シーエイト")}}}catch(e){console.error("Error fetching messages:",e)}},y=()=>{if(!u)return;let e=d.channel("chat_room_".concat(u.id)).on("postgres_changes",{event:"INSERT",schema:"public",table:"chat_messages",filter:"room_id=eq.".concat(u.id)},async e=>{let s=e.new;if(s.sender_id===(null==t?void 0:t.id))return;let{data:r}=await d.from("users").select("*").eq("id",s.sender_id).single();r&&(s.sender=r),o(e=>[...e,s])}).subscribe();return()=>{e.unsubscribe()}},w=async()=>{if(i.trim()&&t&&u)try{let e=i.trim(),s={id:"temp-".concat(Date.now()),room_id:u.id,sender_id:t.id,message:e,message_type:"text",is_read:!1,created_at:new Date().toISOString(),sender:{name:t.name,email:t.email}};o(e=>[...e,s]),c("");let{data:r,error:a}=await d.from("chat_messages").insert([{sender_id:t.id,room_id:u.id,message:e,message_type:"text",is_read:!1}]).select().single();if(a)throw a;r&&o(e=>e.map(e=>e.id===s.id?{...r,sender:{name:t.name,email:t.email}}:e))}catch(e){console.error("Error sending message:",e),o(e=>e.filter(e=>!e.id.startsWith("temp-"))),alert("メッセージの送信に失敗しました。もう一度お試しください。")}},N=async(e,s)=>{try{let{error:t}=await d.from("chat_rooms").update({name:s}).eq("id",e);if(t)throw t;p(t=>t.map(t=>t.id===e?{...t,name:s}:t)),(null==u?void 0:u.id)===e&&h(e=>e?{...e,name:s}:null)}catch(e){console.error("Error updating room name:",e)}},_=async e=>{if(t)try{let{error:s}=await d.from("chat_rooms").delete().eq("id",e);if(s)throw s;if((null==u?void 0:u.id)===e){let s=g.filter(s=>s.id!==e);s.length>0?(h(s[0]),v(s[0].id)):h(null)}p(s=>s.filter(s=>s.id!==e))}catch(e){console.error("Error deleting room:",e)}};return m?(0,r.jsx)("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})}):(0,r.jsx)("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50",children:(0,r.jsxs)(k.P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-white rounded-2xl w-full max-w-4xl h-[80vh] flex shadow-2xl overflow-hidden",children:[(0,r.jsxs)("div",{className:"w-80 bg-gray-50 border-r border-gray-200 flex flex-col",children:[(0,r.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsxs)("h2",{className:"text-lg font-semibold text-gray-800 flex items-center",children:[(0,r.jsx)(F.A,{className:"w-5 h-5 mr-2 text-orange-600"}),"チャット"]}),(0,r.jsx)("button",{onClick:s,className:"text-gray-500 hover:text-gray-700 transition-colors",children:(0,r.jsx)(W.A,{className:"w-5 h-5"})})]})}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,r.jsxs)("div",{className:"p-4",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-600 mb-3",children:"キャリア相談サポート"}),(0,r.jsx)("div",{className:"space-y-2",children:g.map(e=>(0,r.jsxs)("button",{onClick:()=>{h(e),v(e.id)},className:"w-full flex items-center p-3 rounded-lg transition-colors text-left ".concat((null==u?void 0:u.id)===e.id?"bg-orange-100 border border-orange-200":"hover:bg-gray-100"),children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-orange-500 to-orange-600 rounded-full flex items-center justify-center text-white text-sm font-medium mr-3",children:"S"}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-800 truncate",children:e.name||"キャリア相談サポート"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 truncate",children:"キャリア相談チャット"})]}),g.length>1&&(0,r.jsx)("button",{onClick:s=>{s.stopPropagation(),_(e.id)},className:"text-red-500 hover:text-red-700 p-1",title:"チャットルームを削除",children:(0,r.jsx)(W.A,{className:"w-4 h-4"})})]},e.id))})]})})]}),(0,r.jsx)("div",{className:"flex-1 flex flex-col",children:u?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"p-4 border-b border-gray-200 bg-white",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-orange-500 to-orange-600 rounded-full flex items-center justify-center text-white text-sm font-medium mr-3",children:"S"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-medium text-gray-800",children:u.name||"キャリア相談サポート"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"サポートスタッフが対応します"})]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("button",{className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",children:(0,r.jsx)(el.A,{className:"w-5 h-5"})}),(0,r.jsx)("button",{className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",children:(0,r.jsx)(en.A,{className:"w-5 h-5"})}),(0,r.jsx)("button",{className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",children:(0,r.jsx)(eo.A,{className:"w-5 h-5"})})]})]})}),(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[(0,r.jsx)(ec.N,{children:n.map(e=>{var s;return(0,r.jsx)(k.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex ".concat(e.sender_id===(null==t?void 0:t.id)?"justify-end":"justify-start"),children:(0,r.jsxs)("div",{className:"max-w-xs lg:max-w-md ".concat(e.sender_id===(null==t?void 0:t.id)?"order-2":"order-1"),children:[(0,r.jsx)("div",{className:"px-4 py-2 rounded-2xl ".concat(e.sender_id===(null==t?void 0:t.id)?"bg-gradient-to-r from-orange-600 to-orange-500 text-white":"bg-gray-100 text-gray-800"),children:(0,r.jsx)("div",{className:"text-sm whitespace-pre-wrap",children:e.message})}),(0,r.jsxs)("div",{className:"flex items-center mt-1 space-x-2 ".concat(e.sender_id===(null==t?void 0:t.id)?"justify-end":"justify-start"),children:[e.sender_id!==(null==t?void 0:t.id)&&(0,r.jsx)("span",{className:"text-xs text-gray-500",children:null==(s=e.sender)?void 0:s.name}),(0,r.jsx)("span",{className:"text-xs text-gray-400",children:new Date(e.created_at).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"})})]})]})},e.id)})}),(0,r.jsx)("div",{ref:b})]}),(0,r.jsx)("div",{className:"p-4 border-t border-gray-200 bg-white",children:(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"flex-1 relative",children:(0,r.jsx)("textarea",{value:i,onChange:e=>c(e.target.value),onKeyPress:e=>{if("Enter"===e.key)return},placeholder:"メッセージを入力... (Enterで改行、送信ボタンで送信)",className:"w-full px-4 py-3 border border-gray-200 rounded-2xl focus:ring-2 focus:ring-orange-500 focus:border-transparent resize-none",rows:1,style:{minHeight:"44px",maxHeight:"120px"}})}),(0,r.jsx)("button",{onClick:w,disabled:!i.trim(),className:"bg-gradient-to-r from-orange-600 to-orange-500 hover:from-orange-700 hover:to-orange-600 text-white p-3 rounded-2xl disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl",children:(0,r.jsx)(ei.A,{className:"w-5 h-5"})})]})})]}):(0,r.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)(F.A,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-500 mb-2",children:"キャリア相談の申込が必要です"}),(0,r.jsx)("p",{className:"text-sm text-gray-400",children:"キャリア相談を申し込むと、サポートスタッフとのチャットが開始されます"})]})})})]})})};var em=t(799),ex=t(7937);let eu=e=>{var s,t;let{onClose:l,user:n,onChatOpen:o,initialServiceId:i}=e,[c,m]=(0,a.useState)(i||null),[x,u]=(0,a.useState)({consultationType:i||"",message:"",name:(null==n?void 0:n.name)||"",email:(null==n?void 0:n.email)||""}),[h,g]=(0,a.useState)(!1),[p,b]=(0,a.useState)(!1),[f,j]=(0,a.useState)(!1),v=[{id:"career-planning",title:"就職活動全般相談",description:"就活の進め方、業界研究、企業選びなど",duration:"60分",icon:(0,r.jsx)(R.A,{className:"w-6 h-6"}),color:"from-blue-500 to-blue-600"},{id:"resume-review",title:"ES添削",description:"エントリーシート、履歴書の書き方指導",duration:"45分",icon:(0,r.jsx)(em.A,{className:"w-6 h-6"}),color:"from-green-500 to-green-600"},{id:"cv-review",title:"履歴書添削",description:"履歴書のブラッシュアップ",duration:"45分",icon:(0,r.jsx)(ex.A,{className:"w-6 h-6"}),color:"from-yellow-500 to-yellow-600"},{id:"interview-prep",title:"面接対策",description:"模擬面接、面接マナー、質問対策",duration:"60分",icon:(0,r.jsx)(F.A,{className:"w-6 h-6"}),color:"from-purple-500 to-purple-600"},{id:"industry-research",title:"業界・企業研究",description:"業界動向、企業分析、職種理解",duration:"45分",icon:(0,r.jsx)(y.A,{className:"w-6 h-6"}),color:"from-orange-500 to-orange-600"}],w=async e=>{e.preventDefault(),g(!0);try{let{data:e,error:s}=await d.from("users").select("id").eq("email","support@example.com").single();if(s)throw console.error("Error fetching support user:",s),s;if(!e)throw console.error("Support user not found"),Error("Support user not found");let{data:t}=await d.from("chat_rooms").select("*").eq("room_type","support").contains("participants",[null==n?void 0:n.id]).maybeSingle(),r=null==t?void 0:t.id;if(t){if(!t.participants.includes(e.id)){let{error:s}=await d.from("chat_rooms").update({participants:[...t.participants,e.id]}).eq("id",t.id);if(s)throw s}}else{let{data:s,error:t}=await d.from("chat_rooms").insert([{name:"キャリア相談サポート",room_type:"support",participants:[null==n?void 0:n.id,e.id],created_by:null==n?void 0:n.id}]).select().single();if(t)throw t;r=s.id,setCreatedRoomId(s.id)}let a=v.find(e=>e.id===c),l="【キャリア相談申込】\n\n相談内容: ".concat(null==a?void 0:a.title,"\nお名前: ").concat(x.name,"\nメールアドレス: ").concat(x.email,"\n\n詳細・質問:\n").concat(x.message||"特になし","\n\nよろしくお願いいたします。"),{error:i}=await d.from("chat_messages").insert([{sender_id:null==n?void 0:n.id,room_id:r,message:l,message_type:"text",is_read:!1}]);if(i)throw i;b(!0),setTimeout(()=>{o?o(r):j(!0)},2e3)}catch(e){console.error("Error submitting career consultation:",e),alert("相談申込の送信に失敗しました。もう一度お試しください。")}finally{g(!1)}};return p?(0,r.jsxs)("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50",children:[(0,r.jsx)(k.P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-white rounded-2xl p-8 w-full max-w-md shadow-2xl",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"bg-gradient-to-br from-green-500 to-green-600 rounded-full p-4 w-20 h-20 mx-auto mb-6 flex items-center justify-center shadow-lg",children:(0,r.jsx)(F.A,{className:"w-10 h-10 text-white"})}),(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"相談申込を送信しました！"}),(0,r.jsxs)("p",{className:"text-gray-600 mb-6",children:["チャットで担当カウンセラーからご連絡いたします。",(0,r.jsx)("br",{}),(0,r.jsx)("br",{}),"2秒後にチャット画面が自動的に開きます。",(0,r.jsx)("br",{}),"チャット画面でやり取りを続けることができます。"]}),(0,r.jsxs)("div",{className:"flex space-x-4 justify-center",children:[(0,r.jsxs)("button",{onClick:()=>{l(),j(!0)},className:"bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white px-6 py-3 rounded-lg transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl flex items-center space-x-2",children:[(0,r.jsx)(F.A,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:"チャットを開く"})]}),(0,r.jsx)("button",{onClick:l,className:"bg-gradient-to-r from-gray-600 to-gray-500 hover:from-gray-700 hover:to-gray-600 text-white px-6 py-3 rounded-lg transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl",children:"閉じる"})]})]})}),f&&(0,r.jsx)(ed,{onClose:()=>j(!1),user:n})]}):(0,r.jsx)("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50",children:(0,r.jsxs)(k.P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-white rounded-2xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto shadow-2xl",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"キャリア相談"}),(0,r.jsx)("p",{className:"text-gray-600",children:"専門カウンセラーによる無料相談"})]}),(0,r.jsx)("button",{onClick:l,className:"text-gray-500 hover:text-gray-700 transition-colors",children:(0,r.jsx)(W.A,{className:"w-6 h-6"})})]}),c?(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:null==(s=v.find(e=>e.id===c))?void 0:s.title}),(0,r.jsx)("p",{className:"text-gray-600",children:null==(t=v.find(e=>e.id===c))?void 0:t.description})]}),(0,r.jsxs)("form",{onSubmit:w,className:"space-y-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["お名前 ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("input",{type:"text",value:x.name,onChange:e=>u(s=>({...s,name:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["メールアドレス ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("input",{type:"email",value:x.email,onChange:e=>u(s=>({...s,email:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"詳細・質問内容"}),(0,r.jsx)("textarea",{value:x.message,onChange:e=>u(s=>({...s,message:e.target.value})),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"具体的な相談内容や質問があれば記入してください（任意）"})]}),(0,r.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[(0,r.jsx)("h4",{className:"font-medium text-green-900 mb-2",children:"\uD83D\uDCAC チャット相談の流れ"}),(0,r.jsxs)("ul",{className:"text-sm text-blue-800 space-y-1",children:[(0,r.jsx)("li",{children:"1. 申込内容がチャットで送信されます"}),(0,r.jsx)("li",{children:"2. 担当カウンセラーがチャットで返信"}),(0,r.jsx)("li",{children:"3. チャットでリアルタイムに相談"}),(0,r.jsx)("li",{children:"4. 必要に応じて資料やリンクを共有"})]})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,r.jsx)("button",{type:"button",onClick:l,className:"px-6 py-3 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"キャンセル"}),(0,r.jsx)("button",{type:"submit",disabled:h,className:"px-6 py-3 bg-gradient-to-r from-green-600 to-green-500 hover:from-green-700 hover:to-green-600 text-white rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl flex items-center space-x-2",children:h?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),(0,r.jsx)("span",{children:"送信中..."})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(F.A,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:"チャットで相談申込"})]})})]})]})]}):(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"相談内容を選択してください"}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:v.map(e=>(0,r.jsx)("button",{onClick:()=>m(e.id),className:"group bg-white border border-gray-200 rounded-xl p-6 hover:border-gray-300 hover:shadow-lg transition-all duration-300 text-left",children:(0,r.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,r.jsx)("div",{className:"bg-gradient-to-br ".concat(e.color," rounded-full p-3 flex items-center justify-center shadow-lg group-hover:shadow-xl transition-all duration-300"),children:e.icon}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h4",{className:"font-semibold text-gray-800 mb-2",children:e.title}),(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:e.description}),(0,r.jsxs)("div",{className:"flex items-center text-sm text-gray-500",children:[(0,r.jsx)(G.A,{className:"w-4 h-4 mr-1"}),(0,r.jsx)("span",{children:e.duration})]})]})]})},e.id))})]})]})})};function eh(e){var s,t,l,n,o;let{survey:i,onClose:c,onSubmit:d}=e,[m,x]=(0,a.useState)([]),[u,h]=(0,a.useState)(0),[g,p]=(0,a.useState)({}),b=i.questions[u],f=u===i.questions.length-1,j=e=>{let s=[...m];s[u]={question_id:b.id,...e},x(s)},v=(e,s)=>{p(t=>({...t,[e]:s}));let t=m[e];if(t){let r=[...m];r[e]={...t,other_text:s},x(r)}};return(0,r.jsx)("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50",children:(0,r.jsxs)(k.P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-white/10 backdrop-blur-md rounded-2xl border border-white/20 p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-2xl",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-white",children:i.title}),(0,r.jsxs)("p",{className:"text-sm text-neutral-300",children:["質問 ",u+1," / ",i.questions.length]})]}),(0,r.jsx)("button",{onClick:c,className:"text-neutral-400 hover:text-white transition-colors",children:(0,r.jsx)(W.A,{className:"w-6 h-6"})})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("div",{className:"w-full bg-white/20 rounded-full h-2 mb-4",children:(0,r.jsx)("div",{className:"bg-gradient-to-r from-orange-500 to-orange-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat((u+1)/i.questions.length*100,"%")}})}),(0,r.jsx)("h3",{className:"text-lg font-medium mb-4 text-white",children:b.question_text}),(0,r.jsxs)("div",{className:"space-y-3",children:["text"===b.question_type&&(0,r.jsx)("textarea",{className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-white placeholder-neutral-400",rows:4,placeholder:"回答を入力してください",value:(null==(s=m[u])?void 0:s.answer_text)||"",onChange:e=>j({answer_text:e.target.value})}),"multiple_choice"===b.question_type&&(0,r.jsx)("div",{className:"space-y-2",children:b.is_multiple_select||"ranking"===b.question_type?(0,r.jsxs)("div",{className:"space-y-3",children:[(3===b.max_selections||"ranking"===b.question_type)&&(0,r.jsx)("div",{className:"bg-orange-500/10 border border-orange-500/20 rounded-lg p-3 mb-4",children:(0,r.jsx)("p",{className:"text-orange-300 text-sm",children:"\uD83D\uDCCA 以下の選択肢から上位3位を選んでください（順位は問いません）"})}),null==(t=b.options)?void 0:t.map((e,s)=>{var t,a,l,n,o,i,c,d,x,h;return(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"flex items-center p-3 bg-white/5 border border-white/10 rounded-lg hover:bg-white/10 transition-colors cursor-pointer",children:[(0,r.jsx)("input",{type:"checkbox",value:e,checked:(null==(a=m[u])||null==(t=a.answer_options)?void 0:t.includes(e))||!1,onChange:s=>{var t;let r,a=(null==(t=m[u])?void 0:t.answer_options)||[];if(s.target.checked){let s=b.max_selections||("ranking"===b.question_type?3:void 0);if(s&&a.length>=s)return;r=[...a,e]}else r=a.filter(s=>s!==e);j({answer_options:r})},className:"mr-3 text-orange-500",disabled:(b.max_selections||("ranking"===b.question_type?3:void 0))&&!(null==(n=m[u])||null==(l=n.answer_options)?void 0:l.includes(e))&&((null==(i=m[u])||null==(o=i.answer_options)?void 0:o.length)||0)>=(b.max_selections||3)}),(0,r.jsx)("span",{className:"text-white",children:e}),(b.max_selections||("ranking"===b.question_type?3:void 0))&&!(null==(d=m[u])||null==(c=d.answer_options)?void 0:c.includes(e))&&((null==(h=m[u])||null==(x=h.answer_options)?void 0:x.length)||0)>=(b.max_selections||3)&&(0,r.jsxs)("span",{className:"ml-auto text-xs text-gray-400",children:["（上限",b.max_selections||3,"つ）"]})]}),e.includes("その他")&&(e=>{if("その他"!==e)return!1;let s=m[u];if(!s)return!1;if(b.is_multiple_select){var t;return(null==(t=s.answer_options)?void 0:t.includes("その他"))||!1}return"その他"===s.answer_option})(e)&&(0,r.jsx)("div",{className:"ml-6 mt-2",children:(0,r.jsx)("input",{type:"text",placeholder:"具体的に入力してください",value:g[u]||"",onChange:e=>v(u,e.target.value),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-white placeholder-neutral-400 text-sm"})})]},s)}),(b.max_selections||("ranking"===b.question_type?3:void 0))&&(0,r.jsxs)("div",{className:"text-center text-sm text-neutral-400 mt-2",children:["選択済み: ",(null==(n=m[u])||null==(l=n.answer_options)?void 0:l.length)||0," / ",b.max_selections||3]})]}):(0,r.jsx)("div",{className:"space-y-3",children:null==(o=b.options)?void 0:o.map((e,s)=>{var t,a;return(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"flex items-center p-3 bg-white/5 border border-white/10 rounded-lg hover:bg-white/10 transition-colors cursor-pointer",children:[(0,r.jsx)("input",{type:"radio",name:"multiple_choice",value:e,checked:(null==(t=m[u])?void 0:t.answer_option)===e,onChange:e=>j({answer_option:e.target.value}),className:"mr-3 text-orange-500"}),(0,r.jsx)("span",{className:"text-white",children:e})]}),e.includes("その他")&&(null==(a=m[u])?void 0:a.answer_option)===e&&(0,r.jsx)("div",{className:"ml-6 mt-2",children:(0,r.jsx)("input",{type:"text",placeholder:"具体的に入力してください",value:g[u]||"",onChange:e=>v(u,e.target.value),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-white placeholder-neutral-400 text-sm"})})]},s)})})})]})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("button",{onClick:()=>{u>0&&h(u-1)},disabled:0===u,className:"px-4 py-2 text-neutral-300 border border-white/20 rounded-lg hover:bg-white/10 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"前へ"}),(0,r.jsx)("button",{onClick:()=>{f?d(i.id,m):h(u+1)},disabled:!(()=>{let e=m[u];if(!b.required)return!0;if(!e)return!1;if("multiple_choice"===b.question_type){var s,t,r;if(b.is_multiple_select){if((null==(s=e.answer_options)?void 0:s.includes("その他"))&&!g[u]||(null==(t=e.answer_options)?void 0:t.some(e=>e.includes("その他")))&&!g[u])return!1}else if((null==(r=e.answer_option)?void 0:r.includes("その他"))&&!g[u])return!1}if("multiple_choice"===b.question_type&&(b.is_multiple_select||"ranking"===b.question_type))return e.answer_options&&e.answer_options.length>0;if(b.max_selections||"ranking"===b.question_type){let s=b.max_selections||3;return e.answer_options&&e.answer_options.length===s}return e.answer_text||e.answer_option})(),className:"px-4 py-2 bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 transform hover:scale-105",children:f?"送信":"次へ"})]})]})})}let eg=e=>{let{onClose:s,userEmail:t,currentPoints:l,monitorId:n}=e,[o,i]=(0,a.useState)(null),[c,m]=(0,a.useState)(100),[x,u]=(0,a.useState)(""),[h,g]=(0,a.useState)(""),[p,b]=(0,a.useState)(!1),[f,j]=(0,a.useState)(!1),v=[{type:"paypay",name:"PayPay",icon:"\uD83D\uDCB0",description:"PayPayアカウントに送金",minPoints:500,rate:"1ポイント = 1円"},{type:"amazon",name:"Amazonギフトカード",icon:"\uD83D\uDED2",description:"Amazonギフトカードコード",minPoints:500,rate:"1ポイント = 1円"},{type:"starbucks",name:"スターバックスギフトカード",icon:"☕",description:"スタバギフトカード",minPoints:1e3,rate:"1ポイント = 1円"}],y=v.find(e=>e.type===o),w=async e=>{if(e.preventDefault(),!o||!x.trim())return void alert("すべての項目を入力してください。");if(c>l)return void alert("保有ポイントを超えて交換することはできません。");if(y&&c<y.minPoints)return void alert("".concat(y.name,"は最低").concat(y.minPoints,"ポイントから交換可能です。"));b(!0);try{let{error:e}=await d.from("point_exchange_requests").insert([{monitor_id:n,exchange_type:o,points_amount:c,contact_info:x,notes:h}]);if(e)throw e;j(!0)}catch(e){console.error("Error submitting exchange request:",e),alert("交換依頼の送信に失敗しました。もう一度お試しください。")}finally{b(!1)}};return f?(0,r.jsx)("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50",children:(0,r.jsx)(k.P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-white/10 backdrop-blur-md rounded-2xl border border-white/20 p-6 w-full max-w-md shadow-2xl",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"bg-green-500 rounded-full p-3 w-16 h-16 mx-auto mb-4 flex items-center justify-center",children:(0,r.jsx)(T.A,{className:"w-8 h-8 text-white"})}),(0,r.jsx)("h2",{className:"text-xl font-semibold text-white mb-4",children:"交換依頼を送信しました"}),(0,r.jsxs)("p",{className:"text-neutral-300 mb-6 text-sm leading-relaxed",children:["ポイント交換依頼をデータベースに保存しました。",(0,r.jsx)("br",{}),"管理者が確認後、処理を行います。",(0,r.jsx)("br",{}),"処理完了まで1-3営業日お待ちください。"]}),(0,r.jsx)("button",{onClick:s,className:"bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white px-6 py-2 rounded-lg transition-all duration-300 transform hover:scale-105",children:"閉じる"})]})})}):(0,r.jsx)("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50",children:(0,r.jsxs)(k.P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-white/10 backdrop-blur-md rounded-2xl border border-white/20 p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-2xl",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-white",children:"ポイント交換"}),(0,r.jsxs)("p",{className:"text-sm text-neutral-300",children:["現在のポイント: ",l,"pt"]})]}),(0,r.jsx)("button",{onClick:s,className:"text-neutral-400 hover:text-white transition-colors",children:(0,r.jsx)(W.A,{className:"w-6 h-6"})})]}),(0,r.jsxs)("form",{onSubmit:w,className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300 mb-3",children:"交換先を選択"}),(0,r.jsx)("div",{className:"grid grid-cols-1 gap-3",children:v.map(e=>{let s=l<e.minPoints;return(0,r.jsxs)("label",{className:"flex items-center p-4 bg-white/5 border rounded-lg transition-colors ".concat(s?"opacity-50 cursor-not-allowed border-gray-500":"cursor-pointer hover:bg-white/10"," ").concat(o===e.type?"border-orange-500 bg-orange-500/10":"border-white/10"),children:[(0,r.jsx)("input",{type:"radio",name:"exchangeType",value:e.type,disabled:s,checked:o===e.type,onChange:s=>{i(s.target.value),m(e.minPoints)},className:"sr-only"}),(0,r.jsxs)("div",{className:"flex items-center space-x-3 flex-1",children:[(0,r.jsx)("span",{className:"text-2xl",children:e.icon}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-medium text-white",children:e.name}),(0,r.jsx)("div",{className:"text-sm text-neutral-400",children:e.description}),(0,r.jsxs)("div",{className:"text-xs text-neutral-500",children:["最低",e.minPoints,"pt〜 (",e.rate,")",s&&(0,r.jsxs)("div",{className:"text-xs text-red-400 mt-1",children:["ポイント不足（あと",e.minPoints-l,"pt必要）"]})]})]})]}),o===e.type&&!s&&(0,r.jsx)("div",{className:"w-4 h-4 bg-orange-500 rounded-full flex items-center justify-center",children:(0,r.jsx)("div",{className:"w-2 h-2 bg-white rounded-full"})})]},e.type)})})]}),o&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"交換ポイント数"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{type:"number",value:c,onChange:e=>m(Number(e.target.value)),min:(null==y?void 0:y.minPoints)||100,max:l,step:"100",className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-white placeholder-neutral-400",required:!0}),(0,r.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-neutral-400 text-sm",children:"pt"})]}),(0,r.jsxs)("div",{className:"text-xs text-neutral-400 mt-1",children:["交換金額: ",c,"円相当"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"paypay"===o?"PayPay ID または 電話番号":"amazon"===o?"Amazonアカウントのメールアドレス":"ギフトカード送付先メールアドレス"}),(0,r.jsx)("input",{type:"text",value:x,onChange:e=>u(e.target.value),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-white placeholder-neutral-400",placeholder:"paypay"===o?"例: 090-1234-5678 または PayPay ID":"amazon"===o?"例: amazon@example.com":"例: gift@example.com",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"備考（任意）"}),(0,r.jsx)("textarea",{value:h,onChange:e=>g(e.target.value),rows:3,className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-white placeholder-neutral-400",placeholder:"特別な要望があればご記入ください"})]}),(0,r.jsxs)("div",{className:"bg-yellow-500/10 border border-yellow-500/20 rounded-lg p-4",children:[(0,r.jsx)("h4",{className:"font-medium text-yellow-300 mb-2",children:"⚠️ 注意事項"}),(0,r.jsxs)("ul",{className:"text-sm text-yellow-200 space-y-1",children:[(0,r.jsx)("li",{children:"• 交換処理には1-3営業日かかります"}),(0,r.jsx)("li",{children:"• 交換後のポイントは返却できません"}),(0,r.jsx)("li",{children:"• 連絡先情報は正確に入力してください"}),(0,r.jsx)("li",{children:"• 処理状況は登録メールアドレスにご連絡します"})]})]})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,r.jsx)("button",{type:"button",onClick:s,className:"px-4 py-2 text-neutral-300 border border-white/20 rounded-lg hover:bg-white/10 transition-colors",children:"キャンセル"}),(0,r.jsx)("button",{type:"submit",disabled:!o||p||c>l,className:"px-4 py-2 bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 transform hover:scale-105 flex items-center space-x-2",children:p?(0,r.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(B.A,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:"交換依頼を送信"})]})})]})]})]})})},ep=e=>{let{advertisement:s,onClose:t}=e;return(0,r.jsx)("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,r.jsxs)(k.P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-white/10 backdrop-blur-md rounded-2xl border border-white/20 p-6 w-full max-w-4xl max-h-[90vh] shadow-2xl flex flex-col",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6 flex-shrink-0",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-white",children:s.title}),(0,r.jsx)("button",{onClick:t,className:"text-neutral-400 hover:text-white transition-colors",children:(0,r.jsx)(W.A,{className:"w-6 h-6"})})]}),(0,r.jsxs)("div",{className:"flex-grow overflow-y-auto",children:[s.image_url&&(0,r.jsx)("img",{src:s.image_url,alt:s.title,className:"w-full h-auto max-h-96 object-contain rounded-lg mb-6",onError:e=>{e.currentTarget.style.display="none"}}),s.description&&(0,r.jsx)("p",{className:"text-neutral-300 leading-relaxed whitespace-pre-wrap",children:s.description})]}),s.link_url&&(0,r.jsx)("div",{className:"mt-6 pt-6 border-t border-white/20 flex-shrink-0",children:(0,r.jsx)("a",{href:s.link_url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center bg-gradient-to-r from-orange-600 to-orange-500 hover:from-orange-700 hover:to-orange-600 text-white px-6 py-3 rounded-lg transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl",children:"詳細はこちら"})})]})})},eb=()=>{let{user:e,signOut:s}=m(),[t,l]=(0,a.useState)([]),[n,o]=(0,a.useState)([]),[i,c]=(0,a.useState)([]),[x,u]=(0,a.useState)([]),[h,g]=(0,a.useState)(!0),[p,b]=(0,a.useState)(null),[f,j]=(0,a.useState)(!1),[y,w]=(0,a.useState)(!1),[N,_]=(0,a.useState)(!1),[S,q]=(0,a.useState)(!1),[C,A]=(0,a.useState)("surveys"),[E,P]=(0,a.useState)(null),[I,D]=(0,a.useState)(null),z=[{title:"チャット相談",description:"就活の進め方、業界研究など就職活動全般",icon:(0,r.jsx)(R.A,{className:"w-8 h-8 text-white"}),color:"from-blue-500 to-blue-600"},{title:"ES添削",description:"エントリーシートの書き方指導",icon:(0,r.jsx)(T.A,{className:"w-8 h-8 text-white"}),color:"from-green-500 to-green-600"}];(0,a.useEffect)(()=>{(null==e?void 0:e.id)&&W()},[null==e?void 0:e.id,W]);let W=async()=>{if(!(null==e?void 0:e.id))return void console.log("No user ID available, skipping data fetch");try{var s;g(!0);let{data:t,error:r}=await d.from("surveys").select("\n          *,\n          client:users!surveys_client_id_fkey(name, email),\n          questions(*)\n        ").eq("status","active").order("created_at",{ascending:!1});if(r)throw r;let{data:a,error:n}=await d.from("responses").select("survey_id").eq("monitor_id",null==e?void 0:e.id);if(n)throw n;let i=a.map(e=>e.survey_id),m=t.filter(e=>!i.includes(e.id));l(m);let{data:x,error:h}=await d.from("responses").select("\n          *,\n          survey:surveys(title, points_reward)\n        ").eq("monitor_id",null==e?void 0:e.id).order("completed_at",{ascending:!1});if(h)throw h;o(x||[]);let{data:p,error:b}=await d.from("point_transactions").select("\n          *,\n          survey:surveys(title)\n        ").eq("monitor_id",null==e?void 0:e.id).order("created_at",{ascending:!1}).limit(10);if(b)throw b;c(p||[]);let f=null==e||null==(s=e.profile)?void 0:s.location,{data:j,error:v}=await d.from("advertisements").select("*, target_regions, priority").eq("is_active",!0).order("priority",{ascending:!1}).order("display_order",{ascending:!0});if(v)throw v;let y=j||[];if(f){let e=y.filter(e=>e.target_regions&&e.target_regions.length>0&&e.target_regions.includes(f)),s=y.filter(e=>!e.target_regions||0===e.target_regions.length);y=[...e,...s]}u(y)}catch(e){console.error("Error fetching data:",e)}finally{g(!1)}},B=async(s,t)=>{try{console.log("Submitting response:",{surveyId:s,answers:t,monitorId:null==e?void 0:e.id});let{error:r}=await d.from("responses").insert([{survey_id:s,monitor_id:null==e?void 0:e.id,answers:t}]);if(r)throw console.error("Error submitting response:",r),r;console.log("Response submitted successfully"),b(null),setTimeout(()=>{W()},1e3)}catch(e){console.error("Error submitting response:",e),alert("回答の送信に失敗しました。もう一度お試しください。")}},V=null==e?void 0:e.profile,Y=(null==V?void 0:V.points)||0;return h?(0,r.jsx)("div",{className:"min-h-screen bg-slate-950 flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):(0,r.jsxs)("div",{className:"min-h-screen bg-white relative overflow-hidden",children:[(0,r.jsx)("div",{className:"w-full absolute inset-0 h-screen",children:(0,r.jsx)(es,{id:"tsparticlesmonitor",background:"transparent",minSize:.6,maxSize:1.4,particleDensity:60,className:"w-full h-full",particleColor:"#F97316",speed:.5})}),(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-orange-50/30 via-white to-orange-50/30"}),(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-white/80 via-transparent to-white/80"}),(0,r.jsx)("header",{className:"relative z-20 bg-white/80 backdrop-blur-sm border-b border-gray-200",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center py-4 sm:h-16 gap-4 sm:gap-0",children:[(0,r.jsxs)(k.P.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"flex items-center space-x-4 w-full sm:w-auto",children:[(0,r.jsx)("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 rounded-full p-2 shadow-lg",children:(0,r.jsx)(U.A,{className:"w-6 h-6 text-white"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-lg sm:text-xl font-semibold bg-clip-text text-transparent bg-gradient-to-r from-orange-600 to-orange-500",children:"モニターダッシュボード"}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:["こんにちは、",null==e?void 0:e.name,"さん"]})]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2 sm:space-x-4 w-full sm:w-auto justify-end",children:[(0,r.jsxs)("button",{onClick:()=>_(!0),title:"チャットサポート",className:"bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white p-2 sm:px-3 sm:py-1 rounded-lg transition-all duration-300 transform hover:scale-105 flex items-center space-x-2 text-sm shadow-lg hover:shadow-xl",children:[(0,r.jsx)(F.A,{className:"w-4 h-4"}),(0,r.jsx)("span",{className:"hidden sm:inline",children:"チャット"})]}),(0,r.jsxs)("button",{onClick:()=>w(!0),title:"プロフィール",className:"bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white p-2 sm:px-3 sm:py-1 rounded-lg transition-all duration-300 transform hover:scale-105 flex items-center space-x-2 text-sm shadow-lg hover:shadow-xl",children:[(0,r.jsx)(v.A,{className:"w-4 h-4"}),(0,r.jsx)("span",{className:"hidden sm:inline",children:"プロフィール"})]}),(0,r.jsxs)("button",{onClick:s,title:"ログアウト",className:"text-gray-600 hover:text-orange-600 p-2 sm:px-3 sm:py-1 rounded-lg hover:bg-orange-50 transition-colors flex items-center space-x-2",children:[(0,r.jsx)(L.A,{className:"w-5 h-5"}),(0,r.jsx)("span",{className:"hidden sm:inline",children:"ログアウト"})]})]})]})})}),(0,r.jsxs)("main",{className:"relative z-20 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,r.jsx)(k.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"mb-8",children:(0,r.jsx)("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl border border-orange-100 p-6 shadow-xl",children:(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 rounded-full p-3 shadow-lg",children:(0,r.jsx)(M.A,{className:"w-6 h-6 text-white"})}),(0,r.jsxs)("div",{className:"ml-4",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"現在の獲得ポイント"}),(0,r.jsx)("p",{className:"text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-orange-600 to-orange-500",children:Y})]})]}),(0,r.jsxs)("button",{onClick:()=>j(!0),className:"bg-gradient-to-r from-green-600 to-green-500 hover:from-green-700 hover:to-green-600 text-white px-5 py-2 rounded-lg transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl flex items-center space-x-2 flex-shrink-0",children:[(0,r.jsx)(Q.A,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:"ポイントを交換する"})]})]})})}),(0,r.jsxs)(k.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-white/80 backdrop-blur-sm rounded-2xl border border-orange-100 shadow-xl",children:[(0,r.jsx)("div",{className:"border-b border-gray-200",children:(0,r.jsxs)("nav",{className:"flex justify-center sm:justify-start gap-x-3 sm:gap-x-8 px-2 sm:px-6",children:[(0,r.jsx)("button",{onClick:()=>A("surveys"),className:"py-4 px-2 sm:px-3 border-b-2 font-medium text-xs sm:text-sm transition-colors duration-200 ".concat("surveys"===C?"border-orange-600 text-orange-600":"border-transparent text-gray-500 hover:text-gray-700"),children:(0,r.jsx)("span",{children:"アンケート"})}),(0,r.jsx)("button",{onClick:()=>A("ads"),className:"py-4 px-2 sm:px-3 border-b-2 font-medium text-xs sm:text-sm transition-colors duration-200 ".concat("ads"===C?"border-orange-600 text-orange-600":"border-transparent text-gray-500 hover:text-gray-700"),children:(0,r.jsx)("span",{children:"採用情報"})}),(0,r.jsx)("button",{onClick:()=>A("services"),className:"py-4 px-2 sm:px-3 border-b-2 font-medium text-xs sm:text-sm transition-colors duration-200 ".concat("services"===C?"border-orange-600 text-orange-600":"border-transparent text-gray-500 hover:text-gray-700"),children:(0,r.jsx)("span",{children:"キャリア相談"})})]})}),(0,r.jsxs)("div",{className:"p-6",children:["surveys"===C&&(0,r.jsxs)("div",{className:"space-y-8",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"回答できるアンケート"}),0===t.length?(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)(O.A,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-500",children:"現在回答できるアンケートはありません。"})]}):(0,r.jsx)("div",{className:"space-y-4",children:t.map(e=>{var s,t;return(0,r.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:border-orange-300 hover:shadow-md transition-all",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h3",{className:"font-medium text-gray-800",children:e.title}),(0,r.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.description})]}),(0,r.jsx)("div",{className:"flex items-center space-x-2 ml-4",children:(0,r.jsxs)("div",{className:"flex items-center text-orange-600",children:[(0,r.jsx)(Q.A,{className:"w-4 h-4 mr-1"}),(0,r.jsxs)("span",{className:"text-sm font-medium",children:[e.points_reward,"pt"]})]})})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center text-sm text-gray-500 mb-3",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsxs)("span",{className:"flex items-center",children:[(0,r.jsx)(R.A,{className:"w-4 h-4 mr-1"}),null==(s=e.client)?void 0:s.name]}),(0,r.jsxs)("span",{className:"flex items-center",children:[(0,r.jsx)(G.A,{className:"w-4 h-4 mr-1"}),"質問数: ",(null==(t=e.questions)?void 0:t.length)||0]})]}),(0,r.jsx)("button",{onClick:()=>{b(e)},className:"bg-gradient-to-r from-orange-600 to-orange-500 hover:from-orange-700 hover:to-orange-600 text-white px-4 py-2 rounded-lg transition-all duration-300 transform hover:scale-105 text-sm shadow-lg hover:shadow-xl",children:"回答する"})]})]},e.id)})})]}),(0,r.jsxs)("div",{className:"mt-8 pt-6 border-t border-gray-200",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"最近の活動"}),0===i.length?(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)(J.A,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-500",children:"まだ活動履歴がありません。"})]}):(0,r.jsx)("div",{className:"space-y-4",children:i.map(e=>{var s;return(0,r.jsxs)("div",{className:"flex items-center justify-between py-2",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 rounded-full p-2 mr-3 shadow-lg",children:(0,r.jsx)(Q.A,{className:"w-4 h-4 text-white"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-800",children:(null==(s=e.survey)?void 0:s.title)||"新規登録ボーナス"}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:new Date(e.created_at).toLocaleDateString("ja-JP")})]})]}),(0,r.jsx)("div",{className:"text-right",children:(0,r.jsxs)("p",{className:"text-sm font-medium text-orange-600",children:["+",e.points," ポイント"]})})]},e.id)})})]}),(0,r.jsxs)("div",{className:"mt-8 pt-6 border-t border-gray-200",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"回答履歴"}),0===n.length?(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)(T.A,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-500",children:"まだアンケートに回答していません。"})]}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"border-b border-gray-200",children:[(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider",children:"アンケート"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider",children:"回答日"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider",children:"獲得ポイント"})]})}),(0,r.jsx)("tbody",{className:"divide-y divide-gray-200",children:n.map(e=>{var s;return(0,r.jsxs)("tr",{className:"hover:bg-orange-50",children:[(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("div",{className:"text-sm font-medium text-gray-800",children:null==(s=e.survey)?void 0:s.title})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("div",{className:"text-sm text-gray-600",children:new Date(e.completed_at).toLocaleDateString("ja-JP")})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsxs)("div",{className:"text-sm font-medium text-orange-600",children:["+",e.points_earned," ポイント"]})})]},e.id)})})]})})]})]}),"ads"===C&&(0,r.jsx)("div",{children:x.length>0?(0,r.jsx)(ef,{advertisements:x,onAdClick:P}):(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)(J.A,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-500",children:"現在、採用情報はありません。"})]})}),"services"===C&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"キャリア相談サービス"}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:z.map((e,s)=>(0,r.jsxs)("div",{className:"group bg-white/80 backdrop-blur-sm rounded-2xl p-6 border border-orange-100 hover:border-orange-300 transition-all duration-300 hover:transform hover:scale-105 shadow-lg hover:shadow-xl cursor-pointer",onClick:()=>q(!0),children:[(0,r.jsx)("div",{className:"bg-gradient-to-br ".concat(e.color," rounded-full p-4 w-16 h-16 mx-auto mb-4 flex items-center justify-center group-hover:shadow-lg transition-all duration-300"),children:e.icon}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-2 text-center",children:e.title}),(0,r.jsx)("p",{className:"text-gray-600 text-sm text-center leading-relaxed",children:e.description})]},s))})]})]})]})]}),p&&(0,r.jsx)(eh,{survey:p,onClose:()=>b(null),onSubmit:B}),f&&(0,r.jsx)(eg,{onClose:()=>j(!1),userEmail:(null==e?void 0:e.email)||"",currentPoints:Y,monitorId:(null==e?void 0:e.id)||""}),y&&(0,r.jsx)(ea,{onClose:()=>w(!1),user:e,onProfileUpdate:W}),N&&(0,r.jsx)(ed,{onClose:()=>_(!1),user:e,initialRoomId:I||void 0}),S&&(0,r.jsx)(eu,{onClose:()=>q(!1),user:e,onChatOpen:e=>{q(!1),D(e||null),_(!0)}}),E&&(0,r.jsx)(ep,{advertisement:E,onClose:()=>P(null)}),(0,r.jsx)("div",{className:"absolute bottom-0 w-full h-32 bg-gradient-to-t from-gray-50 to-transparent"})]})},ef=e=>{let{advertisements:s,onAdClick:t}=e,[l,n]=(0,a.useState)(0);if((0,a.useEffect)(()=>{if(s.length<=1)return;let e=setInterval(()=>{n(e=>e===s.length-1?0:e+1)},3e3);return()=>clearInterval(e)},[s.length]),0===s.length)return null;let o=s[l];return(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-4 sm:p-6 hover:border-orange-300 hover:shadow-md transition-all h-80 sm:h-60 flex items-center overflow-hidden cursor-pointer",onClick:()=>t(o),children:(0,r.jsxs)(k.P.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.5},className:"flex flex-col md:flex-row gap-4 w-full h-full",children:[o.image_url&&(0,r.jsx)("div",{className:"w-full md:w-2/5 flex-shrink-0 h-1/2 md:h-full",children:(0,r.jsx)("img",{src:o.image_url,alt:o.title,className:"w-full h-full object-contain rounded-lg",onError:e=>{e.currentTarget.style.display="none"}})}),(0,r.jsxs)("div",{className:"flex flex-col justify-center flex-grow overflow-hidden h-1/2 md:h-full",children:[(0,r.jsx)("h3",{className:"font-semibold text-gray-800 mb-2 text-base sm:text-lg truncate",children:o.title}),o.description&&(0,r.jsx)("div",{className:"flex-grow overflow-hidden mb-3",children:(0,r.jsx)("p",{className:"text-sm text-gray-600 leading-relaxed whitespace-pre-wrap line-clamp-2 sm:line-clamp-3",children:o.description})}),o.link_url&&(0,r.jsxs)("a",{href:o.link_url,target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),className:"inline-flex items-center bg-gradient-to-r from-orange-600 to-orange-500 hover:from-orange-700 hover:to-orange-600 text-white px-3 py-1 sm:px-4 sm:py-2 rounded-lg transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl self-start mt-auto text-sm",children:["詳細を見る",(0,r.jsx)("svg",{className:"w-4 h-4 ml-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})]})]})]},o.id)}),s.length>1&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:()=>{n(0===l?s.length-1:l-1)},className:"absolute left-2 top-1/2 transform -translate-y-1/2 bg-white/80 hover:bg-white border border-gray-200 rounded-full p-2 shadow-lg transition-all duration-300 hover:scale-110",children:(0,r.jsx)(V.A,{className:"w-5 h-5 text-gray-600"})}),(0,r.jsx)("button",{onClick:()=>{n(l===s.length-1?0:l+1)},className:"absolute right-2 top-1/2 transform -translate-y-1/2 bg-white/80 hover:bg-white border border-gray-200 rounded-full p-2 shadow-lg transition-all duration-300 hover:scale-110",children:(0,r.jsx)(Y.A,{className:"w-5 h-5 text-gray-600"})}),(0,r.jsx)("div",{className:"flex justify-center mt-4 space-x-2",children:s.map((e,s)=>(0,r.jsx)("button",{onClick:()=>{n(s)},className:"w-3 h-3 rounded-full transition-all duration-300 ".concat(s===l?"bg-orange-500 scale-110":"bg-gray-300 hover:bg-gray-400")},s))})]})]})};var ej=t(1786),ev=t(1360),ey=t(33),ew=t(6191),eN=t(7828),e_=t(1010),ek=t(9867),eS=t(1078);let eq=e=>{let s=e.split("\n").map(e=>e.trim()).filter(e=>e),t="",r="",a=[],l=null,n=null,o=!1;console.log("=== PARSING DEBUG ==="),console.log("Total lines:",s.length);for(let e=0;e<s.length;e++){let i=s[e];if(console.log("Line ".concat(e+1,': "').concat(i,'"')),!t&&i.startsWith("# ")){console.log("Found title:",t=i.substring(2).trim());continue}if(i.startsWith("# ")){console.log("Found section:",i),n&&l&&(console.log("Saving previous question:",n.question_text),l.questions.push(n),n=null),l&&a.push(l),l={title:i.substring(2).trim(),questions:[]},o=!1;continue}if(i.startsWith("## ")&&l){console.log("Found section description:",i),n&&(console.log("Saving previous question before section desc:",n.question_text),l.questions.push(n),n=null),l.description=i.substring(3).trim(),o=!1;continue}if(i.match(/^\$\$\$1-3\s+/)){console.log("Found ranking question:",i),n&&l&&(console.log("Saving previous question before ranking:",n.question_text),l.questions.push(n)),l||(l={title:"メインセクション",questions:[]}),n={question_text:i.replace(/^\$\$\$1-3\s+/,"").trim(),question_type:"ranking",required:!0,max_selections:3},o=!0,console.log("Created ranking question:",n);continue}if(i.startsWith("##### ")){console.log("Found text question:",i),n&&l&&(console.log("Saving previous question before text:",n.question_text),l.questions.push(n)),l||(l={title:"メインセクション",questions:[]}),n={question_text:i.substring(6).trim(),question_type:"text",required:!0},o=!1,console.log("Created text question:",n);continue}if(i.startsWith("#### ")){console.log("Found checkbox question:",i),n&&l&&(console.log("Saving previous question before checkbox:",n.question_text),l.questions.push(n)),l||(l={title:"メインセクション",questions:[]}),n={question_text:i.substring(5).trim(),question_type:"checkbox",required:!0},o=!0,console.log("Created checkbox question:",n);continue}if(i.startsWith("### ")&&!i.match(/^\$\$\$1-3\s+/)){console.log("Found multiple choice question:",i),n&&l&&(console.log("Saving previous question before multiple choice:",n.question_text),l.questions.push(n)),l||(l={title:"メインセクション",questions:[]}),n={question_text:i.substring(4).trim(),question_type:"multiple_choice",required:!0},o=!0,console.log("Created multiple choice question:",n);continue}if(i.startsWith("□ ")&&n&&o){console.log("Found option:",i);let e=i.substring(2).trim();n.options||(n.options=[]),n.options.push(e),console.log("Added option to question:",e);continue}if(i.includes("その他")&&n&&o){console.log('Found "その他" option:',i),n.options||(n.options=[]),n.options.push("その他");continue}r||l||i.startsWith("#")||i.startsWith("□")||console.log("Found description:",r=i)}return n&&l&&(console.log("Saving final question:",n.question_text),l.questions.push(n)),l&&(console.log("Saving final section:",l.title),a.push(l)),0===a.length&&n&&a.push({title:"メインセクション",questions:[n]}),console.log("=== PARSING RESULT ==="),console.log("Title:",t),console.log("Sections:",a.length),a.forEach((e,s)=>{console.log("Section ".concat(s+1,": ").concat(e.title," (").concat(e.questions.length," questions)")),e.questions.forEach((e,s)=>{console.log("  Q".concat(s+1,": ").concat(e.question_text," (").concat(e.question_type,")"))})}),{title:t||"インポートされたアンケート",description:r||"ファイルからインポートされたアンケートです",sections:a}},eC=e=>{let s=[],t=0;return e.sections.forEach(e=>{e.questions.forEach(r=>{s.push({question_text:r.question_text,question_type:"checkbox"===r.question_type||"ranking"===r.question_type?"multiple_choice":r.question_type,options:r.options||[],required:r.required,order_index:t++,is_long_text:r.is_long_text,is_multiple_select:"checkbox"===r.question_type||"ranking"===r.question_type,max_selections:r.max_selections||("ranking"===r.question_type?3:void 0),section_title:e.title,section_description:e.description})})}),console.log("=== CONVERTED QUESTIONS ==="),s.forEach((e,s)=>{console.log("Question ".concat(s+1,": ").concat(e.question_text," (").concat(e.question_type,")")),3===e.max_selections&&e.is_multiple_select&&console.log("  ✓ RANKING QUESTION: max_selections=".concat(e.max_selections,", is_multiple_select=").concat(e.is_multiple_select))}),s},eA=e=>{let{onClose:s,onImport:t}=e,[l,n]=(0,a.useState)(!1),[o,i]=(0,a.useState)(""),[c,d]=(0,a.useState)(""),[m,x]=(0,a.useState)(null),[u,h]=(0,a.useState)(null),g=e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?n(!0):"dragleave"===e.type&&n(!1)},p=e=>{if(!e.name.endsWith(".md")&&!e.name.endsWith(".txt"))return void x("Markdownファイル（.md）またはテキストファイル（.txt）を選択してください。");let s=new FileReader;s.onload=s=>{var t;let r=null==(t=s.target)?void 0:t.result;i(r),d(e.name),x(null);try{let e=eq(r),s=eC(e);h({title:e.title,description:e.description,questions:s,sectionsCount:e.sections.length,questionsCount:s.filter(e=>"section_header"!==e.question_type).length})}catch(e){x("ファイルの解析に失敗しました。形式を確認してください。"),h(null)}},s.readAsText(e)};return(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"アンケートをインポート"}),(0,r.jsx)("button",{onClick:s,className:"text-gray-500 hover:text-gray-700",children:(0,r.jsx)(W.A,{className:"w-6 h-6"})})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-medium mb-4",children:"ファイルをインポート"}),(0,r.jsxs)("div",{className:"border-2 border-dashed rounded-lg p-8 text-center transition-colors ".concat(l?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"),onDragEnter:g,onDragLeave:g,onDragOver:g,onDrop:e=>{e.preventDefault(),e.stopPropagation(),n(!1);let s=e.dataTransfer.files;s&&s[0]&&p(s[0])},children:[(0,r.jsx)(ej.A,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600 mb-2",children:"Markdownファイルをドラッグ&ドロップ"}),(0,r.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:"または"}),(0,r.jsxs)("label",{className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 cursor-pointer inline-block",children:["ファイルを選択",(0,r.jsx)("input",{type:"file",accept:".md,.txt",onChange:e=>{let s=e.target.files;s&&s[0]&&p(s[0])},className:"hidden"})]})]}),c&&(0,r.jsx)("div",{className:"mt-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(O.A,{className:"w-5 h-5 text-green-600 mr-2"}),(0,r.jsx)("span",{className:"text-green-800",children:c})]})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-medium mb-4",children:"または直接入力"}),(0,r.jsx)("textarea",{value:o,onChange:e=>(e=>{i(e),d("手動入力"),x(null);try{let s=eq(e),t=eC(s);h({title:s.title,description:s.description,questions:t,sectionsCount:s.sections.length,questionsCount:t.filter(e=>"section_header"!==e.question_type).length})}catch(e){x("テキストの解析に失敗しました。形式を確認してください。"),h(null)}})(e.target.value),className:"w-full h-64 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent font-mono text-sm",placeholder:"Markdown形式でアンケート内容を入力してください..."})]}),m&&(0,r.jsx)("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(eS.A,{className:"w-5 h-5 text-red-600 mr-2"}),(0,r.jsx)("span",{className:"text-red-800",children:m})]})})]}),(0,r.jsx)("div",{className:"space-y-6",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-medium mb-4",children:"プレビュー"}),u?(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg",children:[(0,r.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:u.title}),(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:u.description}),(0,r.jsxs)("div",{className:"flex space-x-4 text-sm text-gray-500",children:[(0,r.jsxs)("span",{children:["セクション: ",u.sectionsCount]}),(0,r.jsxs)("span",{children:["質問数: ",u.questionsCount]})]})]}),(0,r.jsx)("div",{className:"max-h-96 overflow-y-auto space-y-3",children:u.questions.map((e,s)=>(0,r.jsx)("div",{className:"p-3 border border-gray-200 rounded-lg",children:"section_header"===e.question_type?(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h5",{className:"font-medium text-blue-600",children:e.section_title}),e.section_description&&(0,r.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.section_description})]}):(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,r.jsx)("h5",{className:"font-medium text-gray-900",children:e.question_text}),(0,r.jsx)("span",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:"text"===e.question_type?e.is_long_text?"長文":"短文":"multiple_choice"===e.question_type?e.is_multiple_select?"複数選択":"単数選択":"rating"===e.question_type?"評価":"yes_no"===e.question_type?"はい/いいえ":e.question_type})]}),e.options&&e.options.length>0&&(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:["選択肢: ",e.options.join(", ")]})]})},s))})]}):(0,r.jsxs)("div",{className:"p-8 text-center text-gray-500",children:[(0,r.jsx)(O.A,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,r.jsx)("p",{children:"ファイルを選択またはテキストを入力すると、プレビューが表示されます"})]})]})})]}),(0,r.jsxs)("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,r.jsx)("h4",{className:"font-medium text-blue-900 mb-2",children:"\uD83D\uDCDD 記法ガイド"}),(0,r.jsxs)("div",{className:"text-sm text-blue-800 space-y-1",children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("code",{children:"# セクション名"})," → ページ分け（セクション）"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("code",{children:"## セクション説明"})," → セクションの説明文"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("code",{children:"### 質問文"})," → 単数選択（ラジオボタン）"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("code",{children:"#### 質問文"})," → 複数選択（チェックボックス）"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("code",{children:"$$$1-3 質問文"})," → 上位3位ランキング"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("code",{children:"##### 質問文"})," → 記述式"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("code",{children:"□ 選択肢"})," → 各選択肢"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("code",{children:"その他( )"})," → 「その他」オプション付き"]})]})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-4 mt-6",children:[(0,r.jsx)("button",{onClick:s,className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50",children:"キャンセル"}),(0,r.jsx)("button",{onClick:()=>{u&&t(u)},disabled:!u,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"インポート"})]})]})})},eE=e=>{let{onClose:s,onSubmit:t,surveyToEdit:l}=e,n=!!l,[o,i]=(0,a.useState)(!1),[c,d]=(0,a.useState)({title:"",description:"",points_reward:10,questions:[{question_text:"",question_type:"text",options:[],required:!1,is_multiple_select:!1}]});(0,a.useEffect)(()=>{n&&l&&d({title:l.title,description:l.description,points_reward:l.points_reward,questions:l.questions.map(e=>({question_text:e.question_text,question_type:e.question_type,options:e.options||[],required:e.required,is_multiple_select:e.is_multiple_select||!1,max_selections:e.max_selections||void 0}))})},[n,l]);let m=(e,s,t)=>{d(r=>({...r,questions:r.questions.map((r,a)=>a===e?{...r,[s]:t}:r)}))};return(0,r.jsx)("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white/10 backdrop-blur-md rounded-2xl border border-white/20 p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-2xl",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-white",children:n?"アンケートを編集":"新しいアンケートを作成"}),(0,r.jsx)("button",{onClick:s,className:"text-neutral-400 hover:text-white transition-colors",children:(0,r.jsx)(W.A,{className:"w-6 h-6"})})]}),(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault(),t(n?{...c,id:null==l?void 0:l.id}:c)},className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"アンケートタイトル"}),(0,r.jsx)("input",{type:"text",value:c.title,onChange:e=>d(s=>({...s,title:e.target.value})),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-neutral-400",placeholder:"アンケートのタイトルを入力",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"説明"}),(0,r.jsx)("textarea",{value:c.description,onChange:e=>d(s=>({...s,description:e.target.value})),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-neutral-400",rows:3,placeholder:"アンケートの説明を入力",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"報酬ポイント"}),(0,r.jsx)("input",{type:"number",value:c.points_reward,onChange:e=>d(s=>({...s,points_reward:Number(e.target.value)})),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-neutral-400",min:"1",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300",children:"質問"}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsxs)("button",{type:"button",onClick:()=>i(!0),className:"bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white px-3 py-1 rounded text-sm transition-all duration-300 transform hover:scale-105 flex items-center space-x-1",children:[(0,r.jsx)(ej.A,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:"インポート"})]}),(0,r.jsx)("button",{type:"button",onClick:()=>{d(e=>({...e,questions:[...e.questions,{question_text:"",question_type:"text",options:[],required:!1,is_multiple_select:!1}]}))},className:"bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white px-3 py-1 rounded text-sm transition-all duration-300 transform hover:scale-105",children:"質問を追加"})]})]}),c.questions.map((e,s)=>(0,r.jsxs)("div",{className:"bg-white/5 border border-white/10 rounded-lg p-4 mb-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,r.jsxs)("h4",{className:"font-medium text-white",children:["質問 ",s+1]}),c.questions.length>1&&(0,r.jsx)("button",{type:"button",onClick:()=>{d(e=>({...e,questions:e.questions.filter((e,t)=>t!==s)}))},className:"text-red-400 hover:text-red-300 transition-colors",children:(0,r.jsx)(ev.A,{className:"w-4 h-4"})})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300 mb-1",children:"質問文"}),(0,r.jsx)("input",{type:"text",value:e.question_text,onChange:e=>m(s,"question_text",e.target.value),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-white placeholder-neutral-400",placeholder:"質問文を入力",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300 mb-1",children:"質問タイプ"}),(0,r.jsxs)("select",{value:e.question_type,onChange:e=>m(s,"question_type",e.target.value),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-white",children:[(0,r.jsx)("option",{value:"text",className:"bg-slate-800",children:"テキスト"}),(0,r.jsx)("option",{value:"multiple_choice",className:"bg-slate-800",children:"選択肢"}),(0,r.jsx)("option",{value:"ranking",className:"bg-slate-800",children:"上位3位ランキング"})]})]}),"multiple_choice"===e.question_type&&(0,r.jsxs)("label",{className:"flex items-center p-3 bg-white/5 border border-white/10 rounded-lg cursor-pointer hover:bg-white/10 transition-colors",children:[(0,r.jsx)("input",{type:"checkbox",id:"multiple-select-".concat(s),checked:e.is_multiple_select,onChange:e=>m(s,"is_multiple_select",e.target.checked),className:"mr-2 text-orange-500"}),(0,r.jsx)("span",{className:"text-sm text-neutral-300",children:"複数選択可能"})]}),"ranking"===e.question_type&&(0,r.jsx)("div",{className:"bg-orange-500/10 border border-orange-500/20 rounded-lg p-3",children:(0,r.jsx)("p",{className:"text-orange-300 text-sm",children:"\uD83D\uDCCA 上位3位ランキング質問として設定されます（複数選択・最大3つまで）"})}),("multiple_choice"===e.question_type||"ranking"===e.question_type)&&(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300 mb-1",children:"選択肢（カンマ区切り）"}),(0,r.jsx)("input",{type:"text",value:e.options.join(", "),onChange:e=>m(s,"options",e.target.value.split(", ").filter(Boolean)),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-white placeholder-neutral-400",placeholder:"ranking"===e.question_type?"例: 商品A, 商品B, 商品C, 商品D, 商品E":"例: 選択肢1, 選択肢2, 選択肢3"})]}),(0,r.jsxs)("label",{className:"flex items-center p-3 bg-white/5 border border-white/10 rounded-lg cursor-pointer hover:bg-white/10 transition-colors",children:[(0,r.jsx)("input",{type:"checkbox",id:"required-".concat(s),checked:e.required,onChange:e=>m(s,"required",e.target.checked),className:"mr-2 text-orange-500"}),(0,r.jsx)("span",{className:"text-sm text-neutral-300",children:"必須項目"})]})]})]},s))]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,r.jsx)("button",{type:"button",onClick:s,className:"px-4 py-2 text-neutral-300 border border-white/20 rounded-lg hover:bg-white/10 transition-colors",children:"キャンセル"}),(0,r.jsx)("button",{type:"submit",className:"px-4 py-2 bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white rounded-lg transition-all duration-300 transform hover:scale-105",children:n?"更新":"作成"})]})]}),o&&(0,r.jsx)(eA,{onClose:()=>i(!1),onImport:e=>{d(s=>({...s,title:e.title,description:e.description,questions:e.questions})),i(!1)}})]})})},eP=()=>{let{user:e,signOut:s}=m(),[t,l]=(0,a.useState)([]),[n,o]=(0,a.useState)(!1),[i,c]=(0,a.useState)(null),[x,u]=(0,a.useState)(!0),[h,g]=(0,a.useState)(null),[p,b]=(0,a.useState)(!1);(0,a.useEffect)(()=>{(null==e?void 0:e.id)&&f()},[null==e?void 0:e.id]);let f=async()=>{if(!(null==e?void 0:e.id)){console.error("User ID is not available"),u(!1);return}try{let{data:s,error:t}=await d.from("surveys").select("\n          *,\n          questions(*),\n          responses_count:responses(count)\n        ").eq("client_id",null==e?void 0:e.id).order("created_at",{ascending:!1});if(t)throw t;let r=s.map(e=>{var s,t;return{...e,questions:e.questions.sort((e,s)=>e.order_index-s.order_index),responses_count:(null==(t=e.responses_count)||null==(s=t[0])?void 0:s.count)||0}});l(r)}catch(e){console.error("Error fetching surveys:",e)}finally{u(!1)}},j=async s=>{try{let t=s.questions.filter(e=>"section_header"!==e.question_type).map(e=>"ranking"===e.question_type?{...e,is_multiple_select:!0,max_selections:3}:e),{data:r,error:a}=await d.from("surveys").insert([{client_id:null==e?void 0:e.id,title:s.title,description:s.description,points_reward:s.points_reward,status:"draft"}]).select().single();if(a)throw a;let l=t.map((e,s)=>({survey_id:r.id,question_text:e.question_text,question_type:e.question_type,options:e.options||[],required:e.required||!1,order_index:s,is_multiple_select:e.is_multiple_select||!1,max_selections:e.max_selections||null})),{error:n}=await d.from("questions").insert(l);if(n)throw n;o(!1),f()}catch(e){console.error("Error creating survey:",e)}},v=async e=>{try{let{error:s}=await d.from("surveys").update({title:e.title,description:e.description,points_reward:e.points_reward}).eq("id",e.id);if(s)throw s;let{error:t}=await d.from("questions").delete().eq("survey_id",e.id);if(t)throw t;let r=e.questions.map((s,t)=>({survey_id:e.id,question_text:s.question_text,question_type:s.question_type,options:s.options||[],required:s.required||!1,order_index:t,is_multiple_select:s.is_multiple_select||!1,max_selections:s.max_selections||null}));if(r.length>0){let{error:e}=await d.from("questions").insert(r);if(e)throw e}c(null),f()}catch(e){console.error("Error updating survey:",e),alert("アンケートの更新に失敗しました。")}},w=async(e,s)=>{try{let{error:t}=await d.from("surveys").update({status:s}).eq("id",e);if(t)throw t;f()}catch(e){console.error("Error updating survey status:",e)}},N=async(e,s)=>{if(confirm("「".concat(s,"」を削除してもよろしいですか？この操作は取り消せません。")))try{let{error:s}=await d.from("surveys").delete().eq("id",e);if(s)throw s;f()}catch(e){console.error("Error deleting survey:",e),alert("アンケートの削除に失敗しました。")}},_=async e=>{try{let{data:s,error:t}=await d.from("surveys").select("\n          *,\n          questions(*)\n        ").eq("id",e).single();if(t)throw t;let{data:r,error:a}=await d.from("responses").select("\n          *,\n          monitor:users!responses_monitor_id_fkey(name, email)\n        ").eq("survey_id",e);if(a)throw a;let l=(s.questions||[]).sort((e,s)=>e.order_index-s.order_index);l.map(e=>[e.id,e]);let n=r.map(e=>{var s,t;let r={回答者名:(null==(s=e.monitor)?void 0:s.name)||"Unknown Monitor",メールアドレス:(null==(t=e.monitor)?void 0:t.email)||"unknown@example.com",回答日時:new Date(e.completed_at).toLocaleString("ja-JP")},a=new Map(e.answers.map(e=>[e.question_id,e]));return l.forEach(e=>{let s=a.get(e.id),t=e.question_text;if(s)if(s.answer_text)r[t]=s.answer_text;else if(s.answer_option){let e=s.answer_option;s.other_text&&(e+=" (".concat(s.other_text,")")),r[t]=e}else if(s.answer_options&&Array.isArray(s.answer_options)){let e=s.answer_options.join(", ");s.other_text&&(e+=" (その他: ".concat(s.other_text,")")),r[t]=e}else r[t]="未回答";else r[t]="未回答"}),r}),o=S(n),i=new Blob(["\uFEFF"+o],{type:"text/csv;charset=utf-8;"}),c=document.createElement("a");c.href=URL.createObjectURL(i),c.download="".concat(s.title,"_responses_").concat(new Date().toISOString().split("T")[0],".csv"),c.click()}catch(e){console.error("Error exporting CSV:",e)}},S=e=>{if(0===e.length)return"";let s=Object.keys(e[0]);return[s.join(","),...e.map(e=>s.map(s=>{let t=e[s];return"string"==typeof t&&(t.includes(",")||t.includes('"')||t.includes("\n"))?'"'.concat(t.replace(/"/g,'""'),'"'):t}).join(","))].join("\n")};return x?(0,r.jsx)("div",{className:"min-h-screen bg-slate-950 flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):(0,r.jsxs)("div",{className:"min-h-screen bg-white relative overflow-hidden",children:[(0,r.jsx)("div",{className:"w-full absolute inset-0 h-screen",children:(0,r.jsx)(es,{id:"tsparticlesclient",background:"transparent",minSize:.6,maxSize:1.4,particleDensity:60,className:"w-full h-full",particleColor:"#F97316",speed:.5})}),(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-orange-50/30 via-white to-orange-50/30"}),(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-white/80 via-transparent to-white/80"}),(0,r.jsx)("header",{className:"relative z-20 bg-white/80 backdrop-blur-sm border-b border-gray-200",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,r.jsxs)(k.P.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"flex items-center space-x-4",children:[(0,r.jsx)("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 rounded-full p-2 shadow-lg",children:(0,r.jsx)(ey.A,{className:"w-6 h-6 text-white"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-xl font-semibold bg-clip-text text-transparent bg-gradient-to-r from-orange-600 to-orange-500",children:"クライアントダッシュボード"}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:["こんにちは、",null==e?void 0:e.name,"さん"]})]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsxs)("button",{onClick:()=>b(!0),className:"flex items-center space-x-2 text-gray-600 hover:text-orange-600 px-3 py-2 rounded-lg hover:bg-orange-50 transition-colors",children:[(0,r.jsx)(F.A,{className:"w-5 h-5"}),(0,r.jsx)("span",{children:"チャット"})]}),(0,r.jsxs)("button",{onClick:()=>o(!0),className:"bg-gradient-to-r from-orange-600 to-orange-500 hover:from-orange-700 hover:to-orange-600 text-white px-4 py-2 rounded-lg transition-all duration-300 transform hover:scale-105 flex items-center space-x-2 shadow-lg hover:shadow-xl",children:[(0,r.jsx)(ew.A,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:"アンケート作成"})]}),(0,r.jsx)("button",{onClick:s,className:"text-gray-600 hover:text-orange-600 px-3 py-1 rounded-lg hover:bg-orange-50 transition-colors",children:"ログアウト"})]})]})})}),(0,r.jsxs)("main",{className:"relative z-20 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,r.jsxs)(k.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[(0,r.jsx)("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl border border-orange-100 p-6 shadow-xl",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 rounded-full p-3 shadow-lg",children:(0,r.jsx)(O.A,{className:"w-6 h-6 text-white"})}),(0,r.jsxs)("div",{className:"ml-4",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"総アンケート数"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-orange-600",children:t.length})]})]})}),(0,r.jsx)("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl border border-orange-100 p-6 shadow-xl",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 rounded-full p-3 shadow-lg",children:(0,r.jsx)(R.A,{className:"w-6 h-6 text-white"})}),(0,r.jsxs)("div",{className:"ml-4",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"総回答数"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-orange-600",children:t.reduce((e,s)=>e+s.responses_count,0)})]})]})}),(0,r.jsx)("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl border border-orange-100 p-6 shadow-xl",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 rounded-full p-3 shadow-lg",children:(0,r.jsx)(ey.A,{className:"w-6 h-6 text-white"})}),(0,r.jsxs)("div",{className:"ml-4",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"実行中のアンケート"}),(0,r.jsx)("p",{className:"text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-orange-600 to-orange-500",children:t.filter(e=>"active"===e.status).length})]})]})})]}),(0,r.jsxs)(k.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-white/80 backdrop-blur-sm rounded-2xl border border-orange-100 shadow-xl",children:[(0,r.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,r.jsx)("h2",{className:"text-lg font-semibold text-gray-800",children:"アンケート一覧"})}),(0,r.jsx)("div",{className:"p-6",children:0===t.length?(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)(O.A,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-500",children:"まだアンケートがありません。"}),(0,r.jsx)("button",{onClick:()=>o(!0),className:"mt-4 bg-gradient-to-r from-orange-600 to-orange-500 hover:from-orange-700 hover:to-orange-600 text-white px-4 py-2 rounded-lg transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl",children:"最初のアンケートを作成"})]}):(0,r.jsx)("div",{className:"space-y-4",children:t.map(e=>(0,r.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:border-orange-300 hover:shadow-md transition-all",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-medium text-gray-800",children:e.title}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:e.description})]}),(0,r.jsx)("div",{className:"flex items-center space-x-2",children:(0,r.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat("active"===e.status?"bg-green-100 text-green-700 border border-green-300":"draft"===e.status?"bg-yellow-100 text-yellow-700 border border-yellow-300":"bg-gray-100 text-gray-700 border border-gray-300"),children:"active"===e.status?"実行中":"draft"===e.status?"下書き":"完了"})})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center text-sm text-gray-500 mb-3",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsxs)("span",{className:"flex items-center",children:[(0,r.jsx)(R.A,{className:"w-4 h-4 mr-1"}),e.responses_count," 回答"]}),(0,r.jsxs)("span",{className:"flex items-center",children:[(0,r.jsx)(y.A,{className:"w-4 h-4 mr-1"}),new Date(e.created_at).toLocaleDateString("ja-JP")]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsxs)("button",{onClick:()=>g(e),className:"text-orange-600 hover:text-orange-700 flex items-center space-x-1 transition-colors",children:[(0,r.jsx)(eN.A,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:"詳細"})]}),(0,r.jsxs)("button",{onClick:()=>c(e),className:"text-blue-600 hover:text-blue-700 flex items-center space-x-1 transition-colors",children:[(0,r.jsx)(e_.A,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:"編集"})]}),(0,r.jsxs)("button",{onClick:()=>_(e.id),className:"text-green-600 hover:text-green-700 flex items-center space-x-1 transition-colors",disabled:0===e.responses_count,children:[(0,r.jsx)(ek.A,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:"CSV"})]}),(0,r.jsxs)("button",{onClick:()=>N(e.id,e.title),className:"text-red-600 hover:text-red-700 flex items-center space-x-1 transition-colors",children:[(0,r.jsx)(ev.A,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:"削除"})]}),"draft"===e.status&&(0,r.jsx)("button",{onClick:()=>w(e.id,"active"),className:"bg-gradient-to-r from-orange-600 to-orange-500 hover:from-orange-700 hover:to-orange-600 text-white px-3 py-1 rounded text-sm transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl",children:"公開"})]})]})]},e.id))})})]})]}),(0,r.jsx)("div",{className:"absolute bottom-0 w-full h-32 bg-gradient-to-t from-gray-50 to-transparent"}),n&&(0,r.jsx)(eE,{onClose:()=>o(!1),onSubmit:j}),i&&(0,r.jsx)(eE,{surveyToEdit:i,onClose:()=>c(null),onSubmit:v}),h&&(0,r.jsx)(eI,{survey:h,onClose:()=>g(null)}),p&&(0,r.jsx)(ed,{onClose:()=>b(!1),user:e})]})},eI=e=>{var s;let{survey:t,onClose:l}=e,[n,o]=(0,a.useState)([]),[i,c]=(0,a.useState)(!0);(0,a.useEffect)(()=>{m()},[]);let m=async()=>{try{let{data:e,error:s}=await d.from("responses").select("\n          *,\n          monitor:users!responses_monitor_id_fkey(name, email)\n        ").eq("survey_id",t.id).order("completed_at",{ascending:!1});if(s)throw s;o(e||[])}catch(e){console.error("Error fetching responses:",e)}finally{c(!1)}};return(0,r.jsx)("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50",children:(0,r.jsxs)(k.P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-white/10 backdrop-blur-md rounded-2xl border border-white/20 p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto shadow-2xl",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-white",children:t.title}),(0,r.jsx)("p",{className:"text-neutral-300 mt-1",children:t.description})]}),(0,r.jsx)("button",{onClick:l,className:"text-neutral-400 hover:text-white transition-colors",children:(0,r.jsx)(W.A,{className:"w-6 h-6"})})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[(0,r.jsx)("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl border border-orange-100 p-4 shadow-xl",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 rounded-full p-2 shadow-lg",children:(0,r.jsx)(y.A,{className:"w-5 h-5 text-white"})}),(0,r.jsxs)("div",{className:"ml-3",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"作成日"}),(0,r.jsx)("p",{className:"text-lg font-bold text-orange-600",children:new Date(t.created_at).toLocaleDateString("ja-JP")})]})]})}),(0,r.jsx)("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl border border-orange-100 p-4 shadow-xl",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 rounded-full p-2 shadow-lg",children:(0,r.jsx)(R.A,{className:"w-5 h-5 text-white"})}),(0,r.jsxs)("div",{className:"ml-3",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"回答数"}),(0,r.jsx)("p",{className:"text-lg font-bold text-orange-600",children:t.responses_count})]})]})}),(0,r.jsx)("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl border border-orange-100 p-4 shadow-xl",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 rounded-full p-2 shadow-lg",children:(0,r.jsx)(O.A,{className:"w-5 h-5 text-white"})}),(0,r.jsxs)("div",{className:"ml-3",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"質問数"}),(0,r.jsx)("p",{className:"text-lg font-bold text-orange-600",children:(null==(s=t.questions)?void 0:s.length)||0})]})]})}),(0,r.jsx)("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl border border-orange-100 p-4 shadow-xl",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 rounded-full p-2 shadow-lg",children:(0,r.jsx)(M.A,{className:"w-5 h-5 text-white"})}),(0,r.jsxs)("div",{className:"ml-3",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"報酬ポイント"}),(0,r.jsx)("p",{className:"text-lg font-bold bg-clip-text text-transparent bg-gradient-to-r from-orange-600 to-orange-500",children:t.points_reward})]})]})})]}),(0,r.jsx)("div",{className:"border-b border-white/20 mb-6",children:(0,r.jsx)("nav",{className:"flex space-x-8",children:(0,r.jsx)("button",{className:"py-2 px-1 border-b-2 border-orange-400 text-orange-400 font-medium text-sm",children:"質問一覧"})})}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-white",children:"質問一覧"}),t.questions&&t.questions.length>0?(0,r.jsx)("div",{className:"space-y-4",children:t.questions.sort((e,s)=>e.order_index-s.order_index).map((e,s)=>(0,r.jsx)("div",{className:"bg-white/5 border border-white/10 rounded-lg p-4",children:(0,r.jsx)("div",{className:"flex justify-between items-start mb-2",children:(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,r.jsxs)("span",{className:"bg-orange-500/20 text-orange-300 text-xs font-medium px-2 py-1 rounded border border-orange-500/30",children:["質問 ",s+1]}),(0,r.jsx)("span",{className:"bg-gray-500/20 text-gray-300 text-xs font-medium px-2 py-1 rounded border border-gray-500/30",children:(e=>{switch(e){case"text":return"テキスト";case"multiple_choice":return"選択肢";case"ranking":return"上位3位ランキング";default:return e}})(e.question_type)}),e.required&&(0,r.jsx)("span",{className:"bg-red-500/20 text-red-300 text-xs font-medium px-2 py-1 rounded border border-red-500/30",children:"必須"})]}),(0,r.jsx)("h4",{className:"font-medium text-white mb-2",children:e.question_text}),"multiple_choice"===e.question_type&&e.options&&e.options.length>0&&(0,r.jsxs)("div",{className:"mt-2",children:[(0,r.jsx)("p",{className:"text-sm text-neutral-400 mb-1",children:"選択肢:"}),(0,r.jsx)("ul",{className:"list-disc list-inside text-sm text-neutral-300 space-y-1",children:e.options.map((e,s)=>(0,r.jsx)("li",{children:e},s))})]}),"rating"===e.question_type&&(0,r.jsx)("div",{className:"mt-2",children:(0,r.jsx)("p",{className:"text-sm text-neutral-400",children:"評価: 1〜5段階"})})]})})},e.id))}):(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)(O.A,{className:"w-12 h-12 text-neutral-500 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-neutral-400",children:"質問がありません"})]})]}),t.responses_count>0&&(0,r.jsxs)("div",{className:"mt-8",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:"最近の回答"}),i?(0,r.jsx)("div",{className:"text-center py-4",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto"})}):(0,r.jsxs)("div",{className:"space-y-4 max-h-64 overflow-y-auto",children:[n.slice(0,5).map(e=>{var s,t,a;return(0,r.jsxs)("div",{className:"bg-white/5 border border-white/10 rounded-lg p-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium text-white",children:null==(s=e.monitor)?void 0:s.name}),(0,r.jsx)("p",{className:"text-sm text-neutral-300",children:null==(t=e.monitor)?void 0:t.email})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("p",{className:"text-sm text-neutral-400",children:new Date(e.completed_at).toLocaleDateString("ja-JP")}),(0,r.jsxs)("p",{className:"text-sm font-medium text-orange-400",children:["+",e.points_earned," ポイント"]})]})]}),(0,r.jsxs)("div",{className:"text-sm text-neutral-300",children:["回答数: ",(null==(a=e.answers)?void 0:a.length)||0," 件"]})]},e.id)}),n.length>5&&(0,r.jsxs)("p",{className:"text-center text-sm text-neutral-400",children:["他 ",n.length-5," 件の回答があります"]})]})]}),(0,r.jsx)("div",{className:"flex justify-end mt-6",children:(0,r.jsx)("button",{onClick:l,className:"px-4 py-2 bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white rounded-lg transition-all duration-300 transform hover:scale-105",children:"閉じる"})})]})})};var eD=t(7910),ez=t(5370);let eR=()=>{let{user:e,signOut:s}=m(),[t,l]=(0,a.useState)([]),[n,o]=(0,a.useState)([]),[i,c]=(0,a.useState)([]),[x,u]=(0,a.useState)([]),[h,g]=(0,a.useState)([]),[p,b]=(0,a.useState)(!0),[j,v]=(0,a.useState)("users"),[w,N]=(0,a.useState)(!1),[S,q]=(0,a.useState)(!1),[C,A]=(0,a.useState)("all");(0,a.useEffect)(()=>{E()},[]);let E=async()=>{try{let{data:e,error:s}=await d.from("users").select("\n          *,\n          monitor_profiles(*),\n          client_profiles(*)\n        ").order("created_at",{ascending:!1});if(s)throw s;let t=e.map(e=>{var s,t;return{...e,profile:(null==(s=e.monitor_profiles)?void 0:s[0])||(null==(t=e.client_profiles)?void 0:t[0])||null}});l(t);let{data:r,error:a}=await d.from("surveys").select("\n          *,\n          client:users!surveys_client_id_fkey(name, email),\n          responses_count:responses(count)\n        ").order("created_at",{ascending:!1});if(a)throw a;let n=r.map(e=>{var s,t;return{...e,responses_count:(null==(t=e.responses_count)||null==(s=t[0])?void 0:s.count)||0}});o(n);let{data:i,error:m}=await d.from("client_registration_codes").select("\n          *,\n          used_by_user:users!client_registration_codes_used_by_fkey(name, email),\n          created_by_user:users!client_registration_codes_created_by_fkey(name)\n        ").order("created_at",{ascending:!1});if(m)throw m;c(i||[]);let{data:x,error:h}=await d.from("point_exchange_requests").select("\n          *,\n          monitor:users!point_exchange_requests_monitor_id_fkey(name, email)\n        ").order("created_at",{ascending:!1});if(h)throw h;u(x||[]);let{data:p,error:b}=await d.from("advertisements").select("\n          *,\n          creator:users!advertisements_created_by_fkey(name, email)\n        ").order("display_order",{ascending:!0}).order("created_at",{ascending:!1});if(b)throw b;g(p||[])}catch(e){console.error("Error fetching data:",e)}finally{b(!1)}},P=async(e,s)=>{try{console.log("".concat(s," user:"),e),E()}catch(e){console.error("Error updating user:",e)}},I=async(e,s)=>{try{let{error:t}=await d.from("surveys").update({status:"approve"===s?"active":"rejected"}).eq("id",e);if(t)throw t;E()}catch(e){console.error("Error updating survey:",e)}},D=async(e,s)=>{try{let{data:t,error:r}=await d.rpc("process_point_exchange",{p_request_id:e,p_status:s});if(r||!(null==t?void 0:t.success))throw Error((null==t?void 0:t.error)||"ポイント交換処理に失敗しました");E(),alert("ポイント交換を".concat("completed"===s?"完了":"却下","しました。"))}catch(e){console.error("Error updating exchange status:",e),alert("ステータスの更新に失敗しました: ".concat(e.message))}},z=async s=>{try{let{error:t}=await d.from("client_registration_codes").insert([{...s,created_by:null==e?void 0:e.id}]);if(t)throw t;N(!1),E()}catch(e){console.error("Error creating registration code:",e),alert("登録番号の作成に失敗しました。")}},T=async(e,s)=>{if(confirm("登録番号「".concat(s,"」を削除してもよろしいですか？")))try{let{error:s}=await d.from("client_registration_codes").delete().eq("id",e);if(s)throw s;E()}catch(e){console.error("Error deleting registration code:",e),alert("登録番号の削除に失敗しました。")}},U=async s=>{try{let{error:t}=await d.from("advertisements").insert([{...s,created_by:null==e?void 0:e.id}]);if(t)throw t;q(!1),E()}catch(e){console.error("Error creating advertisement:",e),alert("広告の作成に失敗しました。")}},F=async(e,s)=>{try{let{error:t}=await d.from("advertisements").update({is_active:!s}).eq("id",e);if(t)throw t;E()}catch(e){console.error("Error updating advertisement status:",e),alert("広告ステータスの更新に失敗しました。")}},L=async(e,s)=>{if(confirm("広告「".concat(s,"」を削除してもよろしいですか？")))try{let{error:s}=await d.from("advertisements").delete().eq("id",e);if(s)throw s;E()}catch(e){console.error("Error deleting advertisement:",e),alert("広告の削除に失敗しました。")}},M=x.filter(e=>"all"===C||e.status===C),Q={totalUsers:t.length,monitors:t.filter(e=>"monitor"===e.role).length,clients:t.filter(e=>"client"===e.role).length,totalSurveys:n.length,activeSurveys:n.filter(e=>"active"===e.status).length,totalResponses:n.reduce((e,s)=>e+s.responses_count,0),totalCodes:i.length,usedCodes:i.filter(e=>e.is_used).length,totalExchangeRequests:x.length,pendingExchangeRequests:x.filter(e=>"pending"===e.status).length,totalAds:h.length,activeAds:h.filter(e=>e.is_active).length};return p?(0,r.jsx)("div",{className:"min-h-screen bg-slate-950 flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):(0,r.jsxs)("div",{className:"min-h-screen bg-white relative overflow-hidden",children:[(0,r.jsx)("div",{className:"w-full absolute inset-0 h-screen",children:(0,r.jsx)(es,{id:"tsparticlesadmin",background:"transparent",minSize:.6,maxSize:1.4,particleDensity:60,className:"w-full h-full",particleColor:"#F97316",speed:.5})}),(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-orange-50/30 via-white to-orange-50/30"}),(0,r.jsx)("header",{className:"relative z-30 bg-white/80 backdrop-blur-sm border-b border-orange-100 shadow-sm",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"flex justify-between items-center py-4",children:[(0,r.jsxs)(k.P.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 rounded-full p-2 shadow-lg",children:(0,r.jsx)(eD.A,{className:"w-6 h-6 text-white"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-xl font-semibold bg-clip-text text-transparent bg-gradient-to-r from-orange-600 to-orange-500",children:"管理者ダッシュボード"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"システム管理"})]})]}),(0,r.jsx)("button",{onClick:s,className:"text-gray-600 hover:text-orange-600 px-3 py-1 rounded-lg hover:bg-orange-50 transition-colors",children:"ログアウト"})]})})}),(0,r.jsxs)("main",{className:"relative z-20 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,r.jsxs)(k.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-8",children:[(0,r.jsx)("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl border border-orange-100 p-4 shadow-xl",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 rounded-full p-2 shadow-lg",children:(0,r.jsx)(R.A,{className:"w-5 h-5 text-white"})}),(0,r.jsxs)("div",{className:"ml-3",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"総ユーザー"}),(0,r.jsx)("p",{className:"text-lg font-bold text-orange-600",children:Q.totalUsers})]})]})}),(0,r.jsx)("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl border border-orange-100 p-4 shadow-xl",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 rounded-full p-2 shadow-lg",children:(0,r.jsx)(R.A,{className:"w-5 h-5 text-white"})}),(0,r.jsxs)("div",{className:"ml-3",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"モニター"}),(0,r.jsx)("p",{className:"text-lg font-bold text-orange-600",children:Q.monitors})]})]})}),(0,r.jsx)("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl border border-orange-100 p-4 shadow-xl",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 rounded-full p-2 shadow-lg",children:(0,r.jsx)(_.A,{className:"w-5 h-5 text-white"})}),(0,r.jsxs)("div",{className:"ml-3",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"クライアント"}),(0,r.jsx)("p",{className:"text-lg font-bold text-orange-600",children:Q.clients})]})]})}),(0,r.jsx)("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl border border-orange-100 p-4 shadow-xl",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 rounded-full p-2 shadow-lg",children:(0,r.jsx)(O.A,{className:"w-5 h-5 text-white"})}),(0,r.jsxs)("div",{className:"ml-3",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"総アンケート"}),(0,r.jsx)("p",{className:"text-lg font-bold text-orange-600",children:Q.totalSurveys})]})]})}),(0,r.jsx)("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl border border-orange-100 p-4 shadow-xl",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 rounded-full p-2 shadow-lg",children:(0,r.jsx)(J.A,{className:"w-5 h-5 text-white"})}),(0,r.jsxs)("div",{className:"ml-3",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"実行中"}),(0,r.jsx)("p",{className:"text-lg font-bold text-orange-600",children:Q.activeSurveys})]})]})}),(0,r.jsx)("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl border border-orange-100 p-4 shadow-xl",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 rounded-full p-2 shadow-lg",children:(0,r.jsx)(J.A,{className:"w-5 h-5 text-white"})}),(0,r.jsxs)("div",{className:"ml-3",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"総回答数"}),(0,r.jsx)("p",{className:"text-lg font-bold bg-clip-text text-transparent bg-gradient-to-r from-orange-600 to-orange-500",children:Q.totalResponses})]})]})})]}),(0,r.jsxs)(k.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-white/80 backdrop-blur-sm rounded-2xl border border-orange-100 shadow-xl mb-6",children:[(0,r.jsx)("div",{className:"border-b border-gray-200",children:(0,r.jsxs)("nav",{className:"flex space-x-8 px-6",children:[(0,r.jsx)("button",{onClick:()=>v("users"),className:"py-4 px-1 border-b-2 font-medium text-sm ".concat("users"===j?"border-orange-600 text-orange-600":"border-transparent text-gray-500 hover:text-gray-700"),children:"ユーザー管理"}),(0,r.jsx)("button",{onClick:()=>v("surveys"),className:"py-4 px-1 border-b-2 font-medium text-sm ".concat("surveys"===j?"border-orange-600 text-orange-600":"border-transparent text-gray-500 hover:text-gray-700"),children:"アンケート管理"}),(0,r.jsx)("button",{onClick:()=>v("codes"),className:"py-4 px-1 border-b-2 font-medium text-sm ".concat("codes"===j?"border-orange-600 text-orange-600":"border-transparent text-gray-500 hover:text-gray-700"),children:"登録番号管理"}),(0,r.jsx)("button",{onClick:()=>v("exchanges"),className:"py-4 px-1 border-b-2 font-medium text-sm ".concat("exchanges"===j?"border-orange-600 text-orange-600":"border-transparent text-gray-500 hover:text-gray-700"),children:"ポイント交換管理"}),(0,r.jsx)("button",{onClick:()=>v("ads"),className:"py-4 px-1 border-b-2 font-medium text-sm ".concat("ads"===j?"border-orange-600 text-orange-600":"border-transparent text-gray-500 hover:text-gray-700"),children:"広告管理"}),(0,r.jsx)("button",{onClick:()=>v("analytics"),className:"py-4 px-1 border-b-2 font-medium text-sm ".concat("analytics"===j?"border-orange-600 text-orange-600":"border-transparent text-gray-500 hover:text-gray-700"),children:"分析"})]})}),(0,r.jsxs)("div",{className:"p-6",children:["users"===j&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"ユーザー一覧"}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider border-b border-gray-200",children:"ユーザー"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider border-b border-gray-200",children:"役割"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider border-b border-gray-200",children:"登録日"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider border-b border-gray-200",children:"詳細"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider border-b border-gray-200",children:"アクション"})]})}),(0,r.jsx)("tbody",{className:"divide-y divide-gray-200",children:t.map(e=>(0,r.jsxs)("tr",{className:"hover:bg-orange-50",children:[(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"flex-shrink-0 h-10 w-10",children:(0,r.jsx)("div",{className:"h-10 w-10 rounded-full bg-gradient-to-br from-orange-500 to-orange-600 flex items-center justify-center shadow-lg",children:(0,r.jsx)("span",{className:"text-sm font-medium text-white",children:e.name.charAt(0)})})}),(0,r.jsxs)("div",{className:"ml-4",children:[(0,r.jsx)("div",{className:"text-sm font-medium text-gray-800",children:e.name}),(0,r.jsx)("div",{className:"text-sm text-gray-600",children:e.email})]})]})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("span",{className:"px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(("monitor"===e.role||e.role,"bg-orange-100 text-orange-700 border border-orange-300")),children:"monitor"===e.role?"モニター":"client"===e.role?"クライアント":"管理者"})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:new Date(e.created_at).toLocaleDateString("ja-JP")}),(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:["monitor"===e.role&&e.profile&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{children:["年齢: ",e.profile.age]}),e.profile.faculty&&(0,r.jsxs)("div",{children:["学部: ",e.profile.faculty]}),e.profile.department&&(0,r.jsxs)("div",{children:["学科: ",e.profile.department]}),(0,r.jsxs)("div",{children:["ポイント: ",e.profile.points]})]}),"client"===e.role&&e.profile&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{children:["会社: ",e.profile.company_name]}),(0,r.jsxs)("div",{children:["業界: ",e.profile.industry]})]})]}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("button",{onClick:()=>P(e.id,"suspend"),className:"text-red-600 hover:text-red-700 transition-colors",children:"停止"}),(0,r.jsx)("button",{onClick:()=>P(e.id,"activate"),className:"text-green-600 hover:text-green-700 transition-colors",children:"有効化"})]})})]},e.id))})]})})]}),"surveys"===j&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"アンケート一覧"}),(0,r.jsx)("div",{className:"space-y-4",children:n.map(e=>{var s;return(0,r.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:border-orange-300 hover:shadow-md transition-all",children:(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h4",{className:"font-medium text-gray-800",children:e.title}),(0,r.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.description}),(0,r.jsxs)("div",{className:"flex items-center space-x-4 mt-2 text-sm text-gray-500",children:[(0,r.jsxs)("span",{className:"flex items-center",children:[(0,r.jsx)(f.A,{className:"w-4 h-4 mr-1"}),null==(s=e.client)?void 0:s.name]}),(0,r.jsxs)("span",{className:"flex items-center",children:[(0,r.jsx)(R.A,{className:"w-4 h-4 mr-1"}),e.responses_count," 回答"]}),(0,r.jsxs)("span",{className:"flex items-center",children:[(0,r.jsx)(y.A,{className:"w-4 h-4 mr-1"}),new Date(e.created_at).toLocaleDateString("ja-JP")]})]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat("active"===e.status?"bg-green-100 text-green-700 border border-green-300":"draft"===e.status?"bg-yellow-100 text-yellow-700 border border-yellow-300":"bg-gray-100 text-gray-700 border border-gray-300"),children:"active"===e.status?"実行中":"draft"===e.status?"下書き":"完了"}),"draft"===e.status&&(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("button",{onClick:()=>I(e.id,"approve"),className:"bg-gradient-to-r from-orange-600 to-orange-500 hover:from-orange-700 hover:to-orange-600 text-white px-3 py-1 rounded text-sm transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl",children:"承認"}),(0,r.jsx)("button",{onClick:()=>I(e.id,"reject"),className:"bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white px-3 py-1 rounded text-sm transition-all duration-300 transform hover:scale-105",children:"却下"})]})]})]})},e.id)})})]}),"codes"===j&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"登録番号管理"}),(0,r.jsxs)("button",{onClick:()=>N(!0),className:"bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white px-4 py-2 rounded-lg flex items-center space-x-2 transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl",children:[(0,r.jsx)(ew.A,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:"新規作成"})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[(0,r.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 rounded-full p-2 shadow-lg",children:(0,r.jsx)(ez.A,{className:"w-5 h-5 text-white"})}),(0,r.jsxs)("div",{className:"ml-3",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"総登録番号数"}),(0,r.jsx)("p",{className:"text-lg font-bold text-orange-600",children:Q.totalCodes})]})]})}),(0,r.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 rounded-full p-2 shadow-lg",children:(0,r.jsx)(R.A,{className:"w-5 h-5 text-white"})}),(0,r.jsxs)("div",{className:"ml-3",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"使用済み"}),(0,r.jsx)("p",{className:"text-lg font-bold text-orange-600",children:Q.usedCodes})]})]})})]}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider border-b border-gray-200",children:"登録番号"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider border-b border-gray-200",children:"会社名"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider border-b border-gray-200",children:"業界"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider border-b border-gray-200",children:"状態"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider border-b border-gray-200",children:"使用者"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider border-b border-gray-200",children:"作成日"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider border-b border-gray-200",children:"アクション"})]})}),(0,r.jsx)("tbody",{className:"divide-y divide-gray-200",children:i.map(e=>(0,r.jsxs)("tr",{className:"hover:bg-orange-50",children:[(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("span",{className:"font-mono text-sm font-medium text-gray-800 bg-gray-100 px-2 py-1 rounded border",children:e.code})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-800",children:e.company_name}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:e.industry}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("span",{className:"px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ".concat((e.is_used,"bg-orange-100 text-orange-700 border border-orange-300")),children:e.is_used?"使用済み":"未使用"})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:e.used_by_user?(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-medium",children:e.used_by_user.name}),(0,r.jsx)("div",{className:"text-xs text-gray-500",children:e.used_by_user.email})]}):(0,r.jsx)("span",{className:"text-gray-400",children:"-"})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:new Date(e.created_at).toLocaleDateString("ja-JP")}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:!e.is_used&&(0,r.jsxs)("button",{onClick:()=>T(e.id,e.code),className:"text-red-600 hover:text-red-700 transition-colors flex items-center space-x-1",children:[(0,r.jsx)(ev.A,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:"削除"})]})})]},e.id))})]})})]}),"exchanges"===j&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"ポイント交換管理"}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("label",{className:"text-sm font-medium text-gray-600",children:"フィルター:"}),(0,r.jsxs)("select",{value:C,onChange:e=>A(e.target.value),className:"px-3 py-1 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,r.jsx)("option",{value:"all",children:"すべて"}),(0,r.jsx)("option",{value:"pending",children:"処理待ち"}),(0,r.jsx)("option",{value:"completed",children:"完了"}),(0,r.jsx)("option",{value:"rejected",children:"却下"})]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[(0,r.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 rounded-full p-2 shadow-lg",children:(0,r.jsx)(G.A,{className:"w-5 h-5 text-white"})}),(0,r.jsxs)("div",{className:"ml-3",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"処理待ち"}),(0,r.jsx)("p",{className:"text-lg font-bold text-orange-600",children:Q.pendingExchangeRequests})]})]})}),(0,r.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 rounded-full p-2 shadow-lg",children:(0,r.jsx)(B.A,{className:"w-5 h-5 text-white"})}),(0,r.jsxs)("div",{className:"ml-3",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"総交換依頼"}),(0,r.jsx)("p",{className:"text-lg font-bold text-orange-600",children:Q.totalExchangeRequests})]})]})}),(0,r.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 rounded-full p-2 shadow-lg",children:(0,r.jsx)(J.A,{className:"w-5 h-5 text-white"})}),(0,r.jsxs)("div",{className:"ml-3",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"総交換ポイント"}),(0,r.jsx)("p",{className:"text-lg font-bold text-orange-600",children:x.filter(e=>"completed"===e.status).reduce((e,s)=>e+s.points_amount,0)})]})]})})]}),(0,r.jsxs)("div",{className:"overflow-x-auto",children:[(0,r.jsxs)("table",{className:"min-w-full",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider border-b border-gray-200",children:"モニター"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider border-b border-gray-200",children:"交換先"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider border-b border-gray-200",children:"ポイント/金額"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider border-b border-gray-200",children:"連絡先"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider border-b border-gray-200",children:"依頼日"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider border-b border-gray-200",children:"ステータス"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider border-b border-gray-200",children:"アクション"})]})}),(0,r.jsx)("tbody",{className:"divide-y divide-gray-200",children:M.map(e=>{var s,t;return(0,r.jsxs)("tr",{className:"hover:bg-orange-50",children:[(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-medium text-gray-800",children:null==(s=e.monitor)?void 0:s.name}),(0,r.jsx)("div",{className:"text-sm text-gray-600",children:null==(t=e.monitor)?void 0:t.email})]})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("div",{className:"text-sm text-gray-800",children:(e=>{switch(e){case"paypay":return"PayPay";case"amazon":return"Amazonギフトカード";case"starbucks":return"スターバックスギフトカード";default:return e}})(e.exchange_type)})}),(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,r.jsxs)("div",{className:"text-sm font-medium text-gray-800",children:[e.points_amount,"pt"]}),(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:[e.points_amount,"円相当"]})]}),(0,r.jsxs)("td",{className:"px-6 py-4",children:[(0,r.jsx)("div",{className:"text-sm text-gray-800 max-w-xs truncate",title:e.contact_info,children:e.contact_info}),e.notes&&(0,r.jsxs)("div",{className:"text-sm text-gray-600 max-w-xs truncate",title:e.notes,children:["備考: ",e.notes]})]}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:new Date(e.created_at).toLocaleDateString("ja-JP")}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("span",{className:"px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(("pending"===e.status||e.status,"bg-orange-100 text-orange-700 border border-orange-300")),children:"pending"===e.status?"処理待ち":"completed"===e.status?"完了":"却下"})}),(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:["pending"===e.status&&(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("button",{onClick:()=>D(e.id,"completed"),className:"bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white px-3 py-1 rounded text-sm transition-all duration-300 transform hover:scale-105",children:"完了にする"}),(0,r.jsx)("button",{onClick:()=>D(e.id,"rejected"),className:"bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white px-3 py-1 rounded text-sm transition-all duration-300 transform hover:scale-105",children:"却下する"})]}),"pending"!==e.status&&(0,r.jsx)("span",{className:"text-gray-400",children:e.processed_at&&new Date(e.processed_at).toLocaleDateString("ja-JP")})]})]},e.id)})})]}),0===M.length&&(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)(B.A,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-500",children:"all"===C?"ポイント交換依頼がありません":"".concat("pending"===C?"処理待ち":"completed"===C?"完了":"却下","の依頼がありません")})]})]})]}),"ads"===j&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"広告管理"}),(0,r.jsxs)("button",{onClick:()=>q(!0),className:"bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white px-4 py-2 rounded-lg flex items-center space-x-2 transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl",children:[(0,r.jsx)(ew.A,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:"新規作成"})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[(0,r.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 rounded-full p-2 shadow-lg",children:(0,r.jsx)(J.A,{className:"w-5 h-5 text-white"})}),(0,r.jsxs)("div",{className:"ml-3",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"総広告数"}),(0,r.jsx)("p",{className:"text-lg font-bold text-orange-600",children:Q.totalAds})]})]})}),(0,r.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 rounded-full p-2 shadow-lg",children:(0,r.jsx)(J.A,{className:"w-5 h-5 text-white"})}),(0,r.jsxs)("div",{className:"ml-3",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"アクティブ"}),(0,r.jsx)("p",{className:"text-lg font-bold text-orange-600",children:Q.activeAds})]})]})})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[h.map(e=>(0,r.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:border-orange-300 hover:shadow-md transition-all",children:(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,r.jsx)("h4",{className:"font-medium text-gray-800",children:e.title}),(0,r.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(e.is_active?"bg-green-100 text-green-700 border border-green-300":"bg-gray-100 text-gray-700 border border-gray-300"),children:e.is_active?"アクティブ":"非アクティブ"})]}),e.description&&(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:e.description}),(0,r.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[(0,r.jsxs)("span",{children:["表示順: ",e.display_order]}),(0,r.jsxs)("span",{children:["作成: ",new Date(e.created_at).toLocaleDateString("ja-JP")]}),e.creator&&(0,r.jsxs)("span",{children:["作成者: ",e.creator.name]})]}),e.target_regions&&e.target_regions.length>0&&(0,r.jsxs)("div",{className:"mt-1",children:[(0,r.jsx)("span",{className:"text-xs text-orange-400",children:"対象地域: "}),(0,r.jsx)("span",{className:"text-xs text-neutral-400",children:e.target_regions.join(", ")})]}),e.priority>0&&(0,r.jsx)("div",{className:"mt-1",children:(0,r.jsxs)("span",{className:"text-xs text-blue-400",children:["優先度: ",e.priority]})})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2 ml-4",children:[e.image_url&&(0,r.jsx)("img",{src:e.image_url,alt:e.title,className:"w-16 h-16 object-cover rounded-lg",onError:e=>{e.currentTarget.style.display="none"}}),(0,r.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,r.jsx)("button",{onClick:()=>F(e.id,e.is_active),className:"px-3 py-1 rounded text-sm transition-all duration-300 transform hover:scale-105 ".concat(e.is_active?"bg-gray-500 hover:bg-gray-600 text-white":"bg-green-500 hover:bg-green-600 text-white"),children:e.is_active?"非表示":"表示"}),(0,r.jsx)("button",{onClick:()=>L(e.id,e.title),className:"bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm transition-all duration-300 transform hover:scale-105",children:"削除"})]})]})]})},e.id)),0===h.length&&(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)(J.A,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-500",children:"広告がありません"})]})]})]}),"analytics"===j&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"システム分析"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[(0,r.jsx)("h4",{className:"font-medium text-gray-800 mb-2",children:"ユーザー登録推移"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"過去30日間の新規登録数"}),(0,r.jsx)("div",{className:"mt-4 h-32 bg-gray-50 rounded flex items-center justify-center border border-gray-200",children:(0,r.jsx)("p",{className:"text-gray-500",children:"チャート表示エリア"})})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[(0,r.jsx)("h4",{className:"font-medium text-gray-800 mb-2",children:"アンケート実行状況"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"アンケートの状態別分布"}),(0,r.jsx)("div",{className:"mt-4 h-32 bg-gray-50 rounded flex items-center justify-center border border-gray-200",children:(0,r.jsx)("p",{className:"text-gray-500",children:"チャート表示エリア"})})]})]})]})]})]})]}),(0,r.jsx)("div",{className:"absolute bottom-0 w-full h-32 bg-gradient-to-t from-gray-50 to-transparent"}),w&&(0,r.jsx)(eT,{onClose:()=>N(!1),onSubmit:z}),S&&(0,r.jsx)(eU,{onClose:()=>q(!1),onSubmit:U})]})},eT=e=>{let{onClose:s,onSubmit:t}=e,[l,n]=(0,a.useState)({code:"",company_name:"",industry:""});return(0,r.jsx)("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50",children:(0,r.jsxs)(k.P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-white/10 backdrop-blur-md rounded-2xl border border-white/20 p-6 w-full max-w-md shadow-2xl",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-white",children:"登録番号を作成"}),(0,r.jsx)("button",{onClick:s,className:"text-neutral-400 hover:text-white transition-colors",children:(0,r.jsx)(W.A,{className:"w-6 h-6"})})]}),(0,r.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!l.code.trim()||!l.company_name.trim()||!l.industry.trim())return void alert("すべての項目を入力してください。");t(l)},className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"登録番号"}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("input",{type:"text",value:l.code,onChange:e=>n(s=>({...s,code:e.target.value.toUpperCase()})),className:"flex-1 px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-neutral-400",placeholder:"登録番号を入力",required:!0}),(0,r.jsx)("button",{type:"button",onClick:()=>{let e="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",s="";for(let t=0;t<8;t++)s+=e.charAt(Math.floor(Math.random()*e.length));n(e=>({...e,code:s}))},className:"bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white px-3 py-2 rounded-lg text-sm transition-all duration-300 transform hover:scale-105",children:"自動生成"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"会社名"}),(0,r.jsx)("input",{type:"text",value:l.company_name,onChange:e=>n(s=>({...s,company_name:e.target.value})),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-white placeholder-neutral-400",placeholder:"会社名を入力",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"業界"}),(0,r.jsx)("input",{type:"text",value:l.industry,onChange:e=>n(s=>({...s,industry:e.target.value})),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-white placeholder-neutral-400",placeholder:"業界を入力",required:!0})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-4 mt-6",children:[(0,r.jsx)("button",{type:"button",onClick:s,className:"px-4 py-2 text-neutral-300 border border-white/20 rounded-lg hover:bg-white/10 transition-colors",children:"キャンセル"}),(0,r.jsx)("button",{type:"submit",className:"px-4 py-2 bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white rounded-lg transition-all duration-300 transform hover:scale-105",children:"作成"})]})]})]})})},eU=e=>{let{onClose:s,onSubmit:t}=e,[l,n]=(0,a.useState)("url"),[o,i]=(0,a.useState)(!1),[c,m]=(0,a.useState)(null),[x,u]=(0,a.useState)({title:"",description:"",image_url:"",link_url:"",display_order:0}),h=async e=>{var s;let t=null==(s=e.target.files)?void 0:s[0];if(t){if(!t.type.startsWith("image/"))return void m("画像ファイルを選択してください。");if(t.size>5242880)return void m("ファイルサイズは5MB以下にしてください。");i(!0),m(null);try{let e=t.name.split(".").pop(),s="".concat(Date.now(),"-").concat(Math.random().toString(36).substring(2),".").concat(e),r="advertisements/".concat(s),{data:a,error:l}=await d.storage.from("images").upload(r,t);if(l){console.error("Upload error:",l),m("アップロードに失敗しました。");return}let{data:{publicUrl:n}}=d.storage.from("images").getPublicUrl(r);u(e=>({...e,image_url:n}))}catch(e){console.error("Upload error:",e),m("アップロードに失敗しました。")}finally{i(!1)}}};return(0,r.jsx)("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50",children:(0,r.jsxs)(k.P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-white/10 backdrop-blur-md rounded-2xl border border-white/20 p-6 w-full max-w-md shadow-2xl",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-white",children:"広告を作成"}),(0,r.jsx)("button",{onClick:s,className:"text-neutral-400 hover:text-white transition-colors",children:(0,r.jsx)(W.A,{className:"w-6 h-6"})})]}),(0,r.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!x.title.trim())return void alert("タイトルを入力してください。");t(x)},className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"タイトル *"}),(0,r.jsx)("input",{type:"text",value:x.title,onChange:e=>u(s=>({...s,title:e.target.value})),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-white placeholder-neutral-400",placeholder:"広告タイトルを入力",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"説明"}),(0,r.jsx)("textarea",{value:x.description,onChange:e=>u(s=>({...s,description:e.target.value})),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-white placeholder-neutral-400",rows:3,placeholder:"広告の説明を入力"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"画像"}),(0,r.jsxs)("div",{className:"flex mb-4 bg-white/5 rounded-lg p-1",children:[(0,r.jsx)("button",{type:"button",onClick:()=>n("url"),className:"flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ".concat("url"===l?"bg-orange-600 text-white":"text-neutral-400 hover:text-white"),children:"URL指定"}),(0,r.jsx)("button",{type:"button",onClick:()=>n("upload"),className:"flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ".concat("upload"===l?"bg-orange-600 text-white":"text-neutral-400 hover:text-white"),children:"ファイルアップロード"})]}),"url"===l&&(0,r.jsx)("input",{type:"url",value:x.image_url,onChange:e=>u(s=>({...s,image_url:e.target.value})),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-white placeholder-neutral-400",placeholder:"https://example.com/image.jpg"}),"upload"===l&&(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("div",{className:"flex items-center justify-center w-full",children:(0,r.jsxs)("label",{className:"flex flex-col items-center justify-center w-full h-32 border-2 border-white/20 border-dashed rounded-lg cursor-pointer bg-white/5 hover:bg-white/10 transition-colors",children:[(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[(0,r.jsx)(ej.A,{className:"w-8 h-8 mb-2 text-neutral-400"}),(0,r.jsx)("p",{className:"mb-2 text-sm text-neutral-400",children:(0,r.jsx)("span",{className:"font-semibold",children:"クリックしてファイルを選択"})}),(0,r.jsx)("p",{className:"text-xs text-neutral-500",children:"PNG, JPG, GIF (最大5MB)"})]}),(0,r.jsx)("input",{type:"file",className:"hidden",accept:"image/*",onChange:h,disabled:o})]})}),o&&(0,r.jsxs)("div",{className:"flex items-center justify-center py-2",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-orange-500 mr-2"}),(0,r.jsx)("span",{className:"text-sm text-neutral-400",children:"アップロード中..."})]}),c&&(0,r.jsx)("div",{className:"p-3 bg-red-500/10 border border-red-500/20 rounded-lg",children:(0,r.jsx)("p",{className:"text-red-400 text-sm",children:c})})]}),x.image_url&&(0,r.jsxs)("div",{className:"mt-3",children:[(0,r.jsx)("p",{className:"text-sm text-neutral-400 mb-2",children:"プレビュー:"}),(0,r.jsx)("img",{src:x.image_url,alt:"広告画像プレビュー",className:"w-full max-w-xs h-32 object-cover rounded-lg border border-white/20",onError:e=>{e.currentTarget.style.display="none"}})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"リンクURL"}),(0,r.jsx)("input",{type:"url",value:x.link_url,onChange:e=>u(s=>({...s,link_url:e.target.value})),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-white placeholder-neutral-400",placeholder:"https://example.com"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"表示順序"}),(0,r.jsx)("input",{type:"number",value:x.display_order,onChange:e=>u(s=>({...s,display_order:Number(e.target.value)})),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-white placeholder-neutral-400",placeholder:"0",min:"0"})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-4 mt-6",children:[(0,r.jsx)("button",{type:"button",onClick:s,className:"px-4 py-2 text-neutral-300 border border-white/20 rounded-lg hover:bg-white/10 transition-colors",children:"キャンセル"}),(0,r.jsx)("button",{type:"submit",className:"px-4 py-2 bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white rounded-lg transition-all duration-300 transform hover:scale-105",children:"作成"})]})]})]})})},eF=()=>{let{user:e,signOut:s}=m(),[t,l]=(0,a.useState)([]),[n,o]=(0,a.useState)([]),[i,c]=(0,a.useState)(null),[x,u]=(0,a.useState)(""),[h,g]=(0,a.useState)(!0),[p,b]=(0,a.useState)([]),[j,v]=(0,a.useState)([]),[y,w]=(0,a.useState)("rooms");(0,a.useEffect)(()=>{e&&(N(),_(),S())},[e,N,_]),(0,a.useEffect)(()=>{i&&C()},[i,C]);let N=async()=>{if(e)try{console.log("=== Starting fetchChatRooms ==="),console.log("Checking for rooms with messages...");let{data:s,error:t}=await d.from("chat_messages").select("room_id").order("created_at",{ascending:!1});if(t)throw t;if(console.log("Messages found:",s),s&&s.length>0){let e=[...new Set(s.map(e=>e.room_id))];console.log("Room IDs with messages:",e);let{data:t,error:r}=await d.from("chat_rooms").select("\n            *,\n            participants_info:users(id, name, email, role)\n          ").in("id",e);if(r)throw r;if(console.log("Rooms with messages:",t),t&&t.length>0){let e=await Promise.all(t.map(async e=>{let{count:s}=await d.from("chat_messages").select("*",{count:"exact",head:!0}).eq("room_id",e.id);return{room:e,messageCount:s||0}}));console.log("Rooms with message counts:",e);let s=e.sort((e,s)=>s.messageCount-e.messageCount)[0];console.log("Selected room with most messages:",s),o(t),c(s.room),q(s.room.id);return}}console.log("Fallback: fetching user rooms...");let{data:r,error:a}=await d.from("chat_rooms").select("\n          *,\n          participants_info:users(id, name, email, role)\n        ").contains("participants",[e.id]).order("updated_at",{ascending:!1});if(a)throw a;if(console.log("User rooms found:",r),r&&r.length>0){o(r);let e=r[0];console.log("Selected first room:",e),c(e),q(e.id)}else console.log("No rooms found for user")}catch(e){console.error("Error fetching chat rooms:",e)}finally{g(!1)}},_=async()=>{try{let{data:s,error:t}=await d.from("users").select("*").neq("id",null==e?void 0:e.id).limit(20);if(t)throw t;b(s||[])}catch(e){console.error("Error fetching online users:",e)}},S=async()=>{try{let{data:e,error:s}=await d.from("users").select("*").eq("role","support").order("name");if(s)throw s;v(e||[])}catch(e){console.error("Error fetching support staff:",e)}},q=async e=>{try{console.log("=== Starting fetchMessages ==="),console.log("Room ID:",e);let{count:s,error:t}=await d.from("chat_messages").select("*",{count:"exact",head:!0}).eq("room_id",e);if(t)throw t;if(console.log("Message count for room:",s),0===s){console.log("No messages found for this room"),l([]);return}let{data:r,error:a}=await d.from("chat_messages").select("\n          *,\n          sender:users(name, email)\n        ").eq("room_id",e).order("created_at",{ascending:!0});if(a)throw a;if(console.log("Fetched messages:",r),console.log("Number of messages fetched:",(null==r?void 0:r.length)||0),l(r||[]),r&&r.length>0){let s=r.find(e=>e.message&&e.message.includes("【キャリア相談申込】"));if(s){let t=s.message.match(/お名前:\s*([^\n\r]+)/);if(t&&t[1]){let s=t[1].trim();E(e,"".concat(s))}}}}catch(e){console.error("Error fetching messages:",e)}},C=()=>{console.log("Setting up realtime subscription for active room:",null==i?void 0:i.id);let s=d.channel("chat_room_".concat((null==i?void 0:i.id)||"all")).on("postgres_changes",{event:"INSERT",schema:"public",table:"chat_messages",filter:i?"room_id=eq.".concat(i.id):void 0},s=>{console.log("New message received:",s);let t=s.new;i&&t.room_id===i.id&&t.sender_id!==(null==e?void 0:e.id)&&l(e=>[...e,t])}).subscribe();return()=>{s.unsubscribe()}},A=async()=>{if(x.trim()&&i&&e)try{let s=x.trim(),t={id:"temp-".concat(Date.now()),room_id:i.id,sender_id:e.id,message:s,message_type:"text",is_read:!1,created_at:new Date().toISOString(),sender:{name:e.name,email:e.email}};l(e=>[...e,t]),u("");let{data:r,error:a}=await d.from("chat_messages").insert([{room_id:i.id,sender_id:e.id,message:s,message_type:"text",is_read:!1}]).select().single();if(a)throw a;r&&l(s=>s.map(s=>s.id===t.id?{...r,sender:{name:e.name,email:e.email}}:s))}catch(e){console.error("Error sending message:",e),l(e=>e.filter(e=>!e.id.startsWith("temp-"))),alert("メッセージの送信に失敗しました。もう一度お試しください。")}},E=async(e,s)=>{try{let{error:t}=await d.from("chat_rooms").update({name:s}).eq("id",e);if(t)throw t;o(t=>t.map(t=>t.id===e?{...t,name:s}:t)),(null==i?void 0:i.id)===e&&c(e=>e?{...e,name:s}:null)}catch(e){console.error("Error updating room name:",e)}},P=async()=>{await s()};return h?(0,r.jsx)("div",{className:"min-h-screen bg-white flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"読み込み中..."})]})}):(0,r.jsxs)("div",{className:"min-h-screen bg-white relative overflow-hidden",children:[(0,r.jsx)("div",{className:"w-full absolute inset-0 h-screen",children:(0,r.jsx)(es,{id:"tsparticlessupport",background:"transparent",minSize:.6,maxSize:1.4,particleDensity:40,className:"w-full h-full",particleColor:"#3B82F6",speed:.3})}),(0,r.jsx)("header",{className:"relative z-20 bg-white/80 backdrop-blur-sm border-b border-blue-100",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"flex justify-between items-center py-4",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 rounded-full p-2",children:(0,r.jsx)(F.A,{className:"w-6 h-6 text-white"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"キャリアサポートセンター"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"サポートスタッフ専用ダッシュボード"})]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),(0,r.jsx)("span",{className:"text-sm text-gray-600",children:"オンライン"})]}),(0,r.jsxs)("button",{onClick:P,className:"flex items-center space-x-2 text-gray-600 hover:text-red-600 transition-colors",children:[(0,r.jsx)(L.A,{className:"w-5 h-5"}),(0,r.jsx)("span",{children:"ログアウト"})]})]})]})})}),(0,r.jsx)("main",{className:"relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6 h-[calc(100vh-200px)]",children:[(0,r.jsxs)("div",{className:"lg:col-span-1 bg-white/80 backdrop-blur-sm rounded-2xl border border-blue-100 shadow-xl",children:[(0,r.jsx)("div",{className:"border-b border-gray-200",children:(0,r.jsxs)("nav",{className:"flex flex-col space-y-1 px-4 py-2",children:[(0,r.jsxs)("button",{onClick:()=>w("rooms"),className:"flex items-center space-x-2 py-3 px-3 rounded-lg font-medium text-sm transition-all ".concat("rooms"===y?"bg-blue-100 border border-blue-300 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:bg-gray-50"),children:[(0,r.jsx)(F.A,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:"チャットルーム"})]}),(0,r.jsxs)("button",{onClick:()=>w("staff"),className:"flex items-center space-x-2 py-3 px-3 rounded-lg font-medium text-sm transition-all ".concat("staff"===y?"bg-blue-100 border border-blue-300 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:bg-gray-50"),children:[(0,r.jsx)(R.A,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:"サポートスタッフ"})]}),(0,r.jsxs)("button",{onClick:()=>w("users"),className:"flex items-center space-x-2 py-3 px-3 rounded-lg font-medium text-sm transition-all ".concat("users"===y?"bg-blue-100 border border-blue-300 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:bg-gray-50"),children:[(0,r.jsx)(R.A,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:"オンラインユーザー"})]})]})}),(0,r.jsxs)("div",{className:"p-6",children:["rooms"===y&&(0,r.jsx)("div",{children:0===n.length?(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)(F.A,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-500",children:"現在チャットルームはありません。"})]}):(0,r.jsx)("div",{className:"space-y-3",children:n.map(e=>(0,r.jsx)(k.P.div,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>(e=>{c(e),q(e.id)})(e),className:"bg-white border border-gray-200 rounded-lg p-4 hover:border-blue-300 hover:shadow-md transition-all cursor-pointer ".concat((null==i?void 0:i.id)===e.id?"border-blue-300 bg-blue-50":""),children:(0,r.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h3",{className:"font-medium text-gray-800",children:e.name||("support"===e.room_type?"キャリア相談サポート":"モニターとのチャット")}),(0,r.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"support"===e.room_type?"キャリア相談チャット":"モニターとのダイレクトメッセージ"})]}),(0,r.jsx)("div",{className:"flex items-center space-x-2 ml-4",children:(0,r.jsx)("div",{className:"w-3 h-3 rounded-full ".concat("support"===e.room_type?"bg-blue-500":"bg-green-500")})})]})},e.id))})}),"staff"===y&&(0,r.jsx)("div",{children:0===j.length?(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)(R.A,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-500",children:"サポートスタッフが見つかりません。"})]}):(0,r.jsx)("div",{className:"space-y-3",children:j.map(e=>{var s;return(0,r.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:border-purple-300 hover:shadow-md transition-all",children:(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-purple-600 rounded-full flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-white text-sm font-medium",children:(null==(s=e.name)?void 0:s.charAt(0))||"S"})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-800 truncate",children:e.name}),(0,r.jsx)("p",{className:"text-xs text-gray-500 truncate",children:e.email})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),(0,r.jsx)("span",{className:"text-xs text-green-600",children:"オンライン"})]})]})},e.id)})})}),"users"===y&&(0,r.jsx)("div",{children:0===p.length?(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)(R.A,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-500",children:"オンラインユーザーはいません。"})]}):(0,r.jsx)("div",{className:"space-y-3",children:p.map(e=>{var s;return(0,r.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:border-blue-300 hover:shadow-md transition-all",children:(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-white text-sm font-medium",children:(null==(s=e.name)?void 0:s.charAt(0))||"U"})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-800 truncate",children:e.name}),(0,r.jsx)("p",{className:"text-xs text-gray-500 truncate",children:e.email})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),(0,r.jsx)("span",{className:"text-xs text-green-600",children:"オンライン"})]})]})},e.id)})})})]})]}),(0,r.jsx)("div",{className:"lg:col-span-3 bg-white/80 backdrop-blur-sm rounded-2xl border border-blue-100 flex flex-col",style:{height:"600px"},children:i?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"p-4 border-b border-blue-100",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("div",{children:(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:i.name||"無名のルーム"})}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(el.A,{className:"w-4 h-4 text-gray-400"}),(0,r.jsx)(f.A,{className:"w-4 h-4 text-gray-400"})]})]})}),(0,r.jsx)("div",{className:"flex-1 p-4 overflow-y-auto space-y-4",children:0===t.length?(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)(F.A,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-500",children:"メッセージがありません"}),(0,r.jsxs)("p",{className:"text-xs text-gray-400 mt-2",children:["アクティブルーム: ",null==i?void 0:i.id," | ルームタイプ: ",null==i?void 0:i.room_type]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("button",{onClick:()=>{console.log("Manual refresh triggered"),i&&q(i.id)},className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"手動で更新"}),(0,r.jsx)("button",{onClick:async()=>{console.log("Testing direct message fetch...");let{data:e,error:s}=await d.from("chat_messages").select("*").order("created_at",{ascending:!0});s?(console.error("Error fetching all messages:",s),alert("エラー: ".concat(s.message))):(console.log("All messages in database:",e),alert("データベースには ".concat((null==e?void 0:e.length)||0," 件のメッセージがあります")))},className:"w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:"全メッセージ確認"}),(0,r.jsx)("button",{onClick:async()=>{console.log("Testing RLS bypass...");let{data:e,error:s}=await d.rpc("get_all_messages");s?(console.error("Error with RLS bypass:",s),alert("RLSバイパスエラー: ".concat(s.message))):(console.log("Messages with RLS bypass:",e),alert("RLSバイパスで ".concat((null==e?void 0:e.length)||0," 件のメッセージを取得")))},className:"w-full px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"RLSバイパステスト"}),(0,r.jsx)("button",{onClick:async()=>{console.log("Checking current user info..."),console.log("Current user:",e);let{data:s,error:t}=await d.from("users").select("*").eq("id",null==e?void 0:e.id).single();t?(console.error("Error fetching user data:",t),alert("ユーザー情報取得エラー: ".concat(t.message))):(console.log("User data:",s),alert("ユーザー: ".concat(s.name," (").concat(s.role,")")))},className:"w-full px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:"ユーザー情報確認"})]})]}):(0,r.jsx)(r.Fragment,{children:t.map(s=>(0,r.jsx)(k.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex ".concat(s.sender_id===(null==e?void 0:e.id)?"justify-end":"justify-start"),children:(0,r.jsxs)("div",{className:"max-w-xs lg:max-w-md px-4 py-2 rounded-lg ".concat(s.sender_id===(null==e?void 0:e.id)?"bg-blue-600 text-white":"bg-gray-100 text-gray-900"),children:[(0,r.jsx)("div",{className:"text-sm whitespace-pre-wrap",children:s.message}),(0,r.jsx)("p",{className:"text-xs mt-1 ".concat(s.sender_id===(null==e?void 0:e.id)?"text-blue-100":"text-gray-500"),children:new Date(s.created_at).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"})})]})},s.id))})}),(0,r.jsx)("div",{className:"p-4 border-t border-blue-100",children:(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("textarea",{value:x,onChange:e=>u(e.target.value),onKeyPress:e=>{if("Enter"===e.key)return},placeholder:"メッセージを入力... (Enterで改行、送信ボタンで送信)",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",rows:1,style:{minHeight:"44px",maxHeight:"120px"}}),(0,r.jsx)("button",{onClick:A,disabled:!x.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,r.jsx)(ei.A,{className:"w-4 h-4"})})]})})]}):(0,r.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)(F.A,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"チャットルームを選択してください"})]})})})]})})]})};var eL=t(5710);function eM(){let{user:e,loading:s,error:t}=m(),[n,o]=(0,a.useState)(!0);if((0,a.useEffect)(()=>{(async()=>{await l.A.init({appId:'0f6c0b6f-8a3e-4701-b5fe-1d8564674bdd"',notifyButton:{enable:!0}})})()},[]),!c)return(0,r.jsxs)("div",{className:"min-h-screen bg-white flex items-center justify-center p-4 relative overflow-hidden",children:[(0,r.jsx)("div",{className:"w-full absolute inset-0 h-screen",children:(0,r.jsx)(es,{id:"tsparticlessetup",background:"transparent",minSize:.6,maxSize:1.4,particleDensity:60,className:"w-full h-full",particleColor:"#F97316",speed:.5})}),(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-orange-50/30 via-white to-orange-50/30"}),(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-white/80 via-transparent to-white/80"}),(0,r.jsxs)("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-8 max-w-md w-full text-center border border-orange-100 relative z-20",children:[(0,r.jsx)("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 rounded-full p-4 w-20 h-20 mx-auto mb-6 flex items-center justify-center shadow-lg",children:(0,r.jsx)(eL.A,{className:"w-10 h-10 text-white"})}),(0,r.jsx)("h1",{className:"text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-orange-600 to-orange-500 mb-4",children:"Supabaseの設定が必要です"}),(0,r.jsxs)("p",{className:"text-gray-600 mb-6",children:["アプリケーションを使用するには、Supabaseプロジェクトを設定してください。",(0,r.jsx)("br",{}),(0,r.jsx)("br",{}),"環境変数が正しく設定されていない可能性があります。"]}),(0,r.jsxs)("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4 text-left",children:[(0,r.jsx)("h3",{className:"font-semibold text-orange-900 mb-2",children:"設定手順:"}),(0,r.jsxs)("ol",{className:"text-sm text-orange-800 space-y-1",children:[(0,r.jsx)("li",{children:"1. .envファイルを確認してください"}),(0,r.jsx)("li",{children:"2. VITE_SUPABASE_URLが正しく設定されているか確認"}),(0,r.jsx)("li",{children:"3. VITE_SUPABASE_ANON_KEYが正しく設定されているか確認"}),(0,r.jsx)("li",{children:"4. 開発サーバーを再起動してください"})]})]})]})]});if(t)return(0,r.jsxs)("div",{className:"min-h-screen bg-white flex items-center justify-center p-4 relative overflow-hidden",children:[(0,r.jsx)("div",{className:"w-full absolute inset-0 h-screen",children:(0,r.jsx)(es,{id:"tsparticleserror",background:"transparent",minSize:.6,maxSize:1.4,particleDensity:60,className:"w-full h-full",particleColor:"#3B82F6",speed:.5})}),(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-50/30 via-white to-orange-50/30"}),(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-white/80 via-transparent to-white/80"}),(0,r.jsxs)("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-8 max-w-md w-full text-center border border-orange-100 relative z-20",children:[(0,r.jsx)("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 rounded-full p-4 w-20 h-20 mx-auto mb-6 flex items-center justify-center shadow-lg",children:(0,r.jsx)(eS.A,{className:"w-10 h-10 text-white"})}),(0,r.jsx)("h1",{className:"text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-orange-600 to-orange-500 mb-4",children:"接続エラー"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6",children:t}),(0,r.jsx)("button",{onClick:()=>window.location.reload(),className:"bg-gradient-to-r from-orange-600 to-orange-500 hover:from-orange-700 hover:to-orange-600 text-white px-6 py-2 rounded-lg transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl",children:"再試行"})]})]});if(s)return(0,r.jsxs)("div",{className:"min-h-screen bg-white flex items-center justify-center p-4 relative overflow-hidden",children:[(0,r.jsx)("div",{className:"w-full absolute inset-0 h-screen",children:(0,r.jsx)(es,{id:"tsparticlesloading",background:"transparent",minSize:.6,maxSize:1.4,particleDensity:60,className:"w-full h-full",particleColor:"#3B82F6",speed:.5})}),(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-50/30 via-white to-orange-50/30"}),(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-white/80 via-transparent to-white/80"}),(0,r.jsx)("div",{className:"text-center max-w-md relative z-20",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-600 mx-auto mb-4"})})]});if(!e)return n?(0,r.jsx)(z,{onGetStarted:()=>o(!1)}):(0,r.jsx)(I,{onBack:()=>o(!0)});if(console.log("Current user:",null==e?void 0:e.email,"Role:",null==e?void 0:e.role),e&&!e.role)return(0,r.jsx)("div",{className:"min-h-screen bg-white flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"ユーザー情報を読み込み中..."})]})});switch(console.log("Routing user with role:",e.role,"email:",e.email),e.role){case"monitor":return console.log("Rendering MonitorDashboard"),(0,r.jsxs)("div",{children:[(0,r.jsx)(eb,{}),(0,r.jsx)("div",{className:"onesignal-customlink-container"})]});case"client":return console.log("Rendering ClientDashboard"),(0,r.jsxs)("div",{children:[(0,r.jsx)(eP,{}),(0,r.jsx)("div",{className:"onesignal-customlink-container"})]});case"admin":return console.log("Rendering AdminDashboard"),(0,r.jsxs)("div",{children:[(0,r.jsx)(eR,{}),(0,r.jsx)("div",{className:"onesignal-customlink-container"})]});case"support":return console.log("Rendering SupportDashboard"),(0,r.jsxs)("div",{children:[(0,r.jsx)(eF,{}),(0,r.jsx)("div",{className:"onesignal-customlink-container"})]});default:if("admin@example.com"===e.email)return console.log("Rendering AdminDashboard for admin email"),(0,r.jsxs)("div",{children:[(0,r.jsx)(eR,{}),(0,r.jsx)("div",{className:"onesignal-customlink-container"})]});if("support@example.com"===e.email)return console.log("Rendering SupportDashboard for support email"),(0,r.jsxs)("div",{children:[(0,r.jsx)(eF,{}),(0,r.jsx)("div",{className:"onesignal-customlink-container"})]});return console.log("Unknown role, signing out user:",e.role,"email:",e.email),(0,r.jsx)("div",{className:"min-h-screen bg-white flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:"不明なユーザー役割です。再度ログインしてください。"}),(0,r.jsxs)("p",{className:"text-sm text-gray-500 mb-4",children:["Role: ",e.role,", Email: ",e.email]}),(0,r.jsx)("button",{onClick:()=>window.location.reload(),className:"bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg",children:"再読み込み"})]})})}}}},e=>{e.O(0,[14,441,255,358],()=>e(e.s=2531)),_N_E=e.O()}]);